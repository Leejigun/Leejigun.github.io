<!-- footer도 여기에 있음 -->


<!DOCTYPE html>
<html>
<head>

    <!-- Document Settings -->
    <meta charset="utf-8" />
    <meta http-equiv="X-UA-Compatible" content="IE=edge" />

    <!-- Base Meta -->
    <!-- iOS-tip 이라고 태그를 만들었으면 post에서는 iOS tip 이라고 태그를 줘야한다. -->
<!-- dynamically fixing the title for tag/author pages -->



    <title>RxSwift MVVM 실무 적용</title>
    <meta name="HandheldFriendly" content="True" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <!-- Styles'n'Scripts -->
    <link rel="stylesheet" type="text/css" href="/assets/built/screen.css" />
    <link rel="stylesheet" type="text/css" href="/assets/built/screen.edited.css" />
    <link rel="stylesheet" type="text/css" href="/assets/built/syntax.css" />
    <!-- highlight.js -->
    <link rel="stylesheet" href="//cdnjs.cloudflare.com/ajax/libs/highlight.js/9.12.0/styles/default.min.css">
    <style>.hljs { background: none; }</style>

    <!-- This tag outputs SEO meta+structured data and other important settings -->
    <meta name="description" content="RxSwift MVVM 실무 적용" />
    <link rel="shortcut icon" href="https://leejigun.github.io//assets/images/blog-icon.png" type="image/png" />
    <link rel="canonical" href="https://leejigun.github.io//RxSwift_MVVM" />
    <meta name="referrer" content="no-referrer-when-downgrade" />

     <!--title below is coming from _includes/dynamic_title-->
    <meta property="og:site_name" content="iOS 삽질 블로그" />
    <meta property="og:type" content="website" />
    <meta property="og:title" content="RxSwift MVVM 실무 적용" />
    <meta property="og:description" content="RxSwift MVVM 실무 적용 최근 외부 프로젝트를 진행하면서 RxSwift와 MVVM 아키텍처를 사용했습니다. 여러 라이브러리를 사용하고 다양한 방법들을 시도한 도전적인 프로젝트였는데 RxSwift와 MVVM을 사용하면서 수행했던 실제 적용 사례를 소개하려 합니다. Protocol 정의 작업 처음 MVVM 아키텍처에 대해서 여러가지 사용 예제들을 인터넷으로 확인해보니 Protocol을 사용해서 Inputr과 Output을 강제하는 방법을 사용하고 있어서 먼저" />
    <meta property="og:url" content="https://leejigun.github.io//RxSwift_MVVM" />
    <meta property="og:image" content="https://leejigun.github.io//assets/images/RxSwift/RxSwift_MVVM_Title.png" />
    <meta property="article:publisher" content="https://www.facebook.com/" />
    <meta property="article:author" content="https://www.facebook.com/" />
    <meta property="article:published_time" content="2019-08-27T09:00:01+09:00" />
    <meta property="article:modified_time" content="2019-08-27T09:00:01+09:00" />
    <meta property="article:tag" content="Rxswift" />
    <meta name="twitter:card" content="summary_large_image" />
    <meta name="twitter:title" content="RxSwift MVVM 실무 적용" />
    <meta name="twitter:description" content="RxSwift MVVM 실무 적용 최근 외부 프로젝트를 진행하면서 RxSwift와 MVVM 아키텍처를 사용했습니다. 여러 라이브러리를 사용하고 다양한 방법들을 시도한 도전적인 프로젝트였는데 RxSwift와 MVVM을 사용하면서 수행했던 실제 적용 사례를 소개하려 합니다. Protocol 정의 작업 처음 MVVM 아키텍처에 대해서 여러가지 사용 예제들을 인터넷으로 확인해보니 Protocol을 사용해서 Inputr과 Output을 강제하는 방법을 사용하고 있어서 먼저" />
    <meta name="twitter:url" content="https://leejigun.github.io//" />
    <meta name="twitter:image" content="https://leejigun.github.io//assets/images/RxSwift/RxSwift_MVVM_Title.png" />
    <meta name="twitter:label1" content="Written by" />
    <meta name="twitter:data1" content="iOS 삽질 블로그" />
    <meta name="twitter:label2" content="Filed under" />
    <meta name="twitter:data2" content="Rxswift" />
    <meta name="twitter:site" content="@" />
    <meta name="twitter:creator" content="@" />
    <meta property="og:image:width" content="1400" />
    <meta property="og:image:height" content="933" />

    <script type="application/ld+json">
{
    "@context": "https://schema.org",
    "@type": "Website",
    "publisher": {
        "@type": "Organization",
        "name": "iOS 삽질 블로그",
        "logo": "https://leejigun.github.io//assets/images/blog-icon.png"
    },
    "url": "https://leejigun.github.io//RxSwift_MVVM",
    "image": {
        "@type": "ImageObject",
        "url": "https://leejigun.github.io//assets/images/RxSwift/RxSwift_MVVM_Title.png",
        "width": 2000,
        "height": 666
    },
    "mainEntityOfPage": {
        "@type": "WebPage",
        "@id": "https://leejigun.github.io//RxSwift_MVVM"
    },
    "description": "RxSwift MVVM 실무 적용 최근 외부 프로젝트를 진행하면서 RxSwift와 MVVM 아키텍처를 사용했습니다. 여러 라이브러리를 사용하고 다양한 방법들을 시도한 도전적인 프로젝트였는데 RxSwift와 MVVM을 사용하면서 수행했던 실제 적용 사례를 소개하려 합니다. Protocol 정의 작업 처음 MVVM 아키텍처에 대해서 여러가지 사용 예제들을 인터넷으로 확인해보니 Protocol을 사용해서 Inputr과 Output을 강제하는 방법을 사용하고 있어서 먼저"
}
    </script>

    <!-- <script type="text/javascript" src="https://demo.ghost.io/public/ghost-sdk.min.js?v=724281a32e"></script>
    <script type="text/javascript">
    ghost.init({
    	clientId: "ghost-frontend",
    	clientSecret: "f84a07a72b17"
    });
    </script> -->

    <meta name="generator" content="Jekyll 3.6.2" />
    <link rel="alternate" type="application/rss+xml" title="RxSwift MVVM 실무 적용" href="/feed.xml" />


</head>
<body class="post-template">

    <div class="site-wrapper">
        <!-- All the main content gets inserted here, index.hbs, post.hbs, etc -->

        <!-- HTML elements for search -->

        <!-- default -->

<!-- The tag above means: insert everything in this file
into the {body} of the default.hbs template -->

<header class="site-header outer">
    <div class="inner">
        <!-- 네비게이션 바 -->
<nav class="site-nav">
    <div class="site-nav-left">
        
            
                <a class="site-nav-logo" href="https://leejigun.github.io//"><img src="/assets/images/blog-icon.png" alt="iOS 삽질 블로그" /></a>
            
        
        
            <!-- 여기서 navigation 에 표시할 이이템 추가 -->
<ul class="nav" role="menu">
    <li class="nav-home" role="menuitem"><a href="/">Home</a></li>
    <li class="nav-about" role="menuitem"><a href="/about/">About</a></li>
    <li class="nav-getting-started" role="menuitem"><a href="/tag/ios-tip/">iOS tip</a></li>
    <li class="nav-getting-started" role="menuitem"><a href="/tag/watchos/">watchOS</a></li>
    <li class="nav-getting-started" role="menuitem"><a href="/tag/rxswift/">RxSwift</a></li>
    <li class="nav-getting-started" role="menuitem"><a href="/tag/swiftui/">swiftui</a></li>
    <li class="nav-getting-started" role="menuitem"><a href="/tag/project/">project</a></li>
    <li class="nav-getting-started" role="menuitem"><a href="/tag/ml/">ML</a></li>
    <li class="nav-try-ghost" role="menuitem"><a href="https://github.com/Leejigun">github</a></li>
    <li class="nav-try-ghost" role="menuitem"><a href="/search.html">Search</a></li>
</ul>

        
    </div>
    <div class="site-nav-right">
        <div class="social-links">
            
            
        </div>
        
    </div>
</nav>

    </div>
</header>

<!-- Everything inside the #post tags pulls data from the post -->
<!-- #post -->

<main id="site-main" class="site-main outer" role="main">
    <div class="inner">

        <article class="post-full post tag-getting-started ">

            <header class="post-full-header">
                <section class="post-full-meta">
                    <time class="post-full-meta-date" datetime="27 August 2019">27 August 2019</time>
                    
                        <span class="date-divider">/</span>
                        
                            
                               <a href='/tag/rxswift/'>RXSWIFT</a>
                            
                        
                    
                </section>
                <h1 class="post-full-title">RxSwift MVVM 실무 적용</h1>
            </header>

            
            <figure class="post-full-image" style="background-image: url(/assets/images/RxSwift/RxSwift_MVVM_Title.png)">
            </figure>
            

            <section class="post-full-content">
                <div class="kg-card-markdown">
                    <h1 id="rxswift-mvvm-실무-적용">RxSwift MVVM 실무 적용</h1>
<p>최근 외부 프로젝트를 진행하면서 RxSwift와 MVVM 아키텍처를 사용했습니다. 여러 라이브러리를 사용하고 다양한 방법들을 시도한 도전적인 프로젝트였는데 RxSwift와 MVVM을 사용하면서 수행했던 실제 적용 사례를 소개하려 합니다.</p>

<h2 id="protocol-정의-작업">Protocol 정의 작업</h2>

<p>처음 MVVM 아키텍처에 대해서 여러가지 사용 예제들을 인터넷으로 확인해보니 Protocol을 사용해서 Inputr과 Output을 강제하는 방법을 사용하고 있어서 먼저 프로토콜을 정의했습니다.</p>

<div class="language-swift highlighter-rouge"><div class="highlight"><pre class="highlight"><code>     <span class="kd">protocol</span> <span class="kt">ViewModelProtocol</span> <span class="p">{</span>
        <span class="kd">associatedtype</span> <span class="kt">Result</span>
        <span class="kd">associatedtype</span> <span class="kt">ErrorType</span>
        <span class="kd">associatedtype</span> <span class="kt">Input</span>
        <span class="kd">associatedtype</span> <span class="kt">Output</span>
        <span class="k">var</span> <span class="nv">input</span><span class="p">:</span> <span class="kt">Input</span> <span class="p">{</span> <span class="k">get</span> <span class="p">}</span>
        <span class="k">var</span> <span class="nv">output</span><span class="p">:</span> <span class="kt">Output</span> <span class="p">{</span> <span class="k">get</span> <span class="p">}</span>
        <span class="nf">init</span><span class="p">(</span><span class="nv">provider</span><span class="p">:</span><span class="kt">OpenitProvider</span><span class="o">&lt;</span><span class="kt">JuvisAPI</span><span class="o">&gt;</span><span class="p">)</span>
    <span class="p">}</span>
</code></pre></div></div>

<p>이 프로토콜을 정의하고 뷰 모델에서 실제로 사용할 때에는 다음과 같이 사용했습니다.
 아래 내용은 실제로 제가 외부 프로젝트에서 사용한 장바구니 화면을 수정한 것 입니다.</p>

<div class="language-swift highlighter-rouge"><div class="highlight"><pre class="highlight"><code>     <span class="kd">class</span> <span class="kt">ShoppingBasketViewControllerModel</span><span class="p">:</span> <span class="kt">ViewModelProtocol</span> <span class="p">{</span>
        <span class="kd">enum</span> <span class="kt">Result</span> <span class="p">{</span>
            <span class="k">case</span> <span class="nf">success</span><span class="p">(</span><span class="kt">Any</span><span class="p">)</span>
            <span class="k">case</span> <span class="nf">fail</span><span class="p">(</span><span class="kt">ErrorType</span><span class="p">)</span>
        <span class="p">}</span>

        <span class="kd">enum</span> <span class="kt">ErrorType</span> <span class="p">{</span>
            <span class="k">case</span> <span class="nf">statusCodeError</span><span class="p">(</span><span class="kt">Int</span><span class="p">)</span>
            <span class="k">case</span> <span class="nf">jsonMappingError</span><span class="p">(</span><span class="kt">Error</span><span class="p">)</span>
            <span class="k">case</span> <span class="n">noContent</span>
            <span class="k">case</span> <span class="nf">httpError</span><span class="p">(</span><span class="kt">Error</span><span class="p">)</span>
        <span class="p">}</span>

        <span class="kd">enum</span> <span class="kt">CellAction</span> <span class="p">{</span>
            <span class="k">case</span> <span class="n">orderBtnPressed</span>
            <span class="k">case</span> <span class="n">cancelBtnPressed</span>
            <span class="k">case</span> <span class="nf">removeItem</span><span class="p">(</span><span class="kt">ShoppingItem</span><span class="p">)</span>
            <span class="k">case</span> <span class="nf">selectItem</span><span class="p">(</span><span class="kt">ShoppingItem</span><span class="p">)</span>
        <span class="p">}</span>

      <span class="kd">struct</span> <span class="kt">Input</span> <span class="p">{</span>
            <span class="k">let</span> <span class="nv">cellAction</span> <span class="o">=</span> <span class="kt">ReplaySubject</span><span class="o">&lt;</span><span class="kt">CellAction</span><span class="o">&gt;.</span><span class="nf">create</span><span class="p">(</span><span class="nv">bufferSize</span><span class="p">:</span> <span class="mi">1</span><span class="p">)</span>
            <span class="c1">/// API Request</span>
            <span class="k">let</span> <span class="nv">getBasketList</span> <span class="o">=</span> <span class="kt">ReplaySubject</span><span class="o">&lt;</span><span class="kt">Void</span><span class="o">&gt;.</span><span class="nf">create</span><span class="p">(</span><span class="nv">bufferSize</span><span class="p">:</span> <span class="mi">1</span><span class="p">)</span>
            <span class="c1">// 아이템 제거</span>
            <span class="k">let</span> <span class="nv">removeItem</span> <span class="o">=</span> <span class="kt">ReplaySubject</span><span class="o">&lt;</span><span class="kt">ShoppingItem</span><span class="o">&gt;.</span><span class="nf">create</span><span class="p">(</span><span class="nv">bufferSize</span><span class="p">:</span> <span class="mi">1</span><span class="p">)</span>
        <span class="p">}</span>

        <span class="kd">struct</span> <span class="kt">Output</span> <span class="p">{</span>
            <span class="c1">/// 로딩 여부</span>
            <span class="k">let</span> <span class="nv">isLoading</span> <span class="o">=</span> <span class="kt">BehaviorRelay</span><span class="o">&lt;</span><span class="kt">Bool</span><span class="o">&gt;</span><span class="p">(</span><span class="nv">value</span><span class="p">:</span> <span class="kc">false</span><span class="p">)</span>
            <span class="k">let</span> <span class="nv">basketList</span> <span class="o">=</span> <span class="kt">BehaviorRelay</span><span class="o">&lt;</span><span class="p">[</span><span class="kt">ShoppingItem</span><span class="p">]</span><span class="o">&gt;</span><span class="p">(</span><span class="nv">value</span><span class="p">:</span> <span class="p">[])</span>

            <span class="c1">// UI</span>
            <span class="c1">/// 상품가</span>
            <span class="k">let</span> <span class="nv">productPrice</span> <span class="o">=</span> <span class="kt">BehaviorRelay</span><span class="o">&lt;</span><span class="kt">Int</span><span class="o">&gt;</span><span class="p">(</span><span class="nv">value</span><span class="p">:</span> <span class="mi">0</span><span class="p">)</span>
            <span class="c1">/// 할인가</span>
            <span class="k">let</span> <span class="nv">dicsountPrice</span> <span class="o">=</span> <span class="kt">BehaviorRelay</span><span class="o">&lt;</span><span class="kt">Int</span><span class="o">&gt;</span><span class="p">(</span><span class="nv">value</span><span class="p">:</span> <span class="mi">0</span><span class="p">)</span>
            <span class="c1">/// 배송비</span>
            <span class="k">let</span> <span class="nv">deliveryCharge</span> <span class="o">=</span> <span class="kt">BehaviorRelay</span><span class="o">&lt;</span><span class="kt">Int</span><span class="o">&gt;</span><span class="p">(</span><span class="nv">value</span><span class="p">:</span> <span class="mi">0</span><span class="p">)</span>
            <span class="c1">/// 총 배송비</span>
            <span class="k">let</span> <span class="nv">totalPrice</span> <span class="o">=</span> <span class="kt">BehaviorRelay</span><span class="o">&lt;</span><span class="kt">Int</span><span class="o">&gt;</span><span class="p">(</span><span class="nv">value</span><span class="p">:</span> <span class="mi">0</span><span class="p">)</span>
        <span class="p">}</span>

        <span class="c1">// MARK: - Variable</span>
        <span class="k">var</span> <span class="nv">input</span><span class="p">:</span> <span class="kt">ShoppingBasketViewControllerModel</span><span class="o">.</span><span class="kt">Input</span>
        <span class="k">var</span> <span class="nv">output</span><span class="p">:</span> <span class="kt">ShoppingBasketViewControllerModel</span><span class="o">.</span><span class="kt">Output</span>
        <span class="k">let</span> <span class="nv">disposeBag</span> <span class="o">=</span> <span class="kt">DisposeBag</span><span class="p">()</span>

        <span class="kd">required</span> <span class="nf">init</span><span class="p">(</span><span class="nv">provider</span><span class="p">:</span> <span class="kt">OpenitProvider</span><span class="o">&lt;</span><span class="kt">JuvisAPI</span><span class="o">&gt;</span> <span class="o">=</span> <span class="kt">OpenitProvider</span><span class="o">&lt;</span><span class="kt">JuvisAPI</span><span class="o">&gt;</span><span class="p">())</span> <span class="p">{</span>
            <span class="k">self</span><span class="o">.</span><span class="n">input</span> <span class="o">=</span> <span class="kt">Input</span><span class="p">()</span>
            <span class="k">self</span><span class="o">.</span><span class="n">output</span> <span class="o">=</span> <span class="kt">Output</span><span class="p">()</span>
            <span class="nf">requestBasketList</span><span class="p">(</span><span class="n">provider</span><span class="p">,</span> <span class="nv">input</span><span class="p">:</span> <span class="n">input</span><span class="p">,</span> <span class="nv">output</span><span class="p">:</span> <span class="n">output</span><span class="p">)</span>
            <span class="nf">bindUI</span><span class="p">(</span><span class="n">provider</span><span class="p">,</span> <span class="nv">input</span><span class="p">:</span> <span class="n">input</span><span class="p">,</span> <span class="nv">output</span><span class="p">:</span> <span class="n">output</span><span class="p">)</span>
        <span class="p">}</span>
    <span class="p">}</span>
</code></pre></div></div>
<p>실제 제가 이번 프로젝트에서 사용한 내용입니다. 상세한 로직은 <strong>requestBasketList , bindUI</strong> 메소드에 있는데, 이번 포스트는 RxSwift와 MVVM에 관한 첫 번째 내용이니 넘어가도록 합니다. <strong>여기서 주의 깊게 봐야 하는 부분은 Input, Output 두 구조체입니다.</strong> MVVM에 익숙하지 않으면 제일 힘든 부분이 Input과 output을 엄격하게 구분해서 구조를 잡는 게 제일 힘들 것입니다.</p>

<hr />
<h2 id="분석">분석</h2>

<p>getBasketList는 말 그대로 장바니에서 표시할 쇼핑 데이터 리스트를 불러오는 부분입니다. 아무 인자값도 필요없기 때문에 ReplaySubject<Void>.create(bufferSize: 1)로 생성해서 사용하고 있습니다.</Void></p>

<p>뷰 컨트롤러에서 데이터를 불러올 때 이렇게 사용하고 있습니다.</p>

<div class="language-swift highlighter-rouge"><div class="highlight"><pre class="highlight"><code>    <span class="cp"># ShoppingBasketViewController</span>
    <span class="k">override</span> <span class="kd">func</span> <span class="nf">viewDidAppear</span><span class="p">(</span><span class="n">_</span> <span class="nv">animated</span><span class="p">:</span> <span class="kt">Bool</span><span class="p">)</span> <span class="p">{</span>
      <span class="k">super</span><span class="o">.</span><span class="nf">viewDidAppear</span><span class="p">(</span><span class="kc">true</span><span class="p">)</span>
      <span class="n">viewModel</span><span class="p">?</span><span class="o">.</span><span class="n">input</span><span class="o">.</span><span class="n">getBasketList</span><span class="o">.</span><span class="nf">onNext</span><span class="p">(())</span>
    <span class="p">}</span>
</code></pre></div></div>
<p>주로 화면에 들어올 때, 갱신이 필요할 경우 등 전체 갱신이 필요할 경우 사용해주면 됩니다.</p>

<p>다음으로 로직 부분을 살펴봅니다.</p>
<div class="language-swift highlighter-rouge"><div class="highlight"><pre class="highlight"><code>     <span class="kd">private</span> <span class="kd">func</span> <span class="nf">requestBasketList</span><span class="p">(</span><span class="n">_</span> <span class="nv">provider</span><span class="p">:</span> <span class="kt">OpenitProvider</span><span class="o">&lt;</span><span class="kt">JuvisAPI</span><span class="o">&gt;</span><span class="p">,</span> <span class="nv">input</span><span class="p">:</span> <span class="kt">Input</span><span class="p">,</span> <span class="nv">output</span><span class="p">:</span> <span class="kt">Output</span><span class="p">)</span> <span class="p">{</span>
            <span class="n">input</span><span class="o">.</span><span class="n">getBasketList</span>
                <span class="o">.</span><span class="nf">do</span><span class="p">(</span><span class="nv">onNext</span><span class="p">:</span> <span class="p">{</span> <span class="n">_</span> <span class="k">in</span> <span class="n">output</span><span class="o">.</span><span class="n">isLoading</span><span class="o">.</span><span class="nf">accept</span><span class="p">(</span><span class="kc">true</span><span class="p">)})</span>
                <span class="o">.</span><span class="n">map</span> <span class="p">{</span> <span class="n">_</span> <span class="o">-&gt;</span> <span class="p">[</span><span class="kt">ShoppingItem</span><span class="p">]</span> <span class="k">in</span>
                    <span class="k">return</span> <span class="n">appModel</span><span class="o">.</span><span class="n">basket</span>
                <span class="p">}</span>
                <span class="o">.</span><span class="n">map</span> <span class="p">{</span> <span class="n">list</span> <span class="o">-&gt;</span> <span class="p">[</span><span class="kt">ShoppingItem</span><span class="p">]</span> <span class="k">in</span>
                    <span class="n">list</span><span class="o">.</span><span class="n">forEach</span> <span class="p">{</span> <span class="nv">$0</span><span class="o">.</span><span class="n">selected</span><span class="o">.</span><span class="nf">accept</span><span class="p">(</span><span class="kc">false</span><span class="p">)</span> <span class="p">}</span>
                    <span class="k">return</span> <span class="n">list</span>
                <span class="p">}</span>
                <span class="o">.</span><span class="nf">do</span><span class="p">(</span><span class="nv">onNext</span><span class="p">:</span> <span class="p">{</span> <span class="n">_</span> <span class="k">in</span> <span class="n">output</span><span class="o">.</span><span class="n">isLoading</span><span class="o">.</span><span class="nf">accept</span><span class="p">(</span><span class="kc">false</span><span class="p">)})</span>
                <span class="o">.</span><span class="nf">bind</span><span class="p">(</span><span class="nv">to</span><span class="p">:</span> <span class="n">output</span><span class="o">.</span><span class="n">basketList</span><span class="p">)</span>
                <span class="o">.</span><span class="nf">disposed</span><span class="p">(</span><span class="nv">by</span><span class="p">:</span> <span class="n">disposeBag</span><span class="p">)</span>
        <span class="p">}</span>
</code></pre></div></div>
<p><strong>input.getBasketList</strong>에 이벤트가 들어오면 <strong>.do(onNext: { _ in output.isLoading.accept(true)})</strong> 에서 로딩 이벤트를 시작합니다.
 불러오기가 끝날 때 쯤에서 <strong>.do(onNext: { _ in output.isLoading.accept(false)})</strong> 에서 로딩 이벤트를 멈춥니다.
 저는 프로젝트 전반에서 이런직으로 로딩 이벤트를 수행해 왔습니다. 지금은 앱의 서비스 모델 DB에서 데이터를 읽어오지만 실제는 API 통신을 수행할 때 로딩을 시작 종료하며 사용하고 있습니다.
 그리고 output에 있는 저 로딩 객체는 ( **let isLoading = BehaviorRelay<Bool>(value: false)** ) 뷰 컨르롤러에서 subscribe해서 데이터가 변경될 때 마다 로딩 액션을 수행하고 있습니다.</Bool></p>

<div class="language-swift highlighter-rouge"><div class="highlight"><pre class="highlight"><code>     <span class="c1">/// Loading</span>
        <span class="kd">private</span> <span class="kd">func</span> <span class="nf">bindLoading</span><span class="p">()</span> <span class="p">{</span>
            <span class="k">guard</span> <span class="k">let</span> <span class="nv">viewModel</span> <span class="o">=</span> <span class="n">viewModel</span> <span class="k">else</span> <span class="p">{</span> <span class="k">return</span> <span class="p">}</span>
            <span class="n">viewModel</span><span class="o">.</span><span class="n">output</span><span class="o">.</span><span class="n">isLoading</span><span class="o">.</span><span class="nf">subscribe</span><span class="p">(</span><span class="nv">onNext</span><span class="p">:</span> <span class="p">{[</span><span class="k">weak</span> <span class="k">self</span><span class="p">]</span> <span class="n">isLoading</span> <span class="k">in</span>
                <span class="k">guard</span> <span class="kd">let</span> <span class="err">`</span><span class="k">self</span><span class="err">`</span> <span class="o">=</span> <span class="k">self</span> <span class="k">else</span> <span class="p">{</span> <span class="k">return</span> <span class="p">}</span>
                <span class="k">if</span> <span class="n">isLoading</span> <span class="p">{</span>
                    <span class="k">self</span><span class="o">.</span><span class="n">loadingNode</span><span class="o">.</span><span class="nf">startLoading</span><span class="p">(</span><span class="nv">node</span><span class="p">:</span> <span class="k">self</span><span class="o">.</span><span class="n">node</span><span class="p">)</span>
                <span class="p">}</span> <span class="k">else</span> <span class="p">{</span>
                    <span class="k">self</span><span class="o">.</span><span class="n">loadingNode</span><span class="o">.</span><span class="nf">stopLoading</span><span class="p">()</span>
                <span class="p">}</span>
            <span class="p">})</span><span class="o">.</span><span class="nf">disposed</span><span class="p">(</span><span class="nv">by</span><span class="p">:</span> <span class="n">disposeBag</span><span class="p">)</span>
        <span class="p">}</span>
</code></pre></div></div>
<p>그리고 주목해야 할 부분은 DB에서 꺼낸 ShoppingItme 배열을 다른 Rx 객체에 바로 bind해주는 부분입니다.</p>
<div class="language-swift highlighter-rouge"><div class="highlight"><pre class="highlight"><code>     <span class="o">.</span><span class="nf">bind</span><span class="p">(</span><span class="nv">to</span><span class="p">:</span> <span class="n">output</span><span class="o">.</span><span class="n">basketList</span><span class="p">)</span>
</code></pre></div></div>
<p>basketList에 들어가는 데이터는 <strong>bindUI</strong> 메소드에서 다시 UI로 바로 구성되게 되는데 내용은 아래와 같습니다.</p>

<div class="language-swift highlighter-rouge"><div class="highlight"><pre class="highlight"><code>    <span class="kd">private</span> <span class="kd">func</span> <span class="nf">bindUI</span><span class="p">(</span><span class="n">_</span> <span class="nv">provider</span><span class="p">:</span> <span class="kt">OpenitProvider</span><span class="o">&lt;</span><span class="kt">JuvisAPI</span><span class="o">&gt;</span><span class="p">,</span> <span class="nv">input</span><span class="p">:</span> <span class="kt">Input</span><span class="p">,</span> <span class="nv">output</span><span class="p">:</span> <span class="kt">Output</span><span class="p">)</span> <span class="p">{</span>

      <span class="n">input</span><span class="o">.</span><span class="n">cellAction</span>
      <span class="c1">// 셀 액션 부분</span>
      <span class="c1">// ...</span>
      <span class="p">})</span><span class="o">.</span><span class="nf">disposed</span><span class="p">(</span><span class="nv">by</span><span class="p">:</span> <span class="n">disposeBag</span><span class="p">)</span>

      <span class="n">output</span><span class="o">.</span><span class="n">basketList</span><span class="o">.</span><span class="nf">subscribe</span><span class="p">(</span><span class="nv">onNext</span><span class="p">:</span> <span class="p">{[</span><span class="k">weak</span> <span class="k">self</span><span class="p">]</span> <span class="n">list</span> <span class="k">in</span>
      <span class="c1">// UI 로직 부분</span>
      <span class="c1">// ...</span>
      <span class="p">})</span><span class="o">.</span><span class="nf">disposed</span><span class="p">(</span><span class="nv">by</span><span class="p">:</span> <span class="n">disposeBag</span><span class="p">)</span>

      <span class="c1">/// 아이템 제거</span>
      <span class="n">input</span><span class="o">.</span><span class="n">removeItem</span><span class="o">.</span><span class="nf">subscribe</span><span class="p">(</span><span class="nv">onNext</span><span class="p">:</span> <span class="p">{</span> <span class="n">item</span> <span class="k">in</span>
      <span class="c1">// 아이템 제거 이벤트</span>
      <span class="c1">// ...</span>
      <span class="p">})</span><span class="o">.</span><span class="nf">disposed</span><span class="p">(</span><span class="nv">by</span><span class="p">:</span> <span class="n">disposeBag</span><span class="p">)</span>

      <span class="c1">/// 금액 바인딩</span>
      <span class="kt">Observable</span>
      <span class="o">.</span><span class="nf">combineLatest</span><span class="p">(</span>
        <span class="c1">// 선택된 상품의 총 금액</span>
         <span class="n">output</span><span class="o">.</span><span class="n">productPrice</span><span class="p">,</span>
        <span class="c1">// 할인 금액</span>
         <span class="n">output</span><span class="o">.</span><span class="n">dicsountPrice</span><span class="p">,</span>
        <span class="c1">// 배송비</span>
         <span class="n">output</span><span class="o">.</span><span class="n">deliveryCharge</span>
      <span class="p">)</span>
      <span class="o">.</span><span class="n">map</span> <span class="p">{</span> <span class="p">(</span><span class="n">product</span><span class="p">,</span> <span class="n">discount</span><span class="p">,</span> <span class="n">delivery</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="kt">Int</span> <span class="k">in</span>
      <span class="k">return</span> <span class="n">product</span> <span class="o">-</span> <span class="n">discount</span> <span class="o">+</span> <span class="n">delivery</span>
      <span class="p">}</span><span class="o">.</span><span class="nf">bind</span><span class="p">(</span><span class="nv">to</span><span class="p">:</span> <span class="n">output</span><span class="o">.</span><span class="n">totalPrice</span><span class="p">)</span>
      <span class="o">.</span><span class="nf">disposed</span><span class="p">(</span><span class="nv">by</span><span class="p">:</span> <span class="n">disposeBag</span><span class="p">)</span>
    <span class="p">}</span>
</code></pre></div></div>
<p>전체 코드를 붙여넣으면 너무 길기 때문에 간단히 보면 Input의 데이터를 통해서 output의 데이터를 만들고 그 데이터를 실제 뷰에서 바인드해서 사용하고 있는 형태입니다.
 Rx에 대해서 이해하고 있으신 분들은 이 부분만 봐도 대부분 이해하셨을거 같습니다. UI 로직부분에서 아이템들을 가공해서 <strong>productPrice, dicsountPrice, deliveryCharge</strong> 를 만들고 그 데이터들을 <strong>.combineLatest</strong> 로 묶어서
<strong>totalPrice</strong> 를 생성하고 있습니다.</p>

<h3 id="끝으로">끝으로</h3>
<p>코드를 차근차근 읽어보시면 Input과 Output으로 모든 화면 구성이 끝난다는 것을 아실 수 있을 것입니다. 저는 MVVM을 만들면서 viewController에 변수를 최대한 없게 만드는 데 초점을 두고 구조를 잡았습니다. 처음 시작하시는 분들은 저처럼 헤매시지 않기를 바랍니다.</p>

                </div>
            </section>

            <!-- Email subscribe form at the bottom of the page -->
            

            <footer class="post-full-footer">
                <!-- Everything inside the #author tags pulls data from the author -->
                <!-- #author-->
                
                    
                
                    
                
                    
                
                    
                
                    
                
                    
                
                    
                
                <!-- /author  -->
            </footer>

            <!-- If you use Disqus comments, just uncomment this block.
            The only thing you need to change is "test-apkdzgmqhj" - which
            should be replaced with your own Disqus site-id. -->
            
                <section class="post-full-comments">
                    <div id="disqus_thread"></div>
                    <script>
                        var disqus_config = function () {
                            this.page.url = 'https://leejigun.github.io//';
                            this.page.identifier = 'iOS 삽질 블로그';
                        };
                        (function() {
                            var d = document, s = d.createElement('script');
                            s.src = 'https://jglee.disqus.com/embed.js';
                            s.setAttribute('data-timestamp', +new Date());
                            (d.head || d.body).appendChild(s);
                        })();
                    </script>
                </section>
            

        </article>

    </div>
</main>

<!-- Links to Previous/Next posts -->
<aside class="read-next outer">
    <div class="inner">
        <div class="read-next-feed">
            
                
                
                
                
                    <article class="read-next-card"
                        
                            style="background-image: url(/assets/images/blog-cover.jpg)"
                        
                    >
                        <header class="read-next-card-header">
                            <small class="read-next-card-header-sitetitle">&mdash; iOS 삽질 블로그 &mdash;</small>
                            
                                <h3 class="read-next-card-header-title"><a href="/tag/rxswift/">Rxswift</a></h3>
                            
                        </header>
                        <div class="read-next-divider"><svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M13 14.5s2 3 5 3 5.5-2.463 5.5-5.5S21 6.5 18 6.5c-5 0-7 11-12 11C2.962 17.5.5 15.037.5 12S3 6.5 6 6.5s4.5 3.5 4.5 3.5"/></svg>
</div>
                        <div class="read-next-card-content">
                            <ul>
                                
                                
                                  
                                
                                  
                                
                                  
                                
                                  
                                
                                  
                                
                                  
                                
                                  
                                
                                  
                                
                                  
                                
                                  
                                
                                  
                                
                                  
                                
                                  
                                
                                  
                                
                                  
                                
                                  
                                
                                  
                                
                                  
                                
                                  
                                
                                  
                                
                                  
                                
                                  
                                
                                  
                                
                                  
                                
                                  
                                
                                  
                                
                                  
                                
                                  
                                
                                  
                                
                                  
                                
                                  
                                
                                  
                                
                                  
                                
                                  
                                    
                                        
                                        
                                            <li><a href="/RxSwift+Moya+MVVM_1)">RxSwift+Moya+MVVM 1) 현업 RxSwift - 네트워킹 처리</a></li>
                                        
                                    
                                  
                                
                                  
                                
                                  
                                
                                  
                                    
                                  
                                
                                  
                                    
                                        
                                        
                                            <li><a href="/RxSwift_Deep_Cuts">RxSwift: Deep Cuts (번역)</a></li>
                                        
                                    
                                  
                                
                                  
                                    
                                        
                                        
                                            <li><a href="/Everyday_Reactive">Everyday Reactive (번역)</a></li>
                                        
                                    
                                  
                                
                                  
                                
                                  
                                
                                  
                                
                                  
                                
                                  
                                
                                  
                                
                                  
                                
                                  
                                
                                  
                                
                                  
                                
                                  
                                
                                  
                                
                                  
                                
                            </ul>
                        </div>
                        <footer class="read-next-card-footer">
                            <a href="/tag/rxswift/">
                                
                                    See all 3 posts  →
                                
                            </a>
                        </footer>
                    </article>
                
            

            <!-- If there's a next post, display it using the same markup included from - partials/post-card.hbs -->
            
                
    <article class="post-card post-template">
        
            <a class="post-card-image-link" href="/SwiftUI_Dribbble_challengesApp">
                <div class="post-card-image" style="background-image: url(/assets/images/SwiftUI/challengesApp.png)"></div>
            </a>
        
        <div class="post-card-content">
            <a class="post-card-content-link" href="/SwiftUI_Dribbble_challengesApp">
                <header class="post-card-header">
                    
                        
                            
                                <span class="post-card-tags">Swiftui</span>
                            
                        
                    

                    <h2 class="post-card-title">SwiftUI 화면 만들기 - Challenges App</h2>
                </header>
                <section class="post-card-excerpt">
                    <p># SwiftUI 화면 만들기 - Challenges App - 이미지 출처: https://dribbble.com/shots/7047168-Challenges-App ## 원본 ![](https://paper-attachments.dropbox.com/s_619B197BA64A8385C25262FF40C7091481BBE02E7B9BA78EA2EB3D5FB5A5ECE2_1566886774253_image.png) ---------- ## 1. 화면 분석 **상단** - 전형적인 SwiftUI의 네비게이션 뷰 형태 - 타이틀을 제외하고 오른쪽에 검색 버튼 **중단**</p>
                </section>
            </a>
            <footer class="post-card-meta">
                
                    
                
                    
                
                    
                
                    
                
                    
                
                    
                
                    
                
            </footer>
        </div>
    </article>

            

            <!-- If there's a previous post, display it using the same markup included from - partials/post-card.hbs -->
            
                
    <article class="post-card post-template">
        
            <a class="post-card-image-link" href="/RxSwift_Deep_Cuts">
                <div class="post-card-image" style="background-image: url(/assets/images/RxSwift/Deep_Cuts.png)"></div>
            </a>
        
        <div class="post-card-content">
            <a class="post-card-content-link" href="/RxSwift_Deep_Cuts">
                <header class="post-card-header">
                    
                        
                            
                                <span class="post-card-tags">Rxswift</span>
                            
                        
                    

                    <h2 class="post-card-title">RxSwift: Deep Cuts (번역)</h2>
                </header>
                <section class="post-card-excerpt">
                    <p>RxSwift: Deep Cuts 지난 몇년간, 반응형 프로그래밍 아이디어들은 iOS커뮤니티를 사로잡았습니다. 조금 열기가 가라앉은 지금, 우리는 때때로 혼란스럽고 읽을 수 없는 코드를 접하기 시작하고 있습니다. 하지만 이러한 중대한 책임을 어떻게 감당할 수 있을까요? 제</p>
                </section>
            </a>
            <footer class="post-card-meta">
                
                    
                
                    
                
                    
                
                    
                
                    
                
                    
                
                    
                
            </footer>
        </div>
    </article>

            

        </div>
    </div>
</aside>

<!-- Floating header which appears on-scroll, included from includes/floating-header.hbs -->
<div class="floating-header">
    <div class="floating-header-logo">
        <a href="https://leejigun.github.io//">
            
                <img src="/assets/images/blog-icon.png" alt="iOS 삽질 블로그 icon" />
            
            <span>iOS 삽질 블로그</span>
        </a>
    </div>
    <span class="floating-header-divider">&mdash;</span>
    <div class="floating-header-title">RxSwift MVVM 실무 적용</div>
    <div class="floating-header-share">
        <div class="floating-header-share-label">Share this <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24">
    <path d="M7.5 15.5V4a1.5 1.5 0 1 1 3 0v4.5h2a1 1 0 0 1 1 1h2a1 1 0 0 1 1 1H18a1.5 1.5 0 0 1 1.5 1.5v3.099c0 .929-.13 1.854-.385 2.748L17.5 23.5h-9c-1.5-2-5.417-8.673-5.417-8.673a1.2 1.2 0 0 1 1.76-1.605L7.5 15.5zm6-6v2m-3-3.5v3.5m6-1v2"/>
</svg>
</div>
        <a class="floating-header-share-tw" href="https://twitter.com/share?text=RxSwift+MVVM+%EC%8B%A4%EB%AC%B4+%EC%A0%81%EC%9A%A9&amp;url=https://leejigun.github.io/RxSwift_MVVM"
            onclick="window.open(this.href, 'share-twitter', 'width=550,height=235');return false;">
            <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 32 32"><path d="M30.063 7.313c-.813 1.125-1.75 2.125-2.875 2.938v.75c0 1.563-.188 3.125-.688 4.625a15.088 15.088 0 0 1-2.063 4.438c-.875 1.438-2 2.688-3.25 3.813a15.015 15.015 0 0 1-4.625 2.563c-1.813.688-3.75 1-5.75 1-3.25 0-6.188-.875-8.875-2.625.438.063.875.125 1.375.125 2.688 0 5.063-.875 7.188-2.5-1.25 0-2.375-.375-3.375-1.125s-1.688-1.688-2.063-2.875c.438.063.813.125 1.125.125.5 0 1-.063 1.5-.25-1.313-.25-2.438-.938-3.313-1.938a5.673 5.673 0 0 1-1.313-3.688v-.063c.813.438 1.688.688 2.625.688a5.228 5.228 0 0 1-1.875-2c-.5-.875-.688-1.813-.688-2.75 0-1.063.25-2.063.75-2.938 1.438 1.75 3.188 3.188 5.25 4.25s4.313 1.688 6.688 1.813a5.579 5.579 0 0 1 1.5-5.438c1.125-1.125 2.5-1.688 4.125-1.688s3.063.625 4.188 1.813a11.48 11.48 0 0 0 3.688-1.375c-.438 1.375-1.313 2.438-2.563 3.188 1.125-.125 2.188-.438 3.313-.875z"/></svg>

        </a>
        <a class="floating-header-share-fb" href="https://www.facebook.com/sharer/sharer.php?u=https://leejigun.github.io/RxSwift_MVVM"
            onclick="window.open(this.href, 'share-facebook','width=580,height=296');return false;">
            <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 32 32"><path d="M19 6h5V0h-5c-3.86 0-7 3.14-7 7v3H8v6h4v16h6V16h5l1-6h-6V7c0-.542.458-1 1-1z"/></svg>

        </a>
    </div>
    <progress class="progress" value="0">
        <div class="progress-container">
            <span class="progress-bar"></span>
        </div>
    </progress>
</div>


<!-- /post -->

<!-- The #contentFor helper here will send everything inside it up to the matching #block helper found in default.hbs -->


        <!-- Previous/next page links - displayed on every page -->
        

        <!-- The footer at the very bottom of the screen -->
        <footer class="site-footer outer">
            <div class="site-footer-content inner">
                <section class="copyright"><a href="https://leejigun.github.io//">iOS 삽질 블로그</a> &copy; 2020</section>
                <section class="poweredby">Github page blog of <a href="https://github.com/Leejigun">Leejigun</a> &
                    <a href="https://pages.github.com/" target="_blank" rel="noopener">GitHub Pages</a> using
                    <a href="https://github.com/jekyller/jasper2" target="_blank" rel="noopener">Jasper2</a></section>
                <nav class="site-footer-nav">
                    <a href="/">Latest Posts</a>
                    
                    
                    <!-- <a href="https://ghost.org" target="_blank" rel="noopener">Ghost</a> -->
                </nav>
            </div>
        </footer>

    </div>

    <!-- The big email subscribe modal content -->
    

    <!-- highlight.js -->
    <script src="https://cdnjs.cloudflare.com/ajax/libs/prism/1.10.0/components/prism-abap.min.js"></script>
    <script>$(document).ready(function() {
      $('pre code').each(function(i, block) {
        hljs.highlightBlock(block);
      });
    });</script>

    <!-- jQuery + Fitvids, which makes all video embeds responsive -->
    <script
        src="https://code.jquery.com/jquery-3.2.1.min.js"
        integrity="sha256-hwg4gsxgFZhOsEEamdOYGBf13FyQuiTwlAQgxVSNgt4="
        crossorigin="anonymous">
    </script>
    <script type="text/javascript" src="/assets/js/jquery.fitvids.js"></script>
    <script type="text/javascript" src="https://demo.ghost.io/assets/js/jquery.fitvids.js?v=724281a32e"></script>


    <!-- Paginator increased to "infinit" in _config.yml -->
    <!-- if paginator.posts  -->
    <!-- <script>
        var maxPages = parseInt('');
    </script>
    <script src="/assets/js/infinitescroll.js"></script> -->
    <!-- /endif -->

    


    <!-- Add Google Analytics  -->
    <!-- Google Analytics Tracking code -->
 <script>
  (function(i,s,o,g,r,a,m){i['GoogleAnalyticsObject']=r;i[r]=i[r]||function(){
  (i[r].q=i[r].q||[]).push(arguments)},i[r].l=1*new Date();a=s.createElement(o),
  m=s.getElementsByTagName(o)[0];a.async=1;a.src=g;m.parentNode.insertBefore(a,m)
  })(window,document,'script','//www.google-analytics.com/analytics.js','ga');

  ga('create', 'UA-154736789-1', 'auto');
  ga('send', 'pageview');

 </script>


    <!-- The #block helper will pull in data from the #contentFor other template files. In this case, there's some JavaScript which we only want to use in post.hbs, but it needs to be included down here, after jQuery has already loaded. -->
    
        <script>

// NOTE: Scroll performance is poor in Safari
// - this appears to be due to the events firing much more slowly in Safari.
//   Dropping the scroll event and using only a raf loop results in smoother
//   scrolling but continuous processing even when not scrolling
$(document).ready(function () {
    // Start fitVids
    var $postContent = $(".post-full-content");
    $postContent.fitVids();
    // End fitVids

    var progressBar = document.querySelector('progress');
    var header = document.querySelector('.floating-header');
    var title = document.querySelector('.post-full-title');

    var lastScrollY = window.scrollY;
    var lastWindowHeight = window.innerHeight;
    var lastDocumentHeight = $(document).height();
    var ticking = false;

    function onScroll() {
        lastScrollY = window.scrollY;
        requestTick();
    }

    function onResize() {
        lastWindowHeight = window.innerHeight;
        lastDocumentHeight = $(document).height();
        requestTick();
    }

    function requestTick() {
        if (!ticking) {
            requestAnimationFrame(update);
        }
        ticking = true;
    }

    function update() {
        var trigger = title.getBoundingClientRect().top + window.scrollY;
        var triggerOffset = title.offsetHeight + 35;
        var progressMax = lastDocumentHeight - lastWindowHeight;

        // show/hide floating header
        if (lastScrollY >= trigger + triggerOffset) {
            header.classList.add('floating-active');
        } else {
            header.classList.remove('floating-active');
        }

        progressBar.setAttribute('max', progressMax);
        progressBar.setAttribute('value', lastScrollY);

        ticking = false;
    }

    window.addEventListener('scroll', onScroll, {passive: true});
    window.addEventListener('resize', onResize, false);

    update();
});
</script>

    

    <!-- Ghost outputs important scripts and data with this tag - it should always be the very last thing before the closing body tag -->
    <!-- ghost_foot -->

</body>
</html>
