<!-- footer도 여기에 있음 -->


<!DOCTYPE html>
<html>
<head>

    <!-- Document Settings -->
    <meta charset="utf-8" />
    <meta http-equiv="X-UA-Compatible" content="IE=edge" />

    <!-- Base Meta -->
    <!-- iOS-tip 이라고 태그를 만들었으면 post에서는 iOS tip 이라고 태그를 줘야한다. -->
<!-- dynamically fixing the title for tag/author pages -->



    <title>Swift Moya Provider 커스텀</title>
    <meta name="HandheldFriendly" content="True" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <!-- Styles'n'Scripts -->
    <link rel="stylesheet" type="text/css" href="/assets/built/screen.css" />
    <link rel="stylesheet" type="text/css" href="/assets/built/screen.edited.css" />
    <link rel="stylesheet" type="text/css" href="/assets/built/syntax.css" />
    <!-- highlight.js -->
    <link rel="stylesheet" href="//cdnjs.cloudflare.com/ajax/libs/highlight.js/9.12.0/styles/default.min.css">
    <style>.hljs { background: none; }</style>

    <!-- This tag outputs SEO meta+structured data and other important settings -->
    <meta name="description" content="Swift Moya Provider 커스텀" />
    <link rel="shortcut icon" href="https://leejigun.github.io//assets/images/blog-icon.png" type="image/png" />
    <link rel="canonical" href="https://leejigun.github.io//Swift_Moya_Provider_custom" />
    <meta name="referrer" content="no-referrer-when-downgrade" />

     <!--title below is coming from _includes/dynamic_title-->
    <meta property="og:site_name" content="iOS 삽질 블로그" />
    <meta property="og:type" content="website" />
    <meta property="og:title" content="Swift Moya Provider 커스텀" />
    <meta property="og:description" content="Swift Moya Provider 커스텀 예전에 Moya + RxSwift에 대한 포스트를 올린적이 있었는데, 이번에는 제가 프로젝트에서 사용하고 있는 Moya Provider를 커스텀 한 내용을 공유하고자 합니다. Plugins moya plugun : https://github.com/Moya/Moya/blob/master/docs/Plugins.md Moya 는 기본적으로 Target 을 정의하고 Provider 를 만들어 그 Provider 를 사용해 통신하는 방법으로 네트워크 프레임 워크를 구현하고 있습니다. 이것저것" />
    <meta property="og:url" content="https://leejigun.github.io//Swift_Moya_Provider_custom" />
    <meta property="og:image" content="https://leejigun.github.io//assets/images/ios_tips/moya.png" />
    <meta property="article:publisher" content="https://www.facebook.com/" />
    <meta property="article:author" content="https://www.facebook.com/" />
    <meta property="article:published_time" content="2019-09-05T09:00:01+09:00" />
    <meta property="article:modified_time" content="2019-09-05T09:00:01+09:00" />
    <meta property="article:tag" content="Ios Tip" />
    <meta name="twitter:card" content="summary_large_image" />
    <meta name="twitter:title" content="Swift Moya Provider 커스텀" />
    <meta name="twitter:description" content="Swift Moya Provider 커스텀 예전에 Moya + RxSwift에 대한 포스트를 올린적이 있었는데, 이번에는 제가 프로젝트에서 사용하고 있는 Moya Provider를 커스텀 한 내용을 공유하고자 합니다. Plugins moya plugun : https://github.com/Moya/Moya/blob/master/docs/Plugins.md Moya 는 기본적으로 Target 을 정의하고 Provider 를 만들어 그 Provider 를 사용해 통신하는 방법으로 네트워크 프레임 워크를 구현하고 있습니다. 이것저것" />
    <meta name="twitter:url" content="https://leejigun.github.io//" />
    <meta name="twitter:image" content="https://leejigun.github.io//assets/images/ios_tips/moya.png" />
    <meta name="twitter:label1" content="Written by" />
    <meta name="twitter:data1" content="iOS 삽질 블로그" />
    <meta name="twitter:label2" content="Filed under" />
    <meta name="twitter:data2" content="Ios Tip" />
    <meta name="twitter:site" content="@" />
    <meta name="twitter:creator" content="@" />
    <meta property="og:image:width" content="1400" />
    <meta property="og:image:height" content="933" />

    <script type="application/ld+json">
{
    "@context": "https://schema.org",
    "@type": "Website",
    "publisher": {
        "@type": "Organization",
        "name": "iOS 삽질 블로그",
        "logo": "https://leejigun.github.io//assets/images/blog-icon.png"
    },
    "url": "https://leejigun.github.io//Swift_Moya_Provider_custom",
    "image": {
        "@type": "ImageObject",
        "url": "https://leejigun.github.io//assets/images/ios_tips/moya.png",
        "width": 2000,
        "height": 666
    },
    "mainEntityOfPage": {
        "@type": "WebPage",
        "@id": "https://leejigun.github.io//Swift_Moya_Provider_custom"
    },
    "description": "Swift Moya Provider 커스텀 예전에 Moya + RxSwift에 대한 포스트를 올린적이 있었는데, 이번에는 제가 프로젝트에서 사용하고 있는 Moya Provider를 커스텀 한 내용을 공유하고자 합니다. Plugins moya plugun : https://github.com/Moya/Moya/blob/master/docs/Plugins.md Moya 는 기본적으로 Target 을 정의하고 Provider 를 만들어 그 Provider 를 사용해 통신하는 방법으로 네트워크 프레임 워크를 구현하고 있습니다. 이것저것"
}
    </script>

    <!-- <script type="text/javascript" src="https://demo.ghost.io/public/ghost-sdk.min.js?v=724281a32e"></script>
    <script type="text/javascript">
    ghost.init({
    	clientId: "ghost-frontend",
    	clientSecret: "f84a07a72b17"
    });
    </script> -->

    <meta name="generator" content="Jekyll 3.6.2" />
    <link rel="alternate" type="application/rss+xml" title="Swift Moya Provider 커스텀" href="/feed.xml" />


</head>
<body class="post-template">

    <div class="site-wrapper">
        <!-- All the main content gets inserted here, index.hbs, post.hbs, etc -->

        <!-- HTML elements for search -->

        <!-- default -->

<!-- The tag above means: insert everything in this file
into the {body} of the default.hbs template -->

<header class="site-header outer">
    <div class="inner">
        <!-- 네비게이션 바 -->
<nav class="site-nav">
    <div class="site-nav-left">
        
            
                <a class="site-nav-logo" href="https://leejigun.github.io//"><img src="/assets/images/blog-icon.png" alt="iOS 삽질 블로그" /></a>
            
        
        
            <!-- 여기서 navigation 에 표시할 이이템 추가 -->
<ul class="nav" role="menu">
    <li class="nav-home" role="menuitem"><a href="/">Home</a></li>
    <li class="nav-about" role="menuitem"><a href="/about/">About</a></li>
    <li class="nav-getting-started" role="menuitem"><a href="/tag/ios-tip/">iOS tip</a></li>
    <li class="nav-getting-started" role="menuitem"><a href="/tag/watchos/">watchOS</a></li>
    <li class="nav-getting-started" role="menuitem"><a href="/tag/rxswift/">RxSwift</a></li>
    <li class="nav-getting-started" role="menuitem"><a href="/tag/swiftui/">swiftui</a></li>
    <li class="nav-getting-started" role="menuitem"><a href="/tag/project/">project</a></li>
    <li class="nav-getting-started" role="menuitem"><a href="/tag/ml/">ML</a></li>
    <li class="nav-try-ghost" role="menuitem"><a href="https://github.com/Leejigun">github</a></li>
    <li class="nav-try-ghost" role="menuitem"><a href="/search.html">Search</a></li>
</ul>

        
    </div>
    <div class="site-nav-right">
        <div class="social-links">
            
            
        </div>
        
    </div>
</nav>

    </div>
</header>

<!-- Everything inside the #post tags pulls data from the post -->
<!-- #post -->

<main id="site-main" class="site-main outer" role="main">
    <div class="inner">

        <article class="post-full post tag-getting-started ">

            <header class="post-full-header">
                <section class="post-full-meta">
                    <time class="post-full-meta-date" datetime=" 5 September 2019"> 5 September 2019</time>
                    
                        <span class="date-divider">/</span>
                        
                            
                               <a href='/tag/ios-tip/'>IOS TIP</a>
                            
                        
                    
                </section>
                <h1 class="post-full-title">Swift Moya Provider 커스텀</h1>
            </header>

            
            <figure class="post-full-image" style="background-image: url(/assets/images/ios_tips/moya.png)">
            </figure>
            

            <section class="post-full-content">
                <div class="kg-card-markdown">
                    <h1 id="swift-moya-provider-커스텀">Swift Moya Provider 커스텀</h1>
<p>예전에 Moya + RxSwift에 대한 포스트를 올린적이 있었는데, 이번에는 제가 프로젝트에서 사용하고 있는 Moya Provider를 커스텀 한 내용을 공유하고자 합니다.</p>

<h2 id="plugins">Plugins</h2>
<ul>
  <li>
    <p>moya plugun : https://github.com/Moya/Moya/blob/master/docs/Plugins.md</p>

    <p><strong>Moya</strong> 는 기본적으로 <strong>Target</strong> 을 정의하고 <strong>Provider</strong> 를 만들어 그 <strong>Provider</strong> 를 사용해 통신하는 방법으로 네트워크 프레임 워크를 구현하고 있습니다. 이것저것 기타 정보들은 타겟에 정의하고 밑에서는 <strong>Provider</strong> 를 사용해서 접근하게 되는데, 처음에 사용할 때에는 크게 문제없지만 규모가 커지면 어쩔 수 없이 <strong>Provider</strong> 를 커스텀 하는 단계까지 도달하게 됩니다. 그중 대부분의 사용자가 편리한 기능들을 추가할 때 사용하는 부분이 바로 플러그인입니다.  먼저 제가 사용하고 있는 <strong>Provider</strong> 의 전체 코드를 보여드리고 밑에서 하나하나 뜯어보겠습니다.</p>
  </li>
</ul>

<div class="language-swift highlighter-rouge"><div class="highlight"><pre class="highlight"><code>    <span class="kd">class</span> <span class="kt">OpenitProvider</span><span class="o">&lt;</span><span class="kt">T</span><span class="p">:</span><span class="kt">TargetType</span><span class="o">&gt;</span><span class="p">:</span> <span class="kt">MoyaProvider</span><span class="o">&lt;</span><span class="kt">T</span><span class="o">&gt;</span> <span class="p">{</span>
      <span class="nf">init</span><span class="p">(</span><span class="nv">stubClosure</span><span class="p">:</span> <span class="kd">@escaping</span> <span class="kt">StubClosure</span> <span class="o">=</span> <span class="kt">MoyaProvider</span><span class="o">.</span><span class="n">neverStub</span><span class="p">)</span> <span class="p">{</span>
        <span class="c1">/// NetworkActivityPlugin</span>
        <span class="k">let</span> <span class="nv">networkClosure</span> <span class="o">=</span> <span class="p">{(</span><span class="n">_</span> <span class="nv">change</span><span class="p">:</span> <span class="kt">NetworkActivityChangeType</span><span class="p">,</span> <span class="n">_</span> <span class="nv">target</span><span class="p">:</span> <span class="kt">TargetType</span><span class="p">)</span> <span class="k">in</span>
          <span class="k">switch</span> <span class="n">change</span> <span class="p">{</span>
            <span class="k">case</span> <span class="o">.</span><span class="nv">began</span><span class="p">:</span>
            <span class="kt">UIApplication</span><span class="o">.</span><span class="n">shared</span><span class="o">.</span><span class="n">isNetworkActivityIndicatorVisible</span> <span class="o">=</span> <span class="kc">true</span>
            <span class="k">case</span> <span class="o">.</span><span class="nv">ended</span><span class="p">:</span>
            <span class="kt">UIApplication</span><span class="o">.</span><span class="n">shared</span><span class="o">.</span><span class="n">isNetworkActivityIndicatorVisible</span> <span class="o">=</span> <span class="kc">false</span>
          <span class="p">}</span>
        <span class="p">}</span>
        <span class="c1">//Your custom configuration</span>
        <span class="k">let</span> <span class="nv">configuration</span> <span class="o">=</span> <span class="kt">URLSessionConfiguration</span><span class="o">.</span><span class="k">default</span>
        <span class="n">configuration</span><span class="o">.</span><span class="n">httpAdditionalHeaders</span> <span class="o">=</span> <span class="kt">Manager</span><span class="o">.</span><span class="n">defaultHTTPHeaders</span>
        <span class="c1">///Add the network logger on the configuration</span>
        <span class="c1">//For Alamofire</span>
        <span class="k">let</span> <span class="nv">manager</span> <span class="o">=</span> <span class="kt">Manager</span><span class="p">(</span><span class="nv">configuration</span><span class="p">:</span> <span class="n">configuration</span><span class="p">)</span>
        <span class="n">manager</span><span class="o">.</span><span class="n">startRequestsImmediately</span> <span class="o">=</span> <span class="kc">false</span>
        <span class="c1">// make provider</span>
        <span class="k">super</span><span class="o">.</span><span class="nf">init</span><span class="p">(</span><span class="nv">stubClosure</span><span class="p">:</span> <span class="n">stubClosure</span><span class="p">,</span>
                   <span class="nv">manager</span><span class="p">:</span> <span class="n">manager</span><span class="p">,</span>
                   <span class="nv">plugins</span><span class="p">:</span> <span class="p">[</span><span class="kt">APILoggingPlugin</span><span class="p">(),</span>
                            <span class="kt">NetworkActivityPlugin</span><span class="p">(</span><span class="nv">networkActivityClosure</span><span class="p">:</span> <span class="n">networkClosure</span><span class="p">)])</span>
      <span class="p">}</span>
    <span class="p">}</span>
</code></pre></div></div>

<hr />
<h2 id="networkactivityplugin">NetworkActivityPlugin</h2>

<p>Moya를 사용하면서 가장 먼저 부딪치는 문제로 Network Activity Indicator 문제일 겁니다. Alamofire나 다른 통신 방법들을 사용하면 공통 메소드를 만들어 간단하게 처리할 수 있는데, 저는 RxSwift와 Moya를 사용하는 케이스라 이게 공통으로 만들어서 쓰기 번거로웠습니다.
  처음 Moya와 RxSwift를 함께 사용했을 때에는 api 호출 전에 <strong>do(onNext)</strong> 에서 시작하고 종료하는 로직을 추가해서 사용했었는데, 이게 하나하나 추가해서 쓰는 게 여간 불편한 게 아녔습니다. 그래서 처음에 plugin이 있는지도 모르고 쓰고 있다가 moya 문서에서 plugin 내용을 발견했습니다. 문서 하단에 아주 친절하게 나와 있었습니다.</p>

<hr />

<p><strong>Network Activity Indicator</strong>
One very common task with iOS networking is to show a network activity indicator during network requests, and remove it when all requests have finished. The provided plugin adds callbacks which are called when a requests starts and finishes, which can be used to keep track of the number of requests in progress, and show / hide the network activity indicator accordingly.
The plugin can be found at <code class="highlighter-rouge">[Sources/Moya/Plugins/NetworkActivityPlugin.swift](https://github.com/Moya/Moya/blob/master/Sources/Moya/Plugins/NetworkActivityPlugin.swift)</code></p>

<hr />

<p>덕분에 쉽게 사용 예시들을 찾아서 추가했는데 그 내용이 이 코드입니다.</p>

<div class="language-swift highlighter-rouge"><div class="highlight"><pre class="highlight"><code>    <span class="c1">/// NetworkActivityPlugin</span>
    <span class="k">let</span> <span class="nv">networkClosure</span> <span class="o">=</span> <span class="p">{(</span><span class="n">_</span> <span class="nv">change</span><span class="p">:</span> <span class="kt">NetworkActivityChangeType</span><span class="p">,</span> <span class="n">_</span> <span class="nv">target</span><span class="p">:</span> <span class="kt">TargetType</span><span class="p">)</span> <span class="k">in</span>
      <span class="k">switch</span> <span class="n">change</span> <span class="p">{</span>
        <span class="k">case</span> <span class="o">.</span><span class="nv">began</span><span class="p">:</span>
          <span class="kt">UIApplication</span><span class="o">.</span><span class="n">shared</span><span class="o">.</span><span class="n">isNetworkActivityIndicatorVisible</span> <span class="o">=</span> <span class="kc">true</span>
        <span class="k">case</span> <span class="o">.</span><span class="nv">ended</span><span class="p">:</span>
          <span class="kt">UIApplication</span><span class="o">.</span><span class="n">shared</span><span class="o">.</span><span class="n">isNetworkActivityIndicatorVisible</span> <span class="o">=</span> <span class="kc">false</span>
      <span class="p">}</span>
    <span class="p">}</span>

    <span class="kt">NetworkActivityPlugin</span><span class="p">(</span><span class="nv">networkActivityClosure</span><span class="p">:</span> <span class="n">networkClosure</span><span class="p">)</span>
</code></pre></div></div>
<p>네트워크 클로저에서는 이것 말고도 여러 작업을 할 수 있습니다. 따로 설명 없이도 쉽게 이해하실 수 있겠지만 내용을 보시면 네트워크 began일 때 네트워크 인디케이터를 돌리고 ended일 때 멈춥니다. 그리고 그 클로져를 <strong>NetworkActivityPlugin</strong> 에 집어넣어 <strong>Provider</strong> 를 만들어줍니다.</p>

<h2 id="logging-plugin">Logging Plugin</h2>

<p>처음으로 <strong>Provider</strong> 를 확장해서 사용해보고 <strong>Plugin</strong> 의 존재를 알게 되고 이것저것 시험해봤습니다. 무엇을 할 수 있을까 고민하다가 다음으로 시도한 게 Logging입니다. 저희 프로젝트에서는 항상 Header에 사용자 정보를 담아서 API를 주고받고 있습니다. 근데 이게 잘못된 경우도 쉽게 알게 하기 위해서 통신 부분만 플러그인으로 로그를 찍어보기로 했습니다.
  문서를 보면 기본적으로 네트워크 로깅을 지원합니다.</p>

<hr />

<p><strong>Logging</strong>
During development it can be very useful to log network activity to the console. This can be anything from the URL of a request as sent and received, to logging full headers, method, request body on each request and response.
The provided plugin for logging is the most complex of the provided plugins, and can be configured to suit the amount of logging your app (and build type) require. When initializing the plugin, you can choose options for verbosity, whether to log curl commands, and provide functions for outputting data (useful if you are using your own log framework instead of <code class="highlighter-rouge">print</code>) and formatting data before printing (by default the response will be converted to a String using <code class="highlighter-rouge">String.Encoding.utf8</code> but if you’d like to convert to pretty-printed JSON for your responses you can pass in a formatter function, see the function <code class="highlighter-rouge">JSONResponseDataFormatter</code> in <code class="highlighter-rouge">[Examples/_shared/GitHubAPI.swift](https://github.com/Moya/Moya/blob/master/Examples/_shared/GitHubAPI.swift)</code> for an example that does exactly that)
The plugin can be found at <code class="highlighter-rouge">[Sources/Moya/Plugins/NetworkLoggerPlugin.swift](https://github.com/Moya/Moya/blob/master/Sources/Moya/Plugins/NetworkLoggerPlugin.swift)</code></p>

<hr />

<p>하지만 로깅을 찍는 결과가 제가 원하는 형태가 아니라서 너무 보기 불편해 커스텀 플러그인을 만들어서 사용하기로 했습니다.
  커스텀 플러그인을 만들려면 PluginType 을 구현해야 합니다.</p>
<div class="language-swift highlighter-rouge"><div class="highlight"><pre class="highlight"><code>    <span class="kd">public</span> <span class="kd">protocol</span> <span class="kt">PluginType</span> <span class="p">{</span>
      <span class="kd">func</span> <span class="nf">prepare</span><span class="p">(</span><span class="n">_</span> <span class="nv">request</span><span class="p">:</span> <span class="kt">URLRequest</span><span class="p">,</span> <span class="nv">target</span><span class="p">:</span> <span class="kt">TargetType</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="kt">URLRequest</span>
      <span class="kd">func</span> <span class="nf">willSend</span><span class="p">(</span><span class="n">_</span> <span class="nv">request</span><span class="p">:</span> <span class="kt">RequestType</span><span class="p">,</span> <span class="nv">target</span><span class="p">:</span> <span class="kt">TargetType</span><span class="p">)</span>
      <span class="kd">func</span> <span class="nf">didReceive</span><span class="p">(</span><span class="n">_</span> <span class="nv">result</span><span class="p">:</span> <span class="kt">Result</span><span class="o">&lt;</span><span class="kt">Moya</span><span class="o">.</span><span class="kt">Response</span><span class="p">,</span> <span class="kt">MoyaError</span><span class="o">&gt;</span><span class="p">,</span> <span class="nv">target</span><span class="p">:</span> <span class="kt">TargetType</span><span class="p">)</span>
      <span class="kd">func</span> <span class="nf">process</span><span class="p">(</span><span class="n">_</span> <span class="nv">result</span><span class="p">:</span> <span class="kt">Result</span><span class="o">&lt;</span><span class="kt">Moya</span><span class="o">.</span><span class="kt">Response</span><span class="p">,</span> <span class="kt">MoyaError</span><span class="o">&gt;</span><span class="p">,</span> <span class="nv">target</span><span class="p">:</span> <span class="kt">TargetType</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="kt">Result</span><span class="o">&lt;</span><span class="kt">Moya</span><span class="o">.</span><span class="kt">Response</span><span class="p">,</span> <span class="kt">MoyaError</span><span class="o">&gt;</span>
    <span class="p">}</span>
</code></pre></div></div>
<p>메소드를 보면 아시겠지만 api 실행 전에 보내는 것의 로그를 찍고 api의 response를 받은 후에 그 내용을 찍으면 끝이기 때문에 <strong>willSend</strong> 와 <strong>didReceive</strong> 를 구현해주면 됩니다.</p>

<div class="language-swift highlighter-rouge"><div class="highlight"><pre class="highlight"><code>    <span class="kd">final</span> <span class="kd">class</span> <span class="kt">APILoggingPlugin</span><span class="p">:</span> <span class="kt">PluginType</span> <span class="p">{</span>
      <span class="c1">/// API를 보내기 직전에 호출</span>
      <span class="kd">func</span> <span class="nf">willSend</span><span class="p">(</span><span class="n">_</span> <span class="nv">request</span><span class="p">:</span> <span class="kt">RequestType</span><span class="p">,</span> <span class="nv">target</span><span class="p">:</span> <span class="kt">TargetType</span><span class="p">)</span> <span class="p">{</span>
        <span class="k">let</span> <span class="nv">headers</span> <span class="o">=</span> <span class="n">request</span><span class="o">.</span><span class="n">request</span><span class="p">?</span><span class="o">.</span><span class="n">allHTTPHeaderFields</span> <span class="p">??</span> <span class="p">[:]</span>
        <span class="k">let</span> <span class="nv">url</span> <span class="o">=</span> <span class="n">request</span><span class="o">.</span><span class="n">request</span><span class="p">?</span><span class="o">.</span><span class="n">url</span><span class="p">?</span><span class="o">.</span><span class="n">absoluteString</span> <span class="p">??</span> <span class="s">"nil"</span>
        <span class="k">let</span> <span class="nv">path</span> <span class="o">=</span> <span class="n">url</span><span class="o">.</span><span class="nf">replacingOccurrences</span><span class="p">(</span><span class="nv">of</span><span class="p">:</span> <span class="s">"</span><span class="se">\(</span><span class="n">juvisAPIbaseURL</span><span class="se">)</span><span class="s">"</span><span class="p">,</span> <span class="nv">with</span><span class="p">:</span> <span class="s">""</span><span class="p">)</span>
        <span class="k">if</span> <span class="k">let</span> <span class="nv">body</span> <span class="o">=</span> <span class="n">request</span><span class="o">.</span><span class="n">request</span><span class="p">?</span><span class="o">.</span><span class="n">httpBody</span> <span class="p">{</span>
          <span class="k">let</span> <span class="nv">bodyString</span> <span class="o">=</span> <span class="kt">String</span><span class="p">(</span><span class="nv">bytes</span><span class="p">:</span> <span class="n">body</span><span class="p">,</span> <span class="nv">encoding</span><span class="p">:</span> <span class="kt">String</span><span class="o">.</span><span class="kt">Encoding</span><span class="o">.</span><span class="n">utf8</span><span class="p">)</span> <span class="p">??</span> <span class="s">"nil"</span>
          <span class="nf">logInfo</span><span class="p">(</span><span class="s">"""
                  &lt;willSend - </span><span class="se">\(</span><span class="n">path</span><span class="se">)</span><span class="s"> - </span><span class="se">\(</span><span class="kt">Date</span><span class="p">()</span><span class="o">.</span><span class="n">debugDescription</span><span class="se">)</span><span class="s">&gt;
                  url: </span><span class="se">\(</span><span class="n">url</span><span class="se">)</span><span class="s">
                  headers : </span><span class="se">\(</span><span class="n">headers</span><span class="se">)</span><span class="s">
                  body: </span><span class="se">\(</span><span class="n">bodyString</span><span class="se">)</span><span class="s">
          """</span><span class="p">)</span>
        <span class="p">}</span> <span class="k">else</span> <span class="p">{</span>
          <span class="nf">logInfo</span><span class="p">(</span><span class="s">"""
                  &lt;willSend - </span><span class="se">\(</span><span class="n">path</span><span class="se">)</span><span class="s"> - </span><span class="se">\(</span><span class="kt">Date</span><span class="p">()</span><span class="o">.</span><span class="n">debugDescription</span><span class="se">)</span><span class="s">&gt;
                  url: </span><span class="se">\(</span><span class="n">url</span><span class="se">)</span><span class="s">
                  headers : </span><span class="se">\(</span><span class="n">headers</span><span class="se">)</span><span class="s">
                  body: nil
          """</span><span class="p">)</span>
        <span class="p">}</span>
      <span class="p">}</span>

      <span class="c1">/// API Response</span>
      <span class="kd">func</span> <span class="nf">didReceive</span><span class="p">(</span><span class="n">_</span> <span class="nv">result</span><span class="p">:</span> <span class="kt">Result</span><span class="o">&lt;</span><span class="kt">Response</span><span class="p">,</span> <span class="kt">MoyaError</span><span class="o">&gt;</span><span class="p">,</span> <span class="nv">target</span><span class="p">:</span> <span class="kt">TargetType</span><span class="p">)</span> <span class="p">{</span>
        <span class="k">let</span> <span class="nv">response</span> <span class="o">=</span> <span class="n">result</span><span class="o">.</span><span class="n">value</span>
        <span class="k">let</span> <span class="nv">error</span> <span class="o">=</span> <span class="n">result</span><span class="o">.</span><span class="n">error</span>
        <span class="k">let</span> <span class="nv">request</span> <span class="o">=</span> <span class="n">response</span><span class="p">?</span><span class="o">.</span><span class="n">request</span>
        <span class="k">let</span> <span class="nv">url</span> <span class="o">=</span> <span class="n">request</span><span class="p">?</span><span class="o">.</span><span class="n">url</span><span class="p">?</span><span class="o">.</span><span class="n">absoluteString</span> <span class="p">??</span> <span class="s">"nil"</span>
        <span class="k">let</span> <span class="nv">method</span> <span class="o">=</span> <span class="n">request</span><span class="p">?</span><span class="o">.</span><span class="n">httpMethod</span> <span class="p">??</span> <span class="s">"nil"</span>
        <span class="k">let</span> <span class="nv">statusCode</span> <span class="o">=</span> <span class="n">response</span><span class="p">?</span><span class="o">.</span><span class="n">statusCode</span> <span class="p">??</span> <span class="mi">0</span>
        <span class="k">var</span> <span class="nv">bodyString</span> <span class="o">=</span> <span class="s">"nil"</span>
        <span class="k">if</span> <span class="k">let</span> <span class="nv">data</span> <span class="o">=</span> <span class="n">request</span><span class="p">?</span><span class="o">.</span><span class="n">httpBody</span><span class="p">,</span> <span class="k">let</span> <span class="nv">string</span> <span class="o">=</span> <span class="kt">String</span><span class="p">(</span><span class="nv">bytes</span><span class="p">:</span> <span class="n">data</span><span class="p">,</span> <span class="nv">encoding</span><span class="p">:</span> <span class="kt">String</span><span class="o">.</span><span class="kt">Encoding</span><span class="o">.</span><span class="n">utf8</span><span class="p">)</span> <span class="p">{</span>
          <span class="n">bodyString</span> <span class="o">=</span> <span class="n">string</span>
        <span class="p">}</span>
        <span class="k">var</span> <span class="nv">responseString</span> <span class="o">=</span> <span class="s">"nil"</span>
        <span class="k">if</span> <span class="k">let</span> <span class="nv">data</span> <span class="o">=</span> <span class="n">response</span><span class="p">?</span><span class="o">.</span><span class="n">data</span><span class="p">,</span> <span class="k">let</span> <span class="nv">reString</span> <span class="o">=</span> <span class="kt">String</span><span class="p">(</span><span class="nv">bytes</span><span class="p">:</span> <span class="n">data</span><span class="p">,</span> <span class="nv">encoding</span><span class="p">:</span> <span class="kt">String</span><span class="o">.</span><span class="kt">Encoding</span><span class="o">.</span><span class="n">utf8</span><span class="p">)</span> <span class="p">{</span>
          <span class="n">responseString</span> <span class="o">=</span> <span class="n">reString</span>
        <span class="p">}</span>
        <span class="nf">logInfo</span><span class="p">(</span><span class="s">"""
                &lt;didReceive - </span><span class="se">\(</span><span class="n">method</span><span class="se">)</span><span class="s"> statusCode: </span><span class="se">\(</span><span class="n">statusCode</span><span class="se">)</span><span class="s">&gt;
                url: </span><span class="se">\(</span><span class="n">url</span><span class="se">)</span><span class="s">
                body: </span><span class="se">\(</span><span class="n">bodyString</span><span class="se">)</span><span class="s">
                error: </span><span class="se">\(</span><span class="n">error</span><span class="p">?</span><span class="o">.</span><span class="n">localizedDescription</span> <span class="p">??</span> <span class="s">"nil"</span><span class="se">)</span><span class="s">
                response: </span><span class="se">\(</span><span class="n">responseString</span><span class="se">)</span><span class="s">
        """</span><span class="p">)</span>
      <span class="p">}</span>
    <span class="p">}</span>
</code></pre></div></div>

<h2 id="stub-closure">Stub Closure</h2>

<p>추가적으로 제가 맨 앞에서 보여드린 코드를 보면 stubClosure라는게 있습니다.</p>
<div class="language-swift highlighter-rouge"><div class="highlight"><pre class="highlight"><code>     <span class="kd">class</span> <span class="kt">OpenitProvider</span><span class="o">&lt;</span><span class="kt">T</span><span class="p">:</span><span class="kt">TargetType</span><span class="o">&gt;</span><span class="p">:</span> <span class="kt">MoyaProvider</span><span class="o">&lt;</span><span class="kt">T</span><span class="o">&gt;</span> <span class="p">{</span>
      <span class="nf">init</span><span class="p">(</span><span class="nv">stubClosure</span><span class="p">:</span> <span class="kd">@escaping</span> <span class="kt">StubClosure</span> <span class="o">=</span> <span class="kt">MoyaProvider</span><span class="o">.</span><span class="n">neverStub</span><span class="p">)</span> <span class="p">{</span>
        <span class="o">...</span>
        <span class="k">super</span><span class="o">.</span><span class="nf">init</span><span class="p">(</span><span class="nv">stubClosure</span><span class="p">:</span> <span class="n">stubClosure</span><span class="p">,</span>
                       <span class="nv">manager</span><span class="p">:</span> <span class="n">manager</span><span class="p">,</span>
                       <span class="nv">plugins</span><span class="p">:</span> <span class="p">[</span><span class="kt">APILoggingPlugin</span><span class="p">(),</span>
                                 <span class="kt">NetworkActivityPlugin</span><span class="p">(</span><span class="nv">networkActivityClosure</span><span class="p">:</span> <span class="n">networkClosure</span><span class="p">)])</span>
      <span class="p">}</span>
    <span class="p">}</span>
</code></pre></div></div>
<p>이 Stub Closure는 <strong>Unit test</strong> 에서 제가 사용하는 것으로 없을경우에는 기본적으로 NeverStub가 붙어있는데, 여기에 클로저를 추가할 경우 API를 타지 않고 sample data에서 json을 꺼내와서 사용할 수 있습니다.</p>

<div class="language-swift highlighter-rouge"><div class="highlight"><pre class="highlight"><code>    <span class="cp"># SplashViewControllerUnitTest.swift</span>
    <span class="o">...</span>
    <span class="k">override</span> <span class="kd">func</span> <span class="nf">setUp</span><span class="p">()</span> <span class="p">{</span>
      <span class="c1">// Put setup code here. This method is called before the invocation of each test method in the class.</span>
      <span class="n">viewModel</span> <span class="o">=</span> <span class="kt">SplashControllerViewModel</span><span class="p">(</span><span class="nv">provider</span><span class="p">:</span> <span class="kt">OpenitProvider</span><span class="o">&lt;</span><span class="kt">JuvisAPI</span><span class="o">&gt;</span><span class="p">(</span><span class="nv">stubClosure</span><span class="p">:</span> <span class="kt">MoyaProvider</span><span class="o">.</span><span class="n">immediatelyStub</span><span class="p">))</span>
      <span class="n">disposeBag</span> <span class="o">=</span> <span class="kt">DisposeBag</span><span class="p">()</span>
    <span class="p">}</span>
    <span class="o">...</span>
</code></pre></div></div>
<p>unit test는 기본적으로 네트워크 상태에 영향을 받으면 안되는데, 테스트 케이스를 만들다보면 어쩔수 없이 로직이 api와 연결되는 경우가 많습니다. 특히 RxSwift를 사용할 경우 네트워크 통신과 로직이 함께 붙어있는 경우가 많아서 유용하게 사용하실 수 있습니다.</p>

<hr />

<h2 id="rxswift-extension">RxSwift Extension</h2>

<p>마지막으로 제가 만든 Provider 커스텀 파일에는 하나의 코드 구문이 더 있습니다. 바로 Rx 관련 구문인데 모든 부분에 timeout을 추가해야 하는 이슈가 있었습니다.
 앞선 이유와 같은 이유로 RxSwift의 extension을 만들어서 사용하고 있습니다.</p>
<div class="language-swift highlighter-rouge"><div class="highlight"><pre class="highlight"><code>    <span class="kd">extension</span> <span class="kt">Reactive</span> <span class="k">where</span> <span class="kt">Base</span><span class="p">:</span> <span class="kt">OpenitProvider</span><span class="o">&lt;</span><span class="kt">JuvisAPI</span><span class="o">&gt;</span> <span class="p">{</span>
      <span class="c1">/// Designated request-making method.</span>
      <span class="c1">///</span>
      <span class="c1">/// - Parameters:</span>
      <span class="c1">///   - token: Entity, which provides specifications necessary for a `MoyaProvider`.</span>
      <span class="c1">///   - callbackQueue: Callback queue. If nil - queue from provider initializer will be used.</span>
      <span class="c1">/// - Returns: Single response object.</span>
      <span class="kd">internal</span> <span class="kd">func</span> <span class="nf">request</span><span class="p">(</span><span class="n">_</span> <span class="nv">token</span><span class="p">:</span> <span class="kt">Base</span><span class="o">.</span><span class="kt">Target</span><span class="p">,</span> <span class="nv">callbackQueue</span><span class="p">:</span> <span class="kt">DispatchQueue</span><span class="p">?</span> <span class="o">=</span> <span class="kc">nil</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="kt">Single</span><span class="o">&lt;</span><span class="kt">Response</span><span class="o">&gt;</span> <span class="p">{</span>
        <span class="k">return</span> <span class="kt">Single</span><span class="o">.</span><span class="n">create</span> <span class="p">{</span> <span class="p">[</span><span class="k">weak</span> <span class="n">base</span><span class="p">]</span> <span class="n">single</span> <span class="k">in</span>
          <span class="k">let</span> <span class="nv">cancellableToken</span> <span class="o">=</span> <span class="n">base</span><span class="p">?</span><span class="o">.</span><span class="nf">request</span><span class="p">(</span><span class="n">token</span><span class="p">,</span> <span class="nv">callbackQueue</span><span class="p">:</span> <span class="n">callbackQueue</span><span class="p">,</span> <span class="nv">progress</span><span class="p">:</span> <span class="kc">nil</span><span class="p">)</span> <span class="p">{</span> <span class="n">result</span> <span class="k">in</span>
          <span class="k">switch</span> <span class="n">result</span> <span class="p">{</span>
            <span class="k">case</span> <span class="kd">let</span> <span class="o">.</span><span class="nf">success</span><span class="p">(</span><span class="n">response</span><span class="p">):</span>
              <span class="nf">single</span><span class="p">(</span><span class="o">.</span><span class="nf">success</span><span class="p">(</span><span class="n">response</span><span class="p">))</span>
            <span class="k">case</span> <span class="kd">let</span> <span class="o">.</span><span class="nf">failure</span><span class="p">(</span><span class="n">error</span><span class="p">):</span>
              <span class="nf">single</span><span class="p">(</span><span class="o">.</span><span class="nf">error</span><span class="p">(</span><span class="n">error</span><span class="p">))</span>
            <span class="p">}</span>
          <span class="p">}</span>

          <span class="k">return</span> <span class="kt">Disposables</span><span class="o">.</span><span class="n">create</span> <span class="p">{</span>
            <span class="n">cancellableToken</span><span class="p">?</span><span class="o">.</span><span class="nf">cancel</span><span class="p">()</span>
          <span class="p">}</span>
        <span class="p">}</span><span class="o">.</span><span class="nf">timeout</span><span class="p">(</span><span class="mi">10</span><span class="p">,</span> <span class="nv">scheduler</span><span class="p">:</span> <span class="kt">MainScheduler</span><span class="o">.</span><span class="n">asyncInstance</span><span class="p">)</span>
      <span class="p">}</span>
    <span class="p">}</span>
</code></pre></div></div>

<h2 id="마치며">마치며</h2>

<p>moya의 문서를 찾아보면 여러 가지 다양한 이슈에 대한 처리 방법이 자세히 나와 있습니다. 대부분의 사례에 대해서 지원하거나 커스텀 할 수 있도록 네트워크 계층을 분리하고 있습니다. 이러한 다양한 확장성과 이점 때문에 내가 스스로 만들어 쓸 수 있는 능력이 있다고 해도 Moya를 쓰지 말아야 할 이유는 없다고 생각합니다. 한번 익숙해지면 이거 없이는 개발 못 할 정도입니다. 다들 한번 배워보시는 것을 추천합니다.</p>

                </div>
            </section>

            <!-- Email subscribe form at the bottom of the page -->
            

            <footer class="post-full-footer">
                <!-- Everything inside the #author tags pulls data from the author -->
                <!-- #author-->
                
                    
                
                    
                
                    
                
                    
                
                    
                
                    
                
                    
                
                <!-- /author  -->
            </footer>

            <!-- If you use Disqus comments, just uncomment this block.
            The only thing you need to change is "test-apkdzgmqhj" - which
            should be replaced with your own Disqus site-id. -->
            
                <section class="post-full-comments">
                    <div id="disqus_thread"></div>
                    <script>
                        var disqus_config = function () {
                            this.page.url = 'https://leejigun.github.io//';
                            this.page.identifier = 'iOS 삽질 블로그';
                        };
                        (function() {
                            var d = document, s = d.createElement('script');
                            s.src = 'https://jglee.disqus.com/embed.js';
                            s.setAttribute('data-timestamp', +new Date());
                            (d.head || d.body).appendChild(s);
                        })();
                    </script>
                </section>
            

        </article>

    </div>
</main>

<!-- Links to Previous/Next posts -->
<aside class="read-next outer">
    <div class="inner">
        <div class="read-next-feed">
            
                
                
                
                
                    <article class="read-next-card"
                        
                            style="background-image: url(/assets/images/blog-cover.jpg)"
                        
                    >
                        <header class="read-next-card-header">
                            <small class="read-next-card-header-sitetitle">&mdash; iOS 삽질 블로그 &mdash;</small>
                            
                                <h3 class="read-next-card-header-title"><a href="/tag/ios-tip/">Ios tip</a></h3>
                            
                        </header>
                        <div class="read-next-divider"><svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M13 14.5s2 3 5 3 5.5-2.463 5.5-5.5S21 6.5 18 6.5c-5 0-7 11-12 11C2.962 17.5.5 15.037.5 12S3 6.5 6 6.5s4.5 3.5 4.5 3.5"/></svg>
</div>
                        <div class="read-next-card-content">
                            <ul>
                                
                                
                                  
                                    
                                        
                                        
                                            <li><a href="/fastlaneFirebase">iOS fastlane - Fabric, Firebase</a></li>
                                        
                                    
                                  
                                
                                  
                                
                                  
                                
                                  
                                
                                  
                                
                                  
                                
                                  
                                    
                                        
                                        
                                            <li><a href="/SwiftUI_Paths_Shapes">SwiftUI - Paths와 Shapes</a></li>
                                        
                                    
                                  
                                
                                  
                                
                                  
                                
                                  
                                
                                  
                                
                                  
                                
                                  
                                
                                  
                                
                                  
                                
                                  
                                
                                  
                                
                                  
                                
                                  
                                
                                  
                                
                                  
                                
                                  
                                
                                  
                                
                                  
                                
                                  
                                
                                  
                                
                                  
                                
                                  
                                
                                  
                                
                                  
                                    
                                  
                                
                                  
                                    
                                        
                                        
                                            <li><a href="/HealthKit_-_Steps_Counter">HealthKit - Steps Counter</a></li>
                                        
                                    
                                  
                                
                                  
                                
                                  
                                
                                  
                                    
                                        
                                        
                                    
                                  
                                
                                  
                                
                                  
                                
                                  
                                
                                  
                                
                                  
                                    
                                        
                                        
                                    
                                  
                                
                                  
                                    
                                        
                                        
                                    
                                  
                                
                                  
                                    
                                        
                                        
                                    
                                  
                                
                                  
                                    
                                        
                                        
                                    
                                  
                                
                                  
                                    
                                        
                                        
                                    
                                  
                                
                                  
                                    
                                        
                                        
                                    
                                  
                                
                                  
                                    
                                        
                                        
                                    
                                  
                                
                                  
                                
                                  
                                
                                  
                                
                                  
                                    
                                        
                                        
                                    
                                  
                                
                                  
                                    
                                        
                                        
                                    
                                  
                                
                                  
                                    
                                        
                                        
                                    
                                  
                                
                            </ul>
                        </div>
                        <footer class="read-next-card-footer">
                            <a href="/tag/ios-tip/">
                                
                                    See all 14 posts  →
                                
                            </a>
                        </footer>
                    </article>
                
            

            <!-- If there's a next post, display it using the same markup included from - partials/post-card.hbs -->
            
                
    <article class="post-card post-template">
        
            <a class="post-card-image-link" href="/SwftUI,Combine,MVVM_1)-Financing">
                <div class="post-card-image" style="background-image: url(/assets/images/SwiftUI/Financing_App_Volume_1.png)"></div>
            </a>
        
        <div class="post-card-content">
            <a class="post-card-content-link" href="/SwftUI,Combine,MVVM_1)-Financing">
                <header class="post-card-header">
                    
                        
                            
                                <span class="post-card-tags">Swiftui</span>
                            
                        
                    

                    <h2 class="post-card-title">SwiftUI, Combine, MVVM 1) - Financing UI</h2>
                </header>
                <section class="post-card-excerpt">
                    <p># SwftUI, Combine MVVM - Financing 이전 포스트에서는 주로 SwiftUI를 공부하면서 화면을 디자인해보는 작업을 진행했었다. 이런 연습은 예전에 Flutter를 공부할 때 어느 유튜버가 매일매일 화면을 만드는 영상을 올렸던 것을 보고 따라 하기 시작한</p>
                </section>
            </a>
            <footer class="post-card-meta">
                
                    
                
                    
                
                    
                
                    
                
                    
                
                    
                
                    
                
            </footer>
        </div>
    </article>

            

            <!-- If there's a previous post, display it using the same markup included from - partials/post-card.hbs -->
            
                
    <article class="post-card post-template">
        
            <a class="post-card-image-link" href="/HealthKit_-_Steps_Counter">
                <div class="post-card-image" style="background-image: url(/assets/images/ios_tips/healthkit.png)"></div>
            </a>
        
        <div class="post-card-content">
            <a class="post-card-content-link" href="/HealthKit_-_Steps_Counter">
                <header class="post-card-header">
                    
                        
                            
                                <span class="post-card-tags">Ios tip</span>
                            
                        
                    

                    <h2 class="post-card-title">HealthKit - Steps Counter</h2>
                </header>
                <section class="post-card-excerpt">
                    <p>HealthKit - Steps Counter 프로젝트에서 걸음 수 기능이 추가된다고 해서 사전에 만보계 기능을 추가하려 합니다. 보통 걸음 수 기능을 구현할 때에는 Healthkit을 사용하거나 CoreMotion을 사용한다고 합니다. CoreMotion을 사용하면 실시간으로 데이터를 수집할 수 있지만</p>
                </section>
            </a>
            <footer class="post-card-meta">
                
                    
                
                    
                
                    
                
                    
                
                    
                
                    
                
                    
                
            </footer>
        </div>
    </article>

            

        </div>
    </div>
</aside>

<!-- Floating header which appears on-scroll, included from includes/floating-header.hbs -->
<div class="floating-header">
    <div class="floating-header-logo">
        <a href="https://leejigun.github.io//">
            
                <img src="/assets/images/blog-icon.png" alt="iOS 삽질 블로그 icon" />
            
            <span>iOS 삽질 블로그</span>
        </a>
    </div>
    <span class="floating-header-divider">&mdash;</span>
    <div class="floating-header-title">Swift Moya Provider 커스텀</div>
    <div class="floating-header-share">
        <div class="floating-header-share-label">Share this <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24">
    <path d="M7.5 15.5V4a1.5 1.5 0 1 1 3 0v4.5h2a1 1 0 0 1 1 1h2a1 1 0 0 1 1 1H18a1.5 1.5 0 0 1 1.5 1.5v3.099c0 .929-.13 1.854-.385 2.748L17.5 23.5h-9c-1.5-2-5.417-8.673-5.417-8.673a1.2 1.2 0 0 1 1.76-1.605L7.5 15.5zm6-6v2m-3-3.5v3.5m6-1v2"/>
</svg>
</div>
        <a class="floating-header-share-tw" href="https://twitter.com/share?text=Swift+Moya+Provider+%EC%BB%A4%EC%8A%A4%ED%85%80&amp;url=https://leejigun.github.io/Swift_Moya_Provider_custom"
            onclick="window.open(this.href, 'share-twitter', 'width=550,height=235');return false;">
            <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 32 32"><path d="M30.063 7.313c-.813 1.125-1.75 2.125-2.875 2.938v.75c0 1.563-.188 3.125-.688 4.625a15.088 15.088 0 0 1-2.063 4.438c-.875 1.438-2 2.688-3.25 3.813a15.015 15.015 0 0 1-4.625 2.563c-1.813.688-3.75 1-5.75 1-3.25 0-6.188-.875-8.875-2.625.438.063.875.125 1.375.125 2.688 0 5.063-.875 7.188-2.5-1.25 0-2.375-.375-3.375-1.125s-1.688-1.688-2.063-2.875c.438.063.813.125 1.125.125.5 0 1-.063 1.5-.25-1.313-.25-2.438-.938-3.313-1.938a5.673 5.673 0 0 1-1.313-3.688v-.063c.813.438 1.688.688 2.625.688a5.228 5.228 0 0 1-1.875-2c-.5-.875-.688-1.813-.688-2.75 0-1.063.25-2.063.75-2.938 1.438 1.75 3.188 3.188 5.25 4.25s4.313 1.688 6.688 1.813a5.579 5.579 0 0 1 1.5-5.438c1.125-1.125 2.5-1.688 4.125-1.688s3.063.625 4.188 1.813a11.48 11.48 0 0 0 3.688-1.375c-.438 1.375-1.313 2.438-2.563 3.188 1.125-.125 2.188-.438 3.313-.875z"/></svg>

        </a>
        <a class="floating-header-share-fb" href="https://www.facebook.com/sharer/sharer.php?u=https://leejigun.github.io/Swift_Moya_Provider_custom"
            onclick="window.open(this.href, 'share-facebook','width=580,height=296');return false;">
            <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 32 32"><path d="M19 6h5V0h-5c-3.86 0-7 3.14-7 7v3H8v6h4v16h6V16h5l1-6h-6V7c0-.542.458-1 1-1z"/></svg>

        </a>
    </div>
    <progress class="progress" value="0">
        <div class="progress-container">
            <span class="progress-bar"></span>
        </div>
    </progress>
</div>


<!-- /post -->

<!-- The #contentFor helper here will send everything inside it up to the matching #block helper found in default.hbs -->


        <!-- Previous/next page links - displayed on every page -->
        

        <!-- The footer at the very bottom of the screen -->
        <footer class="site-footer outer">
            <div class="site-footer-content inner">
                <section class="copyright"><a href="https://leejigun.github.io//">iOS 삽질 블로그</a> &copy; 2020</section>
                <section class="poweredby">Github page blog of <a href="https://github.com/Leejigun">Leejigun</a> &
                    <a href="https://pages.github.com/" target="_blank" rel="noopener">GitHub Pages</a> using
                    <a href="https://github.com/jekyller/jasper2" target="_blank" rel="noopener">Jasper2</a></section>
                <nav class="site-footer-nav">
                    <a href="/">Latest Posts</a>
                    
                    
                    <!-- <a href="https://ghost.org" target="_blank" rel="noopener">Ghost</a> -->
                </nav>
            </div>
        </footer>

    </div>

    <!-- The big email subscribe modal content -->
    

    <!-- highlight.js -->
    <script src="https://cdnjs.cloudflare.com/ajax/libs/prism/1.10.0/components/prism-abap.min.js"></script>
    <script>$(document).ready(function() {
      $('pre code').each(function(i, block) {
        hljs.highlightBlock(block);
      });
    });</script>

    <!-- jQuery + Fitvids, which makes all video embeds responsive -->
    <script
        src="https://code.jquery.com/jquery-3.2.1.min.js"
        integrity="sha256-hwg4gsxgFZhOsEEamdOYGBf13FyQuiTwlAQgxVSNgt4="
        crossorigin="anonymous">
    </script>
    <script type="text/javascript" src="/assets/js/jquery.fitvids.js"></script>
    <script type="text/javascript" src="https://demo.ghost.io/assets/js/jquery.fitvids.js?v=724281a32e"></script>


    <!-- Paginator increased to "infinit" in _config.yml -->
    <!-- if paginator.posts  -->
    <!-- <script>
        var maxPages = parseInt('');
    </script>
    <script src="/assets/js/infinitescroll.js"></script> -->
    <!-- /endif -->

    


    <!-- Add Google Analytics  -->
    <!-- Google Analytics Tracking code -->
 <script>
  (function(i,s,o,g,r,a,m){i['GoogleAnalyticsObject']=r;i[r]=i[r]||function(){
  (i[r].q=i[r].q||[]).push(arguments)},i[r].l=1*new Date();a=s.createElement(o),
  m=s.getElementsByTagName(o)[0];a.async=1;a.src=g;m.parentNode.insertBefore(a,m)
  })(window,document,'script','//www.google-analytics.com/analytics.js','ga');

  ga('create', 'UA-154736789-1', 'auto');
  ga('send', 'pageview');

 </script>


    <!-- The #block helper will pull in data from the #contentFor other template files. In this case, there's some JavaScript which we only want to use in post.hbs, but it needs to be included down here, after jQuery has already loaded. -->
    
        <script>

// NOTE: Scroll performance is poor in Safari
// - this appears to be due to the events firing much more slowly in Safari.
//   Dropping the scroll event and using only a raf loop results in smoother
//   scrolling but continuous processing even when not scrolling
$(document).ready(function () {
    // Start fitVids
    var $postContent = $(".post-full-content");
    $postContent.fitVids();
    // End fitVids

    var progressBar = document.querySelector('progress');
    var header = document.querySelector('.floating-header');
    var title = document.querySelector('.post-full-title');

    var lastScrollY = window.scrollY;
    var lastWindowHeight = window.innerHeight;
    var lastDocumentHeight = $(document).height();
    var ticking = false;

    function onScroll() {
        lastScrollY = window.scrollY;
        requestTick();
    }

    function onResize() {
        lastWindowHeight = window.innerHeight;
        lastDocumentHeight = $(document).height();
        requestTick();
    }

    function requestTick() {
        if (!ticking) {
            requestAnimationFrame(update);
        }
        ticking = true;
    }

    function update() {
        var trigger = title.getBoundingClientRect().top + window.scrollY;
        var triggerOffset = title.offsetHeight + 35;
        var progressMax = lastDocumentHeight - lastWindowHeight;

        // show/hide floating header
        if (lastScrollY >= trigger + triggerOffset) {
            header.classList.add('floating-active');
        } else {
            header.classList.remove('floating-active');
        }

        progressBar.setAttribute('max', progressMax);
        progressBar.setAttribute('value', lastScrollY);

        ticking = false;
    }

    window.addEventListener('scroll', onScroll, {passive: true});
    window.addEventListener('resize', onResize, false);

    update();
});
</script>

    

    <!-- Ghost outputs important scripts and data with this tag - it should always be the very last thing before the closing body tag -->
    <!-- ghost_foot -->

</body>
</html>
