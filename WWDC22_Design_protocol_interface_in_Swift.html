<!-- footer도 여기에 있음 -->


<!DOCTYPE html>
<html>
<head>

    <!-- Document Settings -->
    <meta charset="utf-8" />
    <meta http-equiv="X-UA-Compatible" content="IE=edge" />

    <!-- Base Meta -->
    <!-- iOS-tip 이라고 태그를 만들었으면 post에서는 iOS tip 이라고 태그를 줘야한다. -->
<!-- dynamically fixing the title for tag/author pages -->



    <title>[WWDC22] Design protocol interface in Swift</title>
    <meta name="HandheldFriendly" content="True" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <!-- Styles'n'Scripts -->
    <link rel="stylesheet" type="text/css" href="/assets/built/screen.css" />
    <link rel="stylesheet" type="text/css" href="/assets/built/screen.edited.css" />
    <link rel="stylesheet" type="text/css" href="/assets/built/syntax.css" />
    <!-- highlight.js -->
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/highlight.js/9.12.0/styles/default.min.css">
    <style>.hljs { background: none; }</style>

    <!-- This tag outputs SEO meta+structured data and other important settings -->
    <meta name="description" content="[WWDC22] Design protocol interface in Swift" />
    <link rel="shortcut icon" href="https://leejigun.github.io/assets/images/blog-icon.png" type="image/png" />
    <link rel="canonical" href="https://leejigun.github.io/WWDC22_Design_protocol_interface_in_Swift" />
    <meta name="referrer" content="no-referrer-when-downgrade" />

     <!--title below is coming from _includes/dynamic_title-->
    <meta property="og:site_name" content="iOS 삽질 블로그" />
    <meta property="og:type" content="website" />
    <meta property="og:title" content="[WWDC22] Design protocol interface in Swift" />
    <meta property="og:description" content="WWDC22 - Design protocol interface in Swift WWDC22 - Swift 제네릭의 활용 이후 연관된 세션입니다. 앞선 포스트를 보고 오시면 더 좋습니다. 구체적 타입(일반 타입) 추상화 및 프로토콜로 타입 관계를 모델링하는 몇 가지 고급 기술을 보여드리고자 합니다. 강연에서는 기존의 Swift 언어 기능과 Swift 5.7에 도입된 새로운 일부 기능을 모두 다룰 예정입니다." />
    <meta property="og:url" content="https://leejigun.github.io/WWDC22_Design_protocol_interface_in_Swift" />
    <meta property="og:image" content="https://leejigun.github.io/assets/images/ios/2023-03-05-WWDC22_Design_protocol_interface_in_Swift/post.jpg" />
    <meta property="article:publisher" content="https://www.facebook.com/" />
    <meta property="article:author" content="https://www.facebook.com/" />
    <meta property="article:published_time" content="2023-03-05T09:00:01+09:00" />
    <meta property="article:modified_time" content="2023-03-05T09:00:01+09:00" />
    <meta property="article:tag" content="Ios" />
    <meta name="twitter:card" content="summary_large_image" />
    <meta name="twitter:title" content="[WWDC22] Design protocol interface in Swift" />
    <meta name="twitter:description" content="WWDC22 - Design protocol interface in Swift WWDC22 - Swift 제네릭의 활용 이후 연관된 세션입니다. 앞선 포스트를 보고 오시면 더 좋습니다. 구체적 타입(일반 타입) 추상화 및 프로토콜로 타입 관계를 모델링하는 몇 가지 고급 기술을 보여드리고자 합니다. 강연에서는 기존의 Swift 언어 기능과 Swift 5.7에 도입된 새로운 일부 기능을 모두 다룰 예정입니다." />
    <meta name="twitter:url" content="https://leejigun.github.io/" />
    <meta name="twitter:image" content="https://leejigun.github.io/assets/images/ios/2023-03-05-WWDC22_Design_protocol_interface_in_Swift/post.jpg" />
    <meta name="twitter:label1" content="Written by" />
    <meta name="twitter:data1" content="iOS 삽질 블로그" />
    <meta name="twitter:label2" content="Filed under" />
    <meta name="twitter:data2" content="Ios" />
    <meta name="twitter:site" content="@" />
    <meta name="twitter:creator" content="@" />
    <meta property="og:image:width" content="1400" />
    <meta property="og:image:height" content="933" />

    <script type="application/ld+json">
{
    "@context": "https://schema.org",
    "@type": "Website",
    "publisher": {
        "@type": "Organization",
        "name": "iOS 삽질 블로그",
        "logo": "https://leejigun.github.io/assets/images/blog-icon.png"
    },
    "url": "https://leejigun.github.io/WWDC22_Design_protocol_interface_in_Swift",
    "image": {
        "@type": "ImageObject",
        "url": "https://leejigun.github.io/assets/images/ios/2023-03-05-WWDC22_Design_protocol_interface_in_Swift/post.jpg",
        "width": 2000,
        "height": 666
    },
    "mainEntityOfPage": {
        "@type": "WebPage",
        "@id": "https://leejigun.github.io/WWDC22_Design_protocol_interface_in_Swift"
    },
    "description": "WWDC22 - Design protocol interface in Swift WWDC22 - Swift 제네릭의 활용 이후 연관된 세션입니다. 앞선 포스트를 보고 오시면 더 좋습니다. 구체적 타입(일반 타입) 추상화 및 프로토콜로 타입 관계를 모델링하는 몇 가지 고급 기술을 보여드리고자 합니다. 강연에서는 기존의 Swift 언어 기능과 Swift 5.7에 도입된 새로운 일부 기능을 모두 다룰 예정입니다."
}
    </script>

    <!-- <script type="text/javascript" src="https://demo.ghost.io/public/ghost-sdk.min.js?v=724281a32e"></script>
    <script type="text/javascript">
    ghost.init({
    	clientId: "ghost-frontend",
    	clientSecret: "f84a07a72b17"
    });
    </script> -->

    <meta name="generator" content="Jekyll 3.6.2" />
    <link rel="alternate" type="application/rss+xml" title="[WWDC22] Design protocol interface in Swift" href="/feed.xml" />


</head>
<body class="post-template">

    <div class="site-wrapper">
        <!-- All the main content gets inserted here, index.hbs, post.hbs, etc -->

        <!-- HTML elements for search -->

        <!-- default -->

<!-- The tag above means: insert everything in this file
into the {body} of the default.hbs template -->

<header class="site-header outer">
    <div class="inner">
        <!-- 네비게이션 바 -->
<nav class="site-nav">
    <div class="site-nav-left">
        
            
                <a class="site-nav-logo" href="https://leejigun.github.io/"><img src="/assets/images/blog-icon.png" alt="iOS 삽질 블로그" /></a>
            
        
        
            <!-- 여기서 navigation 에 표시할 이이템 추가 -->
<ul class="nav" role="menu">
    <li class="nav-home" role="menuitem"><a href="/">Home</a></li>
    <li class="nav-about" role="menuitem"><a href="/about/">About</a></li>
    <li class="nav-getting-started" role="menuitem"><a href="/tag/ios/">iOS</a></li>
    <li class="nav-getting-started" role="menuitem"><a href="/tag/watchos/">watchOS</a></li>
    <li class="nav-getting-started" role="menuitem"><a href="/tag/rxswift/">RxSwift</a></li>
    <li class="nav-getting-started" role="menuitem"><a href="/tag/swiftui/">swiftui</a></li>
    <li class="nav-getting-started" role="menuitem"><a href="/tag/project/">project</a></li>
    <li class="nav-getting-started" role="menuitem"><a href="/tag/ml/">ML</a></li>
    <li class="nav-getting-started" role="menuitem"><a href="/tag/cs/">CS</a></li>
    <li class="nav-getting-started" role="menuitem"><a href="/tag/flutter/">flutter</a></li>
    <li class="nav-try-ghost" role="menuitem"><a href="https://github.com/Leejigun">github</a></li>
    <li class="nav-try-ghost" role="menuitem"><a href="https://leejigun.notion.site/d96873c479d049cbb3f2476aa7990347?v=84936e8007664a6daaa211463819028d">notion</a></li>
    <li class="nav-try-ghost" role="menuitem"><a href="/search.html">Search</a></li>
</ul>

        
    </div>
    <div class="site-nav-right">
        <div class="social-links">
            
            
        </div>
        
    </div>
</nav>

    </div>
</header>

<!-- Everything inside the #post tags pulls data from the post -->
<!-- #post -->

<main id="site-main" class="site-main outer" role="main">
    <div class="inner">

        <article class="post-full post tag-getting-started ">

            <header class="post-full-header">
                <section class="post-full-meta">
                    <time class="post-full-meta-date" datetime=" 5 March 2023"> 5 March 2023</time>
                    
                        <span class="date-divider">/</span>
                        
                            
                               <a href='/tag/ios/'>IOS</a>
                            
                        
                    
                </section>
                <h1 class="post-full-title">[WWDC22] Design protocol interface in Swift</h1>
            </header>

            
            <figure class="post-full-image" style="background-image: url(/assets/images/ios/2023-03-05-WWDC22_Design_protocol_interface_in_Swift/post.jpg)">
            </figure>
            

            <section class="post-full-content">
                <div class="kg-card-markdown">
                    <h1 id="wwdc22---design-protocol-interface-in-swift">WWDC22 - Design protocol interface in Swift</h1>

<blockquote>
  <p>WWDC22 - Swift 제네릭의 활용 이후 연관된 세션입니다. 앞선 포스트를 보고 오시면 더 좋습니다.</p>

</blockquote>

<p>구체적 타입(일반 타입) 추상화 및 프로토콜로 타입 관계를 모델링하는 몇 가지 고급 기술을 보여드리고자 합니다. 강연에서는 기존의 Swift 언어 기능과 Swift 5.7에 도입된 새로운 일부 기능을 모두 다룰 예정입니다.</p>

<p>강연은 크게 3가지 주제로 구성됩니다.</p>

<ol>
  <li>Understand tpye erasure - any를 사용한 결과 타입 소거</li>
  <li>Hide implementation details - 불투명 결과 타입을 사용한 캡슐화</li>
  <li>Identify type relationships - 일반 타입 집합간의 관계를 모델링하는 방법</li>
</ol>

<p>먼저, <code class="language-plaintext highlighter-rouge">associatedtype</code> 을 가진 프로토콜이 실제 타입들과 상호작용하는 방법을 알아보겠습니다.</p>

<p>아래 2가지 프로토콜과 4가지 구체적 타입이 있는 데이터 모델이 있습니다. <code class="language-plaintext highlighter-rouge">Animal</code> 프로토콜에 공통으로 사용하는 <code class="language-plaintext highlighter-rouge">produce</code> 메소드를 추가하겠습니다. 그리고 <code class="language-plaintext highlighter-rouge">produce</code> 메소드는 각자 구체적인 타입마다 만들어내는 수확물이 다릅니다.</p>

<div class="language-swift highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="kd">protocol</span> <span class="kt">Animal</span> <span class="p">{</span><span class="o">...</span><span class="p">}</span>
<span class="kd">struct</span> <span class="kt">Chicken</span><span class="p">:</span> <span class="kt">Animal</span> <span class="p">{</span><span class="o">...</span><span class="p">}</span>
<span class="kd">struct</span> <span class="kt">Cow</span><span class="p">:</span> <span class="kt">Animal</span> <span class="p">{</span><span class="o">...</span><span class="p">}</span>

<span class="kd">protocol</span> <span class="kt">Food</span> <span class="p">{</span><span class="o">...</span><span class="p">}</span>
<span class="kd">struct</span> <span class="kt">Egg</span><span class="p">:</span> <span class="kt">Food</span> <span class="p">{</span><span class="o">...</span><span class="p">}</span>
<span class="kd">struct</span> <span class="kt">Milk</span><span class="p">:</span> <span class="kt">Food</span> <span class="p">{</span><span class="o">...</span><span class="p">}</span>
</code></pre></div></div>

<p>이전 제네릭 활용 포스트에서 보셨듯이 이 경우 <code class="language-plaintext highlighter-rouge">associatedtype</code> 을 통해서 아직 정해지지 않은 <code class="language-plaintext highlighter-rouge">produce</code> 메소드의 return type을 임시로 정해두고 넘어갈 수 있습니다. 더욱이 <code class="language-plaintext highlighter-rouge">associatedtype CommodityType</code> 에 <code class="language-plaintext highlighter-rouge">Food</code>라는 불투명 타입을 지정할 수 있습니다.</p>

<div class="language-swift highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="kd">protocol</span> <span class="kt">Animal</span> <span class="p">{</span>
    <span class="kd">associatedtype</span> <span class="kt">CommodityType</span><span class="p">:</span> <span class="kt">Food</span>
    <span class="kd">func</span> <span class="nf">produce</span><span class="p">()</span> <span class="o">-&gt;</span> <span class="kt">CommodityType</span>
<span class="p">}</span>
<span class="kd">struct</span> <span class="kt">Chicken</span><span class="p">:</span> <span class="kt">Animal</span> <span class="p">{</span>
    <span class="kd">func</span> <span class="nf">produce</span><span class="p">()</span> <span class="o">-&gt;</span> <span class="kt">Egg</span> <span class="p">{</span> <span class="o">...</span> <span class="p">}</span>
<span class="p">}</span>
<span class="kd">struct</span> <span class="kt">Cow</span><span class="p">:</span> <span class="kt">Animal</span> <span class="p">{</span>
    <span class="kd">func</span> <span class="nf">produce</span><span class="p">()</span> <span class="o">-&gt;</span> <span class="kt">Milk</span>  <span class="p">{</span> <span class="o">...</span> <span class="p">}</span>
<span class="p">}</span>
</code></pre></div></div>

<p>동물로 가득 찬 농장이 있다고 가정한다면, <code class="language-plaintext highlighter-rouge">Farm</code>의 ‘<code class="language-plaintext highlighter-rouge">animals</code>’ 저장 속성은 ‘<code class="language-plaintext highlighter-rouge">any Animal</code>‘의 이종 배열입니다.</p>

<div class="language-swift highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="kd">struct</span> <span class="kt">Farm</span> <span class="p">{</span>
    <span class="k">var</span> <span class="nv">animals</span><span class="p">:</span> <span class="p">[</span><span class="n">any</span> <span class="kt">Animal</span><span class="p">]</span>
    
    <span class="kd">func</span> <span class="nf">produceCommodities</span><span class="p">()</span> <span class="o">-&gt;</span> <span class="p">[</span><span class="n">any</span> <span class="kt">Food</span><span class="p">]</span> <span class="p">{</span>
        <span class="k">return</span> <span class="n">animals</span><span class="o">.</span><span class="n">map</span> <span class="p">{</span> <span class="n">animal</span> <span class="k">in</span>
            <span class="n">animal</span><span class="o">.</span><span class="nf">produce</span><span class="p">()</span>
        <span class="p">}</span>
    <span class="p">}</span>
<span class="p">}</span>
</code></pre></div></div>

<p><code class="language-plaintext highlighter-rouge">any Animal</code> 타입은 어떤 <code class="language-plaintext highlighter-rouge">Animal</code> 타입이라도 동적으로 저장할 수 있는 박스로 표현됩니다. 만약, 박스에 담을 수 있을 정도로 작은 사이즈면 값을 저장하고 너무 크다면 해당 값에 대한 포인터로 저장하게 됩니다. 이렇게 다양한 구체적 타입(일반 타입)에 대해 동일한 표현을 사용하는 전략을 <strong>타입 소거</strong>라고 합니다.</p>

<p><img src="assets/images/ios/2023-03-05-WWDC22_Design_protocol_interface_in_Swift/Untitled.png" alt="Untitled" /></p>

<p><code class="language-plaintext highlighter-rouge">produceCommodities</code> 메소드를 좀 더 뜯어보면, <code class="language-plaintext highlighter-rouge">Farm</code>의 프로퍼티인 <code class="language-plaintext highlighter-rouge">[any Animal]</code>을 받아서 <code class="language-plaintext highlighter-rouge">produce</code> 함수를 호출해 <code class="language-plaintext highlighter-rouge">Food</code>를 만들어냅니다. 런타임에 <code class="language-plaintext highlighter-rouge">animal</code>의 구체적인 타입이 결정되겠지만, <code class="language-plaintext highlighter-rouge">animal</code>의 <code class="language-plaintext highlighter-rouge">produce</code>가 <code class="language-plaintext highlighter-rouge">associatedtype CommodityType</code> 를 반환한다는 것을 <code class="language-plaintext highlighter-rouge">Animal</code> 프로토콜 덕분에 알고 있고 <code class="language-plaintext highlighter-rouge">CommodityType</code>의 상한 타입이 <code class="language-plaintext highlighter-rouge">Food</code> 프로토콜인 것을 알고 있어서 구체적 타입을 컴파일 타임에 알 지 못해도 컴파일이 가능하도록 합니다. 이를 <strong>연관 타입 소거(Type erasure semantics)</strong>라 합니다.</p>

<p>Swift 5.7에 추가된 이 연관 타입 소거 덕분에 불투명 타입을 타고 올라가 구체적 타입이 <code class="language-plaintext highlighter-rouge">any Animal</code>과 <code class="language-plaintext highlighter-rouge">any Food</code>로 대체되었습니다.</p>

<div class="language-swift highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="kd">protocol</span> <span class="kt">Animal</span> <span class="p">{</span>
    <span class="kd">associatedtype</span> <span class="kt">CommodityType</span><span class="p">:</span> <span class="kt">Food</span>
    <span class="kd">func</span> <span class="nf">produce</span><span class="p">()</span> <span class="o">-&gt;</span> <span class="kt">CommodityType</span>
<span class="p">}</span>

<span class="kd">func</span> <span class="nf">produceCommodities</span><span class="p">()</span> <span class="o">-&gt;</span> <span class="p">[</span><span class="n">any</span> <span class="kt">Food</span><span class="p">]</span> <span class="p">{</span>
    <span class="k">return</span> <span class="n">animals</span><span class="o">.</span><span class="n">map</span> <span class="p">{</span> <span class="n">animal</span> <span class="k">in</span>
        <span class="n">animal</span><span class="o">.</span><span class="nf">produce</span><span class="p">()</span>
    <span class="p">}</span>
<span class="p">}</span>
</code></pre></div></div>

<p>반면에 이전 WWDC22 Embreace swift generics 포스트를 보면 <code class="language-plaintext highlighter-rouge">any</code> 타입의 <code class="language-plaintext highlighter-rouge">animal</code>에서 <code class="language-plaintext highlighter-rouge">eat</code> 함수를 호출하려고 할 때 <code class="language-plaintext highlighter-rouge">any</code> 타입인 상태로 <code class="language-plaintext highlighter-rouge">eat</code> 함수를 호출 할 수 없어 <code class="language-plaintext highlighter-rouge">some</code> 타입의 함수로 전달 후 <code class="language-plaintext highlighter-rouge">eat</code> 함수를 호출했었습니다. 이는 <code class="language-plaintext highlighter-rouge">eat</code> 함수에서 받는 파라미터가 <code class="language-plaintext highlighter-rouge">associatedtype</code>이기 때문인데, 타입 소거를 통해서 구체적인 타입을 지정하지 않고 예상되는 타입만으로 사용이 가능하지만, 파라미터로 받는 <code class="language-plaintext highlighter-rouge">associatedtype</code>까지 컴파일 타임에 장담할 수 없기 때문에 <code class="language-plaintext highlighter-rouge">some</code> 타입으로 변환하고 <code class="language-plaintext highlighter-rouge">eat</code> 함수를 호출해야 했었습니다.</p>

<p>타입 소거의 경우 구체 타입(일반타입) 에서 불투명 타입으로 변환은 가능하지만, 불투명 타입에서 구체 타입으로 전환이 불가능합니다. 예를 들어서 <code class="language-plaintext highlighter-rouge">Cow</code>의 <code class="language-plaintext highlighter-rouge">produce()</code> 함수의 반환 값인 <code class="language-plaintext highlighter-rouge">Milk</code>를 <code class="language-plaintext highlighter-rouge">any Food</code> 타입으로 변환하는 것은 앞서 봤듯이 문제 없습니다. 하지만 <code class="language-plaintext highlighter-rouge">any Animal</code>에 <code class="language-plaintext highlighter-rouge">Cow</code>가 먹는 <code class="language-plaintext highlighter-rouge">FeedType</code>이 <code class="language-plaintext highlighter-rouge">Hay</code>라고 가정했을 때 <code class="language-plaintext highlighter-rouge">Hay</code>를 만들어 <code class="language-plaintext highlighter-rouge">any Animal</code> 타입인 <code class="language-plaintext highlighter-rouge">Cow</code>에 넣어줄 수 없습니다. 왜냐면 컴파일 시점에 <code class="language-plaintext highlighter-rouge">Cow</code>인지 확신할 수 없기 때문입니다.</p>

<div class="language-swift highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="kd">protocol</span> <span class="kt">Animal</span> <span class="p">{</span>
	<span class="kd">associatedtype</span> <span class="kt">FeedType</span><span class="p">:</span> <span class="kt">AnimalFeed</span>
	<span class="kd">func</span> <span class="nf">eat</span><span class="p">(</span><span class="nv">_</span><span class="p">:</span> <span class="kt">FeedType</span><span class="p">)</span>
<span class="p">}</span>

<span class="n">animals</span><span class="o">.</span><span class="n">map</span> <span class="p">{</span> <span class="n">animal</span> <span class="k">in</span>
    <span class="n">animal</span><span class="o">.</span><span class="nf">eat</span><span class="p">(???)</span>
<span class="p">}</span>
</code></pre></div></div>

<h2 id="hideimplementationdetails"><strong>Hide implementation details</strong></h2>

<p>다음으로 배고픈 동물들에게 먹이를 주기 위해서 <code class="language-plaintext highlighter-rouge">Animal</code> 프로토콜을 일반화해보겠습니다. <code class="language-plaintext highlighter-rouge">Animal</code>에 <code class="language-plaintext highlighter-rouge">isHungry</code> 프로퍼티를 추가하고, <code class="language-plaintext highlighter-rouge">Farm</code>의 <code class="language-plaintext highlighter-rouge">hungryAnimals</code>에서 <code class="language-plaintext highlighter-rouge">filter</code>를 사용해 뽑아낼 것입니다. 그런데 이렇게 뽑아낸 <code class="language-plaintext highlighter-rouge">hungryAnimals</code>가 <code class="language-plaintext highlighter-rouge">feedAnimals</code> 함수에서 한번 반복문을 돌고 바로 버려집니다. <code class="language-plaintext highlighter-rouge">filter</code>는 전체 <code class="language-plaintext highlighter-rouge">animals</code>를 한 바퀴 돌아 <code class="language-plaintext highlighter-rouge">isHungry</code>가 <code class="language-plaintext highlighter-rouge">true</code> 인 경우를 뽑아내는 고차함수인데, 동물의 수가 엄청나게 많을 경우 매번 <code class="language-plaintext highlighter-rouge">filter</code>를 통해서 뽑아내는 것은 비효율적입니다.</p>

<div class="language-swift highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="kd">protocol</span> <span class="kt">Animal</span> <span class="p">{</span>
	<span class="k">var</span> <span class="nv">isHungry</span><span class="p">:</span> <span class="kt">Bool</span> <span class="p">{</span> <span class="k">get</span> <span class="p">}</span>
<span class="p">}</span>

<span class="kd">struct</span> <span class="kt">Farm</span> <span class="p">{</span>
	<span class="k">var</span> <span class="nv">hungryAnimals</span><span class="p">:</span> <span class="p">[</span><span class="n">any</span> <span class="kt">Animal</span><span class="p">]</span> <span class="p">{</span>
		<span class="k">return</span> <span class="n">animals</span><span class="o">.</span><span class="n">filter</span> <span class="p">{</span> <span class="nv">$0</span><span class="o">.</span><span class="n">isHungry</span> <span class="p">}</span>
	<span class="p">}</span>

	<span class="kd">func</span> <span class="nf">feedAnimals</span><span class="p">()</span> <span class="p">{</span>
		<span class="k">for</span> <span class="n">animal</span> <span class="k">in</span> <span class="n">hungryAnimals</span> <span class="p">{</span>
		    
		<span class="p">}</span>
	<span class="p">}</span>
<span class="p">}</span>
</code></pre></div></div>

<p>feedAnimals는 hungryAnimals를 한 번 반복한 다음, 즉시 이 임시 배열을 버린다는 걸 알 수 있는데요. 농장에 배고픈 동물이 많은 경우, 이는 비효율적인 방법입니다. 이러한 임시 할당을 피할 수 있는 방법 중 하나는 표준 라이브러리의 지연 계산 컬렉션 기능을 사용하는 것입니다. 지연 계산 컬렉션은 ‘filter’에 대한 호출을 ‘lazy.filter’로 대체하면 얻을 수 있습니다. 지연 계산 컬렉션은 ‘filter’에 대한 일반 호출을 통해 반환된 배열과 동일한 요소를 갖지만, 임시 할당을 피합니다.</p>

<div class="language-swift highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="kd">struct</span> <span class="kt">Farm</span> <span class="p">{</span>
	<span class="k">var</span> <span class="nv">hungryAnimals</span><span class="p">:</span> <span class="kt">LazyFilterSequence</span><span class="o">&lt;</span><span class="p">[</span><span class="n">any</span> <span class="kt">Animal</span><span class="p">]</span><span class="o">&gt;</span> <span class="p">{</span>
		<span class="k">return</span> <span class="n">animals</span><span class="o">.</span><span class="kd">lazy</span><span class="o">.</span><span class="nf">filter</span><span class="p">(\</span><span class="o">.</span><span class="n">isHungry</span><span class="p">)</span>
	<span class="p">}</span>
<span class="p">}</span>
</code></pre></div></div>

<p>Swift 표준 라이브러리에는 SequenceTpye, CollectionType 프로토콜에는 lazy 라는 연산 프로퍼티가 있으며 LazySequence, LazyCollection을 반환합니다. 이러한 방식은 map, flatMap, filter 등 고차 함수를 게으른(lazy) 방식으로 적용하는데 사용됩니다. lazy는 그 시점에 바로 로직을 적용하는게 아니라, 모든 시퀀스의 로직을 기억하고 있다가 호출될 때 한번에 적용하는 효과를 가지고 있습니다.</p>

<p>아래 2가지 케이스를 살펴보면 짝수인 숫자만 골라서 2를 곱하는 로직입니다. 일반적인 경우 짝수를 찾기 위해서 (filter) 1000개를 탐색하고 걸러진 500개를 map을 돌려서 탐색하기 때문에 총 호출 횟수는 1500 번 입니다.</p>

<p>하지만, lazy의 경우 filter 로직과 map 로직을 기억하고 있다고 한번에 적용시킵니다. 따라서 Lazy는 한번의 반복문으로 filter와 map을 한번에 적용시키기 때문에 1000번만 반복하면 충분합니다.</p>

<div class="language-swift highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="p">(</span><span class="mi">1</span><span class="o">...</span><span class="mi">1000</span><span class="p">)</span>
    <span class="o">.</span><span class="n">filter</span> <span class="p">{</span> <span class="nv">$0</span> <span class="o">%</span> <span class="mi">2</span> <span class="o">==</span> <span class="mi">0</span> <span class="p">}</span>
    <span class="o">.</span><span class="n">map</span> <span class="p">{</span> <span class="nv">$0</span> <span class="o">*</span> <span class="mi">2</span> <span class="p">}</span>
    <span class="o">.</span><span class="n">count</span>
<span class="o">-&gt;</span> <span class="mi">1500</span>

<span class="p">(</span><span class="mi">1</span><span class="o">...</span><span class="mi">1000</span><span class="p">)</span><span class="o">.</span><span class="kd">lazy</span>
    <span class="o">.</span><span class="n">filter</span> <span class="p">{</span> <span class="nv">$0</span> <span class="o">%</span> <span class="mi">2</span> <span class="o">==</span> <span class="mi">0</span> <span class="p">}</span>
    <span class="o">.</span><span class="n">map</span> <span class="p">{</span> <span class="nv">$0</span> <span class="o">*</span> <span class="mi">2</span> <span class="p">}</span>
    <span class="o">.</span><span class="n">count</span>
<span class="o">-&gt;</span> <span class="mi">1000</span>
</code></pre></div></div>

<p>하지만 보시면 이러한 방법은 animal의 정적 타입 정보를 너무 많이 숨겨버립니다. hungryAnimals가 요소 타입이 ‘any Animal’이라는 지식이 없다면 요소 타입을 전달하는 작업만 할 수 있을 뿐이고, Animal 프로토콜의 어떤 메소드도 호출할 수 없습니다.</p>

<div class="language-swift highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="kd">func</span> <span class="nf">feedAnimals</span><span class="p">()</span> <span class="p">{</span>
  <span class="k">for</span> <span class="n">animal</span> <span class="k">in</span> <span class="n">hungryAnimals</span> <span class="p">{</span>
		<span class="o">...</span>
  <span class="p">}</span>
<span class="p">}</span>
</code></pre></div></div>

<p>만약, flag로 지연 타입의 Sequence를 가져올지 추가하고 싶다면, any Collection을 사용할 수 있다.</p>

<p>some 키워드를 사용해 Collection을 선언하면 컴파일 타임에 한가지 타입(이 경우에는 lazyCollection)을 지정해야 하는데, flag 값으로 여러 Collection 중 하나를 반환하고 싶을 땐 any를 사용하면 된다.</p>

<div class="language-swift highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="c1">// some</span>
<span class="k">var</span> <span class="nv">hungryAnimals</span><span class="p">:</span> <span class="kd">some</span> <span class="kt">Collection</span><span class="o">&lt;</span><span class="n">any</span> <span class="kt">Animal</span><span class="o">&gt;</span> <span class="p">{</span>
    <span class="k">return</span> <span class="n">animals</span><span class="o">.</span><span class="kd">lazy</span><span class="o">.</span><span class="nf">filter</span><span class="p">(\</span><span class="o">.</span><span class="n">isHungry</span><span class="p">)</span>
<span class="p">}</span>

<span class="c1">// any</span>
<span class="k">var</span> <span class="nv">hungryAnimals</span><span class="p">:</span> <span class="n">any</span> <span class="kt">Collection</span><span class="o">&lt;</span><span class="n">any</span> <span class="kt">Animal</span><span class="o">&gt;</span> <span class="p">{</span>
	  <span class="k">if</span> <span class="n">isLazy</span> <span class="p">{</span>
	      <span class="k">return</span> <span class="n">animals</span><span class="o">.</span><span class="kd">lazy</span><span class="o">.</span><span class="nf">filter</span><span class="p">(\</span><span class="o">.</span><span class="n">isHungry</span><span class="p">)</span>
	  <span class="p">}</span> <span class="k">else</span> <span class="p">{</span>
	      <span class="k">return</span> <span class="n">animals</span><span class="o">.</span><span class="nf">filter</span><span class="p">(\</span><span class="o">.</span><span class="n">isHungry</span><span class="p">)</span>
	  <span class="p">}</span>
<span class="p">}</span>
</code></pre></div></div>

<h2 id="identify-type-relationships">Identify type relationships</h2>

<p>불투명 타입 제네릭 코드 작성은 추상 타입 관계에 기반해야합니다. 연관 프로토콜을 사용하여 여러 추상 타입 간에 필요한 타입 관계를 식별하고 보장하는 방법을 살펴보겠습니다.</p>

<p>Animal 프로토콜에 eat 메소드를 추가할 것입니다. 그러나 <code class="language-plaintext highlighter-rouge">Cow</code>는 <code class="language-plaintext highlighter-rouge">Alfalfa</code>를 가공하여 <code class="language-plaintext highlighter-rouge">Hay</code>(건초)를 제공하고, <code class="language-plaintext highlighter-rouge">Chicken</code>은 <code class="language-plaintext highlighter-rouge">Millet</code>(곡물)을 가공하여 <code class="language-plaintext highlighter-rouge">Scratch</code>(스크래치)를 제공해야합니다.</p>

<p>이전 제네릭 포스트에서 만든 <code class="language-plaintext highlighter-rouge">AnimalFeed</code>와 <code class="language-plaintext highlighter-rouge">Crop</code>을 다시 사용합니다. (이전 포스트와 약간 차이가 있지만, WWDC에서도 차이가 있으므로 그대로 둡니다.)</p>

<div class="language-swift highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="kd">protocol</span> <span class="kt">AnimalFeed</span> <span class="p">{</span>
  <span class="kd">associatedtype</span> <span class="kt">CropType</span><span class="p">:</span> <span class="kt">Crop</span>
  <span class="kd">static</span> <span class="kd">func</span> <span class="nf">grow</span><span class="p">()</span> <span class="o">-&gt;</span> <span class="kt">CropType</span>
<span class="p">}</span>

<span class="kd">protocol</span> <span class="kt">Crop</span> <span class="p">{</span>
  <span class="kd">associatedtype</span> <span class="kt">Feed</span><span class="p">:</span> <span class="kt">AnimalFeed</span>
  <span class="kd">func</span> <span class="nf">harvest</span><span class="p">()</span> <span class="o">-&gt;</span> <span class="kt">Feed</span>
<span class="p">}</span>

<span class="kd">protocol</span> <span class="kt">Animal</span> <span class="p">{</span>
  <span class="kd">associatedtype</span> <span class="kt">Feed</span><span class="p">:</span> <span class="kt">AnimalFeed</span>
  <span class="kd">func</span> <span class="nf">eat</span><span class="p">(</span><span class="n">_</span> <span class="nv">food</span><span class="p">:</span> <span class="kt">Feed</span><span class="p">)</span>
    <span class="k">var</span> <span class="nv">isHungry</span><span class="p">:</span> <span class="kt">Bool</span> <span class="p">{</span> <span class="k">get</span> <span class="p">}</span>
<span class="p">}</span>

<span class="kd">struct</span> <span class="kt">Cow</span><span class="p">:</span> <span class="kt">Animal</span> <span class="p">{</span>
	<span class="k">var</span> <span class="nv">isHungry</span><span class="p">:</span> <span class="kt">Bool</span>
  <span class="kd">func</span> <span class="nf">eat</span><span class="p">(</span><span class="n">_</span> <span class="nv">food</span><span class="p">:</span> <span class="kt">Hay</span><span class="p">)</span> <span class="p">{</span><span class="o">...</span><span class="p">}</span>
<span class="p">}</span>

<span class="kd">struct</span> <span class="kt">Hay</span><span class="p">:</span> <span class="kt">AnimalFeed</span> <span class="p">{</span>
  <span class="kd">static</span> <span class="kd">func</span> <span class="nf">grow</span><span class="p">()</span> <span class="o">-&gt;</span> <span class="kt">Alfalfa</span> <span class="p">{</span><span class="o">...</span><span class="p">}</span>
<span class="p">}</span>

<span class="kd">struct</span> <span class="kt">Alfalfa</span><span class="p">:</span> <span class="kt">Crop</span> <span class="p">{</span>
  <span class="kd">func</span> <span class="nf">harvest</span><span class="p">()</span> <span class="o">-&gt;</span> <span class="kt">Hay</span> <span class="p">{</span><span class="o">...</span><span class="p">}</span>
<span class="p">}</span>

<span class="kd">struct</span> <span class="kt">Chicken</span><span class="p">:</span> <span class="kt">Animal</span> <span class="p">{</span>
	<span class="k">var</span> <span class="nv">isHungry</span><span class="p">:</span> <span class="kt">Bool</span>
  <span class="kd">func</span> <span class="nf">eat</span><span class="p">(</span><span class="n">_</span> <span class="nv">food</span><span class="p">:</span> <span class="kt">Scratch</span><span class="p">)</span> <span class="p">{</span><span class="o">...</span><span class="p">}</span>
<span class="p">}</span>

<span class="kd">struct</span> <span class="kt">Scratch</span><span class="p">:</span> <span class="kt">AnimalFeed</span> <span class="p">{</span>
  <span class="kd">static</span> <span class="kd">func</span> <span class="nf">grow</span><span class="p">()</span> <span class="o">-&gt;</span> <span class="kt">Millet</span> <span class="p">{</span><span class="o">...</span><span class="p">}</span>
<span class="p">}</span>

<span class="kd">struct</span> <span class="kt">Millet</span><span class="p">:</span> <span class="kt">Crop</span> <span class="p">{</span>
  <span class="kd">func</span> <span class="nf">harvest</span><span class="p">()</span> <span class="o">-&gt;</span> <span class="kt">Scratch</span> <span class="p">{</span><span class="o">...</span><span class="p">}</span>
<span class="p">}</span>
</code></pre></div></div>

<p><code class="language-plaintext highlighter-rouge">feedAnimal()</code> 메소드를 하나만 구현해서 이런 <code class="language-plaintext highlighter-rouge">Cow</code>와 <code class="language-plaintext highlighter-rouge">Chicken</code> 2가지 연관 타입과 앞으로 추가될 다른 <code class="language-plaintext highlighter-rouge">Animal</code> 타입들까지 대응 할 수 있도록 하려고 합니다. <code class="language-plaintext highlighter-rouge">feedAnimal</code>에서 <code class="language-plaintext highlighter-rouge">Animal</code> 프로토콜의 <code class="language-plaintext highlighter-rouge">eat</code> 함수가 함께 호출되어야 함으로 <code class="language-plaintext highlighter-rouge">any</code> 타입이 아닌 <code class="language-plaintext highlighter-rouge">some</code> 타입으로 <strong>언박싱</strong> 하겠습니다.</p>

<div class="language-swift highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="kd">struct</span> <span class="kt">Farm</span> <span class="p">{</span>
	<span class="kd">func</span> <span class="nf">feedAnimals</span><span class="p">()</span> <span class="p">{</span>
	    <span class="k">for</span> <span class="n">animal</span> <span class="k">in</span> <span class="n">hungryAnimals</span> <span class="p">{</span>
	        <span class="nf">feedAnimal</span><span class="p">(</span><span class="n">animal</span><span class="p">)</span>
	    <span class="p">}</span>
	<span class="p">}</span>
	<span class="kd">private</span> <span class="kd">func</span> <span class="nf">feedAnimal</span><span class="p">(</span><span class="n">_</span> <span class="nv">animal</span><span class="p">:</span> <span class="kd">some</span> <span class="kt">Animal</span><span class="p">)</span> <span class="p">{</span>
	    <span class="p">???</span>
	<span class="p">}</span>
<span class="p">}</span>
</code></pre></div></div>

<p>우리는 <code class="language-plaintext highlighter-rouge">feedAnimal</code>에서 <code class="language-plaintext highlighter-rouge">eat</code> 함수를 호출하려면 <code class="language-plaintext highlighter-rouge">Animal</code>의 구체타입에 알맞은 <code class="language-plaintext highlighter-rouge">Food</code>를 찾아내야 합니다. 하지만 우리가 지금 알고 있는 것은 <code class="language-plaintext highlighter-rouge">animal의 인스턴스</code> 뿐입니다. 이게 <code class="language-plaintext highlighter-rouge">Cow</code>인지 <code class="language-plaintext highlighter-rouge">Chicken</code>인지 알 수 없습니다. 그래서 <code class="language-plaintext highlighter-rouge">Animal</code> 타입으로부터 거슬로 올라가야 합니다. <code class="language-plaintext highlighter-rouge">animal</code>의 <code class="language-plaintext highlighter-rouge">Feed</code>의 구체적인 타입이 무엇인지 알 수 없지만, <code class="language-plaintext highlighter-rouge">Feed</code>는 <code class="language-plaintext highlighter-rouge">AnimalFeed</code> 프로토콜을 추상 타입으로 사용하고 있는 것은 알 수 있고 <code class="language-plaintext highlighter-rouge">AnimalFeed</code>에는 <code class="language-plaintext highlighter-rouge">grow</code>를 통해서 <code class="language-plaintext highlighter-rouge">CropType</code>을 꺼내올 수 있는 것을 알 수 있습니다. 그리고 <code class="language-plaintext highlighter-rouge">CropType</code>이 <code class="language-plaintext highlighter-rouge">Alfalfa</code>인지 <code class="language-plaintext highlighter-rouge">Millet</code>인지 알 수 없지만, <code class="language-plaintext highlighter-rouge">Crop</code> 프로토콜의 <code class="language-plaintext highlighter-rouge">harvest</code>를 통해서 <code class="language-plaintext highlighter-rouge">Feed</code>를 꺼내 올 수 있다는 것을 알 수 있습니다.</p>

<p>따라서 아래와 같은 순서로 <code class="language-plaintext highlighter-rouge">animal</code>의 구체적인 타입이 뭔지 몰라도 해당 <code class="language-plaintext highlighter-rouge">animal</code>에 맞는 <code class="language-plaintext highlighter-rouge">Feed</code>를 꺼내 올 수 있습니다.</p>

<ul>
  <li><code class="language-plaintext highlighter-rouge">animal</code> → <code class="language-plaintext highlighter-rouge">AnimalFeed</code> → <code class="language-plaintext highlighter-rouge">Crop</code> → <code class="language-plaintext highlighter-rouge">AnimalFeed instance</code> → <code class="language-plaintext highlighter-rouge">aniaml eat</code></li>
</ul>

<div class="language-swift highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="kd">private</span> <span class="kd">func</span> <span class="nf">feedAnimal</span><span class="p">(</span><span class="n">_</span> <span class="nv">animal</span><span class="p">:</span> <span class="kd">some</span> <span class="kt">Animal</span><span class="p">)</span> <span class="p">{</span>
    <span class="k">let</span> <span class="nv">feed</span> <span class="o">=</span> <span class="nf">type</span><span class="p">(</span><span class="nv">of</span><span class="p">:</span> <span class="n">animal</span><span class="p">)</span><span class="o">.</span><span class="kt">Feed</span>
    <span class="k">let</span> <span class="nv">crop</span> <span class="o">=</span> <span class="n">feed</span><span class="o">.</span><span class="nf">grow</span><span class="p">()</span>
    <span class="k">let</span> <span class="nv">food</span> <span class="o">=</span> <span class="n">crop</span><span class="o">.</span><span class="nf">harvest</span><span class="p">()</span>
    <span class="n">animal</span><span class="o">.</span><span class="nf">eat</span><span class="p">(</span><span class="n">food</span><span class="p">)</span>
<span class="p">}</span>
</code></pre></div></div>

<p>따라서 아래의 경우 실제 타입의 주석을 달아보면 이렇습니다.</p>

<div class="language-swift highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="k">let</span> <span class="nv">feed</span> <span class="o">=</span> <span class="nf">type</span><span class="p">(</span><span class="nv">of</span><span class="p">:</span> <span class="n">animal</span><span class="p">)</span><span class="o">.</span><span class="kt">Feed</span> <span class="c1">// (some Aniaml).FeedType</span>
<span class="k">let</span> <span class="nv">crop</span> <span class="o">=</span> <span class="n">feed</span><span class="o">.</span><span class="nf">grow</span><span class="p">()</span> <span class="c1">// FeedType.CropType</span>
<span class="k">let</span> <span class="nv">food</span> <span class="o">=</span> <span class="n">crop</span><span class="o">.</span><span class="nf">harvest</span><span class="p">()</span> <span class="c1">// CropType.FeedType: AnimalFeed</span>
</code></pre></div></div>

<p>그런데, 이렇게해도 컴파일 에러가 발생합니다. 중첩된 <code class="language-plaintext highlighter-rouge">associatedtype</code>을 통해서 <code class="language-plaintext highlighter-rouge">FeedType</code>까지 찾아왔지만, <code class="language-plaintext highlighter-rouge">FeedType</code>이 <code class="language-plaintext highlighter-rouge">Animal</code>의 <code class="language-plaintext highlighter-rouge">FeedType</code>이란 것을 보장 할 수 없기 떄문입니다. 실제로 <code class="language-plaintext highlighter-rouge">Alfalfa</code>가 <code class="language-plaintext highlighter-rouge">Hay</code>를 아닌 <code class="language-plaintext highlighter-rouge">Scratch</code> 를 생산해도 로직 상 아무 문제 없습니다. <code class="language-plaintext highlighter-rouge">Animal</code>에서 바로 <code class="language-plaintext highlighter-rouge">Feed</code>로 찾아가는게 아닌 <code class="language-plaintext highlighter-rouge">Feed</code>에서 <code class="language-plaintext highlighter-rouge">Crop</code>으로 이동 후 <code class="language-plaintext highlighter-rouge">Feed 인스턴스</code>를 만들기 때문에 <code class="language-plaintext highlighter-rouge">Animal</code>과 <code class="language-plaintext highlighter-rouge">Feed 인스턴스</code> 사이에 연관성이 끊어진 것 입니다.</p>

<p><img src="assets/images/ios/2023-03-05-WWDC22_Design_protocol_interface_in_Swift/Untitled%201.png" alt="Untitled" /></p>

<p>위의 associatedtype을 쫒아 Feed를 가져온 것은 사실 상 아래 처럼 그냥 Feed를 집어넣으려고 한 것과 동일하게 판단하는 것 입니다.</p>

<p><img src="assets/images/ios/2023-03-05-WWDC22_Design_protocol_interface_in_Swift/Untitled%202.png" alt="Untitled" /></p>

<p><code class="language-plaintext highlighter-rouge">AnimalFeed</code>의 <code class="language-plaintext highlighter-rouge">CropTtype</code>이 생산하는게 자신과 동일하다는 것을 보장하기 위해서 <code class="language-plaintext highlighter-rouge">where</code> 절을 추가할 수 있습니다.</p>

<div class="language-swift highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="kd">protocol</span> <span class="kt">AnimalFeed</span> <span class="p">{</span>
  <span class="kd">associatedtype</span> <span class="kt">CropType</span><span class="p">:</span> <span class="kt">Crop</span> <span class="k">where</span> <span class="kt">CropType</span><span class="o">.</span><span class="kt">Feed</span> <span class="o">==</span> <span class="k">Self</span>
  <span class="kd">static</span> <span class="kd">func</span> <span class="nf">grow</span><span class="p">()</span> <span class="o">-&gt;</span> <span class="kt">CropType</span>
<span class="p">}</span>

<span class="kd">protocol</span> <span class="kt">Crop</span> <span class="p">{</span>
  <span class="kd">associatedtype</span> <span class="kt">Feed</span><span class="p">:</span> <span class="kt">AnimalFeed</span> <span class="k">where</span> <span class="kt">Feed</span><span class="o">.</span><span class="kt">CropType</span> <span class="o">==</span> <span class="k">Self</span>
  <span class="kd">func</span> <span class="nf">harvest</span><span class="p">()</span> <span class="o">-&gt;</span> <span class="kt">Feed</span>
<span class="p">}</span>
</code></pre></div></div>

<p><img src="assets/images/ios/2023-03-05-WWDC22_Design_protocol_interface_in_Swift/Untitled%203.png" alt="Untitled" /></p>

<p>덕분에 실제 타입에 주석을 달아보면 아래와 같이 <code class="language-plaintext highlighter-rouge">associatedtype</code>에 제약을 걸 수 있고 이 경우 컴파일러는 문제 없이 아래와 같이 타입을 추론할 수 있습니다.</p>

<div class="language-swift highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="k">let</span> <span class="nv">feed</span> <span class="o">=</span> <span class="nf">type</span><span class="p">(</span><span class="nv">of</span><span class="p">:</span> <span class="n">animal</span><span class="p">)</span><span class="o">.</span><span class="kt">Feed</span> <span class="c1">// (some Aniaml).FeedType</span>
<span class="k">let</span> <span class="nv">crop</span> <span class="o">=</span> <span class="n">feed</span><span class="o">.</span><span class="nf">grow</span><span class="p">()</span> <span class="c1">// (some Aniaml).FeedType.CropType</span>
<span class="k">let</span> <span class="nv">food</span> <span class="o">=</span> <span class="n">crop</span><span class="o">.</span><span class="nf">harvest</span><span class="p">()</span> <span class="c1">// (some Aniaml).FeedType.CropType.FeedTyped</span>
</code></pre></div></div>

<h2 id="wrap-up">Wrap-up</h2>

<p>이번 WWDC 포스트에서 정리한 내용은 다음과 같다.</p>

<ul>
  <li>understand when you need type relationships
    <ul>
      <li>타입 소거가 가능한 경우와 타입 관계가 보장되어야 하는 경우</li>
    </ul>
  </li>
  <li>Balance API with implementation details
    <ul>
      <li>기본 연관 타입을 통해서 불투명 타입과 구체적 타입의 정보를 균형있게 노출시키거나 숨길 수 있는 방법</li>
    </ul>
  </li>
  <li>Identify type relationships across protocols
    <ul>
      <li>프로토콜 전반에 걸쳐 where 절을 통해서 타입간의 관계를 식별하고 보장</li>
    </ul>
  </li>
</ul>

                </div>
            </section>

            <!-- Email subscribe form at the bottom of the page -->
            

            <footer class="post-full-footer">
                <!-- Everything inside the #author tags pulls data from the author -->
                <!-- #author-->
                
                    
                
                    
                
                    
                
                    
                
                    
                
                    
                
                    
                
                <!-- /author  -->
            </footer>

            <!-- If you use Disqus comments, just uncomment this block.
            The only thing you need to change is "test-apkdzgmqhj" - which
            should be replaced with your own Disqus site-id. -->
            
                <section class="post-full-comments">
                    <div id="disqus_thread"></div>
                    <script>
                        var disqus_config = function () {
                            this.page.url = 'https://leejigun.github.io/';
                            this.page.identifier = 'iOS 삽질 블로그';
                        };
                        (function() {
                            var d = document, s = d.createElement('script');
                            s.src = 'https://jglee.disqus.com/embed.js';
                            s.setAttribute('data-timestamp', +new Date());
                            (d.head || d.body).appendChild(s);
                        })();
                    </script>
                </section>
            

        </article>

    </div>
</main>

<!-- Links to Previous/Next posts -->
<aside class="read-next outer">
    <div class="inner">
        <div class="read-next-feed">
            
                
                
                
                
                    <article class="read-next-card"
                        
                            style="background-image: url(/assets/images/blog-cover.jpg)"
                        
                    >
                        <header class="read-next-card-header">
                            <small class="read-next-card-header-sitetitle">&mdash; iOS 삽질 블로그 &mdash;</small>
                            
                                <h3 class="read-next-card-header-title"><a href="/tag/ios/">Ios</a></h3>
                            
                        </header>
                        <div class="read-next-divider"><svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M13 14.5s2 3 5 3 5.5-2.463 5.5-5.5S21 6.5 18 6.5c-5 0-7 11-12 11C2.962 17.5.5 15.037.5 12S3 6.5 6 6.5s4.5 3.5 4.5 3.5"/></svg>
</div>
                        <div class="read-next-card-content">
                            <ul>
                                
                                
                                  
                                    
                                        
                                        
                                            <li><a href="/Apple-Foundation-Models-%ED%99%9C%EC%9A%A9%EA%B8%B0%EC%A3%BC%EC%B0%A8%EC%9E%A5-%ED%83%9C%EA%B7%B8-%EC%83%9D%EC%84%B1">Apple Foundation Models 활용기 - 주차장 태그 생성</a></li>
                                        
                                    
                                  
                                
                                  
                                    
                                        
                                        
                                            <li><a href="/WWDC25Swift-%EC%84%B1%EB%8A%A5-%EC%B5%9C%EC%A0%81%ED%99%94-%EB%B6%88%ED%95%84%EC%9A%94%ED%95%9C-%ED%95%A0%EB%8B%B9-%EC%A4%84%EC%9D%B4%EA%B8%B0">[WWDC25]Swift 성능 최적화: 불필요한 할당 줄이기</a></li>
                                        
                                    
                                  
                                
                                  
                                    
                                        
                                        
                                            <li><a href="/WWDC25-Swift-%EC%84%B1%EB%8A%A5-%EC%B5%9C%EC%A0%81%ED%99%94%EC%9D%98-%EC%8B%9C%EC%9E%91-1-Instruments%EB%A1%9C-%EC%BD%94%EB%93%9C-%EB%B3%91%EB%AA%A9-%EC%B0%BE%EA%B8%B0">[WWDC25] Swift 성능 최적화의 시작-1) Instruments로 코드 병목 찾기</a></li>
                                        
                                    
                                  
                                
                                  
                                    
                                        
                                        
                                    
                                  
                                
                                  
                                    
                                        
                                        
                                    
                                  
                                
                                  
                                
                                  
                                    
                                        
                                        
                                    
                                  
                                
                                  
                                    
                                        
                                        
                                    
                                  
                                
                                  
                                    
                                        
                                        
                                    
                                  
                                
                                  
                                    
                                        
                                        
                                    
                                  
                                
                                  
                                    
                                        
                                        
                                    
                                  
                                
                                  
                                
                                  
                                
                                  
                                    
                                        
                                        
                                    
                                  
                                
                                  
                                    
                                  
                                
                                  
                                    
                                        
                                        
                                    
                                  
                                
                                  
                                
                                  
                                
                                  
                                
                                  
                                
                                  
                                    
                                        
                                        
                                    
                                  
                                
                                  
                                
                                  
                                    
                                        
                                        
                                    
                                  
                                
                                  
                                    
                                        
                                        
                                    
                                  
                                
                                  
                                
                                  
                                
                                  
                                
                                  
                                
                                  
                                
                                  
                                    
                                        
                                        
                                    
                                  
                                
                                  
                                
                                  
                                
                                  
                                
                                  
                                
                                  
                                
                                  
                                
                                  
                                
                                  
                                
                                  
                                
                                  
                                
                                  
                                
                                  
                                
                                  
                                
                                  
                                
                                  
                                
                                  
                                
                                  
                                
                                  
                                
                                  
                                
                                  
                                
                                  
                                
                                  
                                
                                  
                                    
                                        
                                        
                                    
                                  
                                
                                  
                                    
                                        
                                        
                                    
                                  
                                
                                  
                                
                                  
                                
                                  
                                    
                                        
                                        
                                    
                                  
                                
                                  
                                
                                  
                                
                                  
                                
                                  
                                
                                  
                                    
                                        
                                        
                                    
                                  
                                
                                  
                                    
                                        
                                        
                                    
                                  
                                
                                  
                                    
                                        
                                        
                                    
                                  
                                
                                  
                                    
                                        
                                        
                                    
                                  
                                
                                  
                                    
                                        
                                        
                                    
                                  
                                
                                  
                                    
                                        
                                        
                                    
                                  
                                
                                  
                                    
                                        
                                        
                                    
                                  
                                
                                  
                                
                                  
                                
                                  
                                
                                  
                                    
                                        
                                        
                                    
                                  
                                
                                  
                                    
                                        
                                        
                                    
                                  
                                
                                  
                                    
                                        
                                        
                                    
                                  
                                
                            </ul>
                        </div>
                        <footer class="read-next-card-footer">
                            <a href="/tag/ios/">
                                
                                    See all 29 posts  →
                                
                            </a>
                        </footer>
                    </article>
                
            

            <!-- If there's a next post, display it using the same markup included from - partials/post-card.hbs -->
            
                
    <article class="post-card post-template">
        
            <a class="post-card-image-link" href="/WWDC22_Navigation_Cook_book_in_SwiftUI">
                <div class="post-card-image" style="background-image: url(/assets/images/SwiftUI/2023-03-15-WWDC22_Navigation_Cook_book_in_SwiftUI/Untitled.png)"></div>
            </a>
        
        <div class="post-card-content">
            <a class="post-card-content-link" href="/WWDC22_Navigation_Cook_book_in_SwiftUI">
                <header class="post-card-header">
                    
                        
                            
                               <span class="post-card-tags">Ios</span>
                            
                        
                            
                                <span class="post-card-tags">Swiftui</span>
                            
                        
                    

                    <h2 class="post-card-title">[WWDC22] Navigation Cook book in SwiftUI</h2>
                </header>
                <section class="post-card-excerpt">
                    <p># WWDC22 - Navigation Cook book in SwiftUI - [developer.apple.com/wwdc22/10054/](https://developer.apple.com/wwdc22/10054/) > SwiftUI를 사용하면서 항상 문제가 되는 부분은 Navigation입니다. 이번 iOS16 업데이트에서 딥링크, 프로그래밍적 navigation 등 다양한 장벽들을 해소할 수 있는 새로운 API가 많이</p>
                </section>
            </a>
            <footer class="post-card-meta">
                
                    
                
                    
                
                    
                
                    
                
                    
                
                    
                
                    
                
            </footer>
        </div>
    </article>

            

            <!-- If there's a previous post, display it using the same markup included from - partials/post-card.hbs -->
            
                
    <article class="post-card post-template">
        
            <a class="post-card-image-link" href="/WWDC22_Generic">
                <div class="post-card-image" style="background-image: url(/assets/images/ios/2023-03-04-WWDC22_Generic/2023-03-04_02-26-02.jpeg)"></div>
            </a>
        
        <div class="post-card-content">
            <a class="post-card-content-link" href="/WWDC22_Generic">
                <header class="post-card-header">
                    
                        
                            
                                <span class="post-card-tags">Ios</span>
                            
                        
                    

                    <h2 class="post-card-title">[WWDC22] Embreace swift generics - some, any</h2>
                </header>
                <section class="post-card-excerpt">
                    <p>[WWDC22] Embreace swift generics - some, any 해당 포스트에서는 제네릭과 some, any를 사용하여 모델을 추상화하는 방법에 대해 설명하고 있습니다. some과 any의 개념만 이해하고 싶다면, 다른 포스트를 참고하는 것이 더 좋습니다. 하지만, 이 WWDC</p>
                </section>
            </a>
            <footer class="post-card-meta">
                
                    
                
                    
                
                    
                
                    
                
                    
                
                    
                
                    
                
            </footer>
        </div>
    </article>

            

        </div>
    </div>
</aside>

<!-- Floating header which appears on-scroll, included from includes/floating-header.hbs -->
<div class="floating-header">
    <div class="floating-header-logo">
        <a href="https://leejigun.github.io/">
            
                <img src="/assets/images/blog-icon.png" alt="iOS 삽질 블로그 icon" />
            
            <span>iOS 삽질 블로그</span>
        </a>
    </div>
    <span class="floating-header-divider">&mdash;</span>
    <div class="floating-header-title">[WWDC22] Design protocol interface in Swift</div>
    <div class="floating-header-share">
        <div class="floating-header-share-label">Share this <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24">
    <path d="M7.5 15.5V4a1.5 1.5 0 1 1 3 0v4.5h2a1 1 0 0 1 1 1h2a1 1 0 0 1 1 1H18a1.5 1.5 0 0 1 1.5 1.5v3.099c0 .929-.13 1.854-.385 2.748L17.5 23.5h-9c-1.5-2-5.417-8.673-5.417-8.673a1.2 1.2 0 0 1 1.76-1.605L7.5 15.5zm6-6v2m-3-3.5v3.5m6-1v2"/>
</svg>
</div>
        <a class="floating-header-share-tw" href="https://twitter.com/share?text=%5BWWDC22%5D+Design+protocol+interface+in+Swift&amp;url=https://leejigun.github.io/WWDC22_Design_protocol_interface_in_Swift"
            onclick="window.open(this.href, 'share-twitter', 'width=550,height=235');return false;">
            <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 32 32"><path d="M30.063 7.313c-.813 1.125-1.75 2.125-2.875 2.938v.75c0 1.563-.188 3.125-.688 4.625a15.088 15.088 0 0 1-2.063 4.438c-.875 1.438-2 2.688-3.25 3.813a15.015 15.015 0 0 1-4.625 2.563c-1.813.688-3.75 1-5.75 1-3.25 0-6.188-.875-8.875-2.625.438.063.875.125 1.375.125 2.688 0 5.063-.875 7.188-2.5-1.25 0-2.375-.375-3.375-1.125s-1.688-1.688-2.063-2.875c.438.063.813.125 1.125.125.5 0 1-.063 1.5-.25-1.313-.25-2.438-.938-3.313-1.938a5.673 5.673 0 0 1-1.313-3.688v-.063c.813.438 1.688.688 2.625.688a5.228 5.228 0 0 1-1.875-2c-.5-.875-.688-1.813-.688-2.75 0-1.063.25-2.063.75-2.938 1.438 1.75 3.188 3.188 5.25 4.25s4.313 1.688 6.688 1.813a5.579 5.579 0 0 1 1.5-5.438c1.125-1.125 2.5-1.688 4.125-1.688s3.063.625 4.188 1.813a11.48 11.48 0 0 0 3.688-1.375c-.438 1.375-1.313 2.438-2.563 3.188 1.125-.125 2.188-.438 3.313-.875z"/></svg>

        </a>
        <a class="floating-header-share-fb" href="https://www.facebook.com/sharer/sharer.php?u=https://leejigun.github.io/WWDC22_Design_protocol_interface_in_Swift"
            onclick="window.open(this.href, 'share-facebook','width=580,height=296');return false;">
            <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 32 32"><path d="M19 6h5V0h-5c-3.86 0-7 3.14-7 7v3H8v6h4v16h6V16h5l1-6h-6V7c0-.542.458-1 1-1z"/></svg>

        </a>
    </div>
    <progress class="progress" value="0">
        <div class="progress-container">
            <span class="progress-bar"></span>
        </div>
    </progress>
</div>


<!-- /post -->

<!-- The #contentFor helper here will send everything inside it up to the matching #block helper found in default.hbs -->


        <!-- Previous/next page links - displayed on every page -->
        

        <!-- The footer at the very bottom of the screen -->
        <footer class="site-footer outer">
            <div class="site-footer-content inner">
                <section class="copyright"><a href="https://leejigun.github.io/">iOS 삽질 블로그</a> &copy; 2025</section>
                <section class="poweredby">Github page blog of <a href="https://github.com/Leejigun">Leejigun</a> &
                    <a href="https://pages.github.com/" target="_blank" rel="noopener">GitHub Pages</a> using
                    <a href="https://github.com/jekyller/jasper2" target="_blank" rel="noopener">Jasper2</a></section>
                <nav class="site-footer-nav">
                    <a href="/">Latest Posts</a>
                    
                    
                    <!-- <a href="https://ghost.org" target="_blank" rel="noopener">Ghost</a> -->
                </nav>
            </div>
        </footer>

    </div>

    <!-- The big email subscribe modal content -->
    

    <!-- highlight.js -->
    <script src="https://cdnjs.cloudflare.com/ajax/libs/prism/1.10.0/components/prism-abap.min.js"></script>
    <script>$(document).ready(function() {
      $('pre code').each(function(i, block) {
        hljs.highlightBlock(block);
      });
    });</script>

    <!-- jQuery + Fitvids, which makes all video embeds responsive -->
    <script
        src="https://code.jquery.com/jquery-3.2.1.min.js"
        integrity="sha256-hwg4gsxgFZhOsEEamdOYGBf13FyQuiTwlAQgxVSNgt4="
        crossorigin="anonymous">
    </script>
    <script type="text/javascript" src="/assets/js/jquery.fitvids.js"></script>
    


    <!-- Paginator increased to "infinit" in _config.yml -->
    <!-- if paginator.posts  -->
    <!-- <script>
        var maxPages = parseInt('');
    </script>
    <script src="/assets/js/infinitescroll.js"></script> -->
    <!-- /endif -->

    


    <!-- Add Google Analytics  -->
    <!-- Google Analytics Tracking code -->
 <script>
  (function(i,s,o,g,r,a,m){i['GoogleAnalyticsObject']=r;i[r]=i[r]||function(){
  (i[r].q=i[r].q||[]).push(arguments)},i[r].l=1*new Date();a=s.createElement(o),
  m=s.getElementsByTagName(o)[0];a.async=1;a.src=g;m.parentNode.insertBefore(a,m)
  })(window,document,'script','//www.google-analytics.com/analytics.js','ga');

  ga('create', 'UA-154736789-1', 'auto');
  ga('send', 'pageview');

 </script>


    <!-- The #block helper will pull in data from the #contentFor other template files. In this case, there's some JavaScript which we only want to use in post.hbs, but it needs to be included down here, after jQuery has already loaded. -->
    
        <script>

// NOTE: Scroll performance is poor in Safari
// - this appears to be due to the events firing much more slowly in Safari.
//   Dropping the scroll event and using only a raf loop results in smoother
//   scrolling but continuous processing even when not scrolling
$(document).ready(function () {
    // Start fitVids
    var $postContent = $(".post-full-content");
    $postContent.fitVids();
    // End fitVids

    var progressBar = document.querySelector('progress');
    var header = document.querySelector('.floating-header');
    var title = document.querySelector('.post-full-title');

    var lastScrollY = window.scrollY;
    var lastWindowHeight = window.innerHeight;
    var lastDocumentHeight = $(document).height();
    var ticking = false;

    function onScroll() {
        lastScrollY = window.scrollY;
        requestTick();
    }

    function onResize() {
        lastWindowHeight = window.innerHeight;
        lastDocumentHeight = $(document).height();
        requestTick();
    }

    function requestTick() {
        if (!ticking) {
            requestAnimationFrame(update);
        }
        ticking = true;
    }

    function update() {
        var trigger = title.getBoundingClientRect().top + window.scrollY;
        var triggerOffset = title.offsetHeight + 35;
        var progressMax = lastDocumentHeight - lastWindowHeight;

        // show/hide floating header
        if (lastScrollY >= trigger + triggerOffset) {
            header.classList.add('floating-active');
        } else {
            header.classList.remove('floating-active');
        }

        progressBar.setAttribute('max', progressMax);
        progressBar.setAttribute('value', lastScrollY);

        ticking = false;
    }

    window.addEventListener('scroll', onScroll, {passive: true});
    window.addEventListener('resize', onResize, false);

    update();
});
</script>

    

    <!-- Ghost outputs important scripts and data with this tag - it should always be the very last thing before the closing body tag -->
    <!-- ghost_foot -->

</body>
</html>
