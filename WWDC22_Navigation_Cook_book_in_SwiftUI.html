<!-- footer도 여기에 있음 -->


<!DOCTYPE html>
<html>
<head>

    <!-- Document Settings -->
    <meta charset="utf-8" />
    <meta http-equiv="X-UA-Compatible" content="IE=edge" />

    <!-- Base Meta -->
    <!-- iOS-tip 이라고 태그를 만들었으면 post에서는 iOS tip 이라고 태그를 줘야한다. -->
<!-- dynamically fixing the title for tag/author pages -->



    <title>[WWDC22] Navigation Cook book in SwiftUI</title>
    <meta name="HandheldFriendly" content="True" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <!-- Styles'n'Scripts -->
    <link rel="stylesheet" type="text/css" href="/assets/built/screen.css" />
    <link rel="stylesheet" type="text/css" href="/assets/built/screen.edited.css" />
    <link rel="stylesheet" type="text/css" href="/assets/built/syntax.css" />
    <!-- highlight.js -->
    <link rel="stylesheet" href="//cdnjs.cloudflare.com/ajax/libs/highlight.js/9.12.0/styles/default.min.css">
    <style>.hljs { background: none; }</style>

    <!-- This tag outputs SEO meta+structured data and other important settings -->
    <meta name="description" content="[WWDC22] Navigation Cook book in SwiftUI" />
    <link rel="shortcut icon" href="https://leejigun.github.io//assets/images/blog-icon.png" type="image/png" />
    <link rel="canonical" href="https://leejigun.github.io//WWDC22_Navigation_Cook_book_in_SwiftUI" />
    <meta name="referrer" content="no-referrer-when-downgrade" />

     <!--title below is coming from _includes/dynamic_title-->
    <meta property="og:site_name" content="iOS 삽질 블로그" />
    <meta property="og:type" content="website" />
    <meta property="og:title" content="[WWDC22] Navigation Cook book in SwiftUI" />
    <meta property="og:description" content="WWDC22 - Navigation Cook book in SwiftUI developer.apple.com/wwdc22/10054/ SwiftUI를 사용하면서 항상 문제가 되는 부분은 Navigation입니다. 이번 iOS16 업데이트에서 딥링크, 프로그래밍적 navigation 등 다양한 장벽들을 해소할 수 있는 새로운 API가 많이 등장했습니다. 개인적으로 iOS 16부터 본격적으로 기존 UIKit을 대체할 수 있을 것으로 생각합니다. 기존에는 어떤 아이템의 상세 정보를 보기 위해서 NavigationLink와" />
    <meta property="og:url" content="https://leejigun.github.io//WWDC22_Navigation_Cook_book_in_SwiftUI" />
    <meta property="og:image" content="https://leejigun.github.io//assets/images/SwiftUI/2023-03-15-WWDC22_Navigation_Cook_book_in_SwiftUI/Untitled.png" />
    <meta property="article:publisher" content="https://www.facebook.com/" />
    <meta property="article:author" content="https://www.facebook.com/" />
    <meta property="article:published_time" content="2023-03-15T09:00:01+09:00" />
    <meta property="article:modified_time" content="2023-03-15T09:00:01+09:00" />
    <meta property="article:tag" content="Ios" />
    <meta name="twitter:card" content="summary_large_image" />
    <meta name="twitter:title" content="[WWDC22] Navigation Cook book in SwiftUI" />
    <meta name="twitter:description" content="WWDC22 - Navigation Cook book in SwiftUI developer.apple.com/wwdc22/10054/ SwiftUI를 사용하면서 항상 문제가 되는 부분은 Navigation입니다. 이번 iOS16 업데이트에서 딥링크, 프로그래밍적 navigation 등 다양한 장벽들을 해소할 수 있는 새로운 API가 많이 등장했습니다. 개인적으로 iOS 16부터 본격적으로 기존 UIKit을 대체할 수 있을 것으로 생각합니다. 기존에는 어떤 아이템의 상세 정보를 보기 위해서 NavigationLink와" />
    <meta name="twitter:url" content="https://leejigun.github.io//" />
    <meta name="twitter:image" content="https://leejigun.github.io//assets/images/SwiftUI/2023-03-15-WWDC22_Navigation_Cook_book_in_SwiftUI/Untitled.png" />
    <meta name="twitter:label1" content="Written by" />
    <meta name="twitter:data1" content="iOS 삽질 블로그" />
    <meta name="twitter:label2" content="Filed under" />
    <meta name="twitter:data2" content="Ios" />
    <meta name="twitter:site" content="@" />
    <meta name="twitter:creator" content="@" />
    <meta property="og:image:width" content="1400" />
    <meta property="og:image:height" content="933" />

    <script type="application/ld+json">
{
    "@context": "https://schema.org",
    "@type": "Website",
    "publisher": {
        "@type": "Organization",
        "name": "iOS 삽질 블로그",
        "logo": "https://leejigun.github.io//assets/images/blog-icon.png"
    },
    "url": "https://leejigun.github.io//WWDC22_Navigation_Cook_book_in_SwiftUI",
    "image": {
        "@type": "ImageObject",
        "url": "https://leejigun.github.io//assets/images/SwiftUI/2023-03-15-WWDC22_Navigation_Cook_book_in_SwiftUI/Untitled.png",
        "width": 2000,
        "height": 666
    },
    "mainEntityOfPage": {
        "@type": "WebPage",
        "@id": "https://leejigun.github.io//WWDC22_Navigation_Cook_book_in_SwiftUI"
    },
    "description": "WWDC22 - Navigation Cook book in SwiftUI developer.apple.com/wwdc22/10054/ SwiftUI를 사용하면서 항상 문제가 되는 부분은 Navigation입니다. 이번 iOS16 업데이트에서 딥링크, 프로그래밍적 navigation 등 다양한 장벽들을 해소할 수 있는 새로운 API가 많이 등장했습니다. 개인적으로 iOS 16부터 본격적으로 기존 UIKit을 대체할 수 있을 것으로 생각합니다. 기존에는 어떤 아이템의 상세 정보를 보기 위해서 NavigationLink와"
}
    </script>

    <!-- <script type="text/javascript" src="https://demo.ghost.io/public/ghost-sdk.min.js?v=724281a32e"></script>
    <script type="text/javascript">
    ghost.init({
    	clientId: "ghost-frontend",
    	clientSecret: "f84a07a72b17"
    });
    </script> -->

    <meta name="generator" content="Jekyll 3.6.2" />
    <link rel="alternate" type="application/rss+xml" title="[WWDC22] Navigation Cook book in SwiftUI" href="/feed.xml" />


</head>
<body class="post-template">

    <div class="site-wrapper">
        <!-- All the main content gets inserted here, index.hbs, post.hbs, etc -->

        <!-- HTML elements for search -->

        <!-- default -->

<!-- The tag above means: insert everything in this file
into the {body} of the default.hbs template -->

<header class="site-header outer">
    <div class="inner">
        <!-- 네비게이션 바 -->
<nav class="site-nav">
    <div class="site-nav-left">
        
            
                <a class="site-nav-logo" href="https://leejigun.github.io//"><img src="/assets/images/blog-icon.png" alt="iOS 삽질 블로그" /></a>
            
        
        
            <!-- 여기서 navigation 에 표시할 이이템 추가 -->
<ul class="nav" role="menu">
    <li class="nav-home" role="menuitem"><a href="/">Home</a></li>
    <li class="nav-about" role="menuitem"><a href="/about/">About</a></li>
    <li class="nav-getting-started" role="menuitem"><a href="/tag/ios/">iOS</a></li>
    <li class="nav-getting-started" role="menuitem"><a href="/tag/watchos/">watchOS</a></li>
    <li class="nav-getting-started" role="menuitem"><a href="/tag/rxswift/">RxSwift</a></li>
    <li class="nav-getting-started" role="menuitem"><a href="/tag/swiftui/">swiftui</a></li>
    <li class="nav-getting-started" role="menuitem"><a href="/tag/project/">project</a></li>
    <li class="nav-getting-started" role="menuitem"><a href="/tag/ml/">ML</a></li>
    <li class="nav-getting-started" role="menuitem"><a href="/tag/cs/">CS</a></li>
    <li class="nav-getting-started" role="menuitem"><a href="/tag/flutter/">flutter</a></li>
    <li class="nav-try-ghost" role="menuitem"><a href="https://github.com/Leejigun">github</a></li>
    <li class="nav-try-ghost" role="menuitem"><a href="https://leejigun.notion.site/d96873c479d049cbb3f2476aa7990347?v=84936e8007664a6daaa211463819028d">notion</a></li>
    <li class="nav-try-ghost" role="menuitem"><a href="/search.html">Search</a></li>
</ul>

        
    </div>
    <div class="site-nav-right">
        <div class="social-links">
            
            
        </div>
        
    </div>
</nav>

    </div>
</header>

<!-- Everything inside the #post tags pulls data from the post -->
<!-- #post -->

<main id="site-main" class="site-main outer" role="main">
    <div class="inner">

        <article class="post-full post tag-getting-started ">

            <header class="post-full-header">
                <section class="post-full-meta">
                    <time class="post-full-meta-date" datetime="15 March 2023">15 March 2023</time>
                    
                        <span class="date-divider">/</span>
                        
                            
                               <a href='/tag/ios/'>IOS</a>,
                            
                        
                            
                               <a href='/tag/swiftui/'>SWIFTUI</a>
                            
                        
                    
                </section>
                <h1 class="post-full-title">[WWDC22] Navigation Cook book in SwiftUI</h1>
            </header>

            
            <figure class="post-full-image" style="background-image: url(/assets/images/SwiftUI/2023-03-15-WWDC22_Navigation_Cook_book_in_SwiftUI/Untitled.png)">
            </figure>
            

            <section class="post-full-content">
                <div class="kg-card-markdown">
                    <h1 id="wwdc22---navigation-cook-book-in-swiftui">WWDC22 - Navigation Cook book in SwiftUI</h1>

<ul>
  <li><a href="http://developer.apple.com/wwdc22/10054/">developer.apple.com/wwdc22/10054/</a></li>
</ul>

<blockquote>
  <p>SwiftUI를 사용하면서 항상 문제가 되는 부분은 Navigation입니다. 이번 iOS16 업데이트에서 딥링크, 프로그래밍적 navigation 등 다양한 장벽들을 해소할 수 있는 새로운 API가 많이 등장했습니다. 개인적으로 iOS 16부터 본격적으로 기존 UIKit을 대체할 수 있을 것으로 생각합니다.</p>

</blockquote>

<p>기존에는 어떤 아이템의 상세 정보를 보기 위해서 <code class="highlighter-rouge">NavigationLink</code>와 <code class="highlighter-rouge">Bool</code> 값인 <code class="highlighter-rouge">state property</code>를 사용해야 했습니다.</p>

<p>아래 코드에서 “<code class="highlighter-rouge">Details</code>“를 선택하면 <code class="highlighter-rouge">showDetail</code> 값이 <code class="highlighter-rouge">true</code>로 변경되며 <code class="highlighter-rouge">DetailView</code>가 표시됩니다. 프로그래밍적으로 이를 제어하려면 로컬 <code class="highlighter-rouge">state property</code>인 <code class="highlighter-rouge">showDetail</code> 값을 <code class="highlighter-rouge">true</code>로 변경해야 합니다.</p>

<p>만약 <code class="highlighter-rouge">DetailView</code>와 같은 특정 조건에 따라 진입해야 하는 다양한 종류의 <code class="highlighter-rouge">View</code>가 있다면, 해당 <code class="highlighter-rouge">path</code>에 대해 각각의 <code class="highlighter-rouge">Bool</code> 값 <code class="highlighter-rouge">state property</code>가 필요합니다.</p>

<div class="language-swift highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="kt">NavigationLink</span><span class="p">(</span><span class="s">"Details"</span><span class="p">,</span> <span class="nv">isActive</span><span class="p">:</span> <span class="err">$</span><span class="n">item</span><span class="o">.</span><span class="n">showDetail</span><span class="p">)</span> <span class="p">{</span> 
	<span class="kt">DetailView</span><span class="p">()</span>
<span class="p">}</span>
</code></pre></div></div>

<p>새로운 네비게이션 API에서는 전체를 하나의 스택으로 만들 수 있습니다. 이때, <code class="highlighter-rouge">path</code>는 <code class="highlighter-rouge">UIViewController</code>의 <code class="highlighter-rouge">ViewControllers</code> 배열처럼 각각의 <code class="highlighter-rouge">path</code> 값을 스택으로 가지고 있기 때문에 훨씬 직관적이고 프로그램적으로 컨트롤하기 쉬워졌습니다.</p>

<p>덕분에 SwiftUI Navigation에서 가장 큰 걸림돌인 deep link나 pot to root 같은 것들을 쉽게 프로그램적으로 컨트롤할 수 있습니다.</p>

<div class="language-swift highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="kt">NavigationStack</span><span class="p">(</span><span class="nv">path</span><span class="p">:</span> <span class="err">$</span><span class="n">path</span><span class="p">)</span> <span class="p">{</span>
	<span class="kt">NavigationLink</span><span class="p">(</span><span class="s">"Details"</span><span class="p">,</span> <span class="nv">value</span><span class="p">:</span> <span class="n">value</span><span class="p">)</span>
<span class="p">}</span>
</code></pre></div></div>

<p>이번 포스트에서 분석할 화면은 아래와 같습니다. 화면의 좌측부터 아이템을 선택하면 우측으로 심층적으로 내려가도록 되어 있습니다. <code class="highlighter-rouge">NavigationSplitView</code>에서는 좌측부터 <code class="highlighter-rouge">Sidebar</code>, <code class="highlighter-rouge">content</code>, <code class="highlighter-rouge">detail</code>이라고 부릅니다.</p>

<p><img src="assets/images/SwiftUI/2023-03-15-WWDC22_Navigation_Cook_book_in_SwiftUI/Untitled.png" alt="Untitled" /></p>

<h2 id="new-navigation-apis">New Navigation APIs</h2>

<p>다음 파트에서 자세한 설명을 다룰 부분은 있지만, 여기서는 새롭게 추가된 내용만 간략히 살펴보겠습니다.</p>

<h3 id="1-navigationstack">1. NavigationStack</h3>

<p><code class="highlighter-rouge">NavigationStack</code>은 워치, 아이폰 등에서 볼 수 있는 푸시 스타일을 제공합니다. 앞서 보여준 것과 같이 <code class="highlighter-rouge">path</code> 배열을 추가하여 프로그래밍적으로 컨트롤할 수 있습니다.</p>

<div class="language-swift highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="kd">@State</span> <span class="kd">private</span> <span class="k">var</span> <span class="nv">path</span><span class="p">:</span> <span class="p">[</span><span class="kt">Value</span><span class="p">]</span> <span class="o">=</span> <span class="p">[]</span>
<span class="o">...</span>
<span class="kt">NavigationStack</span><span class="p">(</span><span class="nv">path</span><span class="p">:</span> <span class="err">$</span><span class="n">path</span><span class="p">)</span> <span class="p">{</span>
	<span class="kt">NavigationLink</span><span class="p">(</span><span class="s">"Details"</span><span class="p">,</span> <span class="nv">value</span><span class="p">:</span> <span class="n">value</span><span class="p">)</span>
<span class="p">}</span>
</code></pre></div></div>

<h3 id="2-navigationsplitview">2. NavigationSplitView</h3>

<p><code class="highlighter-rouge">NavigationSplitView</code>를 사용하면 메일, 할 일 목록 등 다중 열 화면을 만들 수 있습니다. 각 열의 너비나 사이드 바와 같은 세부 조정이 가능합니다. 이번 포스트에서는 Navigation 컨테이너를 중요하게 다룰 예정입니다.</p>

<div class="language-swift highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="kt">NavigationSplitView</span> <span class="p">{</span>
	<span class="kt">RecipeCategories</span><span class="p">()</span>
<span class="p">}</span> <span class="nv">content</span><span class="p">:</span> <span class="p">{</span>
	<span class="kt">RecipeList</span><span class="p">()</span>
<span class="p">}</span> <span class="nv">detail</span><span class="p">:</span> <span class="p">{</span>
	<span class="kt">RecipeDetail</span><span class="p">()</span>
<span class="p">}</span>
</code></pre></div></div>

<p>자세한 설명은 WWDC22 “SwiftUI on iPad: Organize your interface” 동영상에서 확인할 수 있습니다.</p>

<h3 id="3-navigationlink">3. NavigationLink</h3>

<p>기존 <code class="highlighter-rouge">NavigationLink</code>는 타이틀과 해당 네비게이션의 액션으로 <code class="highlighter-rouge">노출할 View</code>로 구성되어 있었습니다. 그러나 변경된 구조에서는 View가 제거되고 타이틀과 <code class="highlighter-rouge">Value</code>만 남게 되었습니다.</p>

<p>그러면 <code class="highlighter-rouge">NavigationLink</code>를 선택했을 때 이동할 <code class="highlighter-rouge">destination View</code>는 어디에 있을까요? <code class="highlighter-rouge">NavigationLink</code>가 아닌 <code class="highlighter-rouge">navigationDestination modifier</code>를 통해 구현하게 됩니다. 이에 대해서는 아래에서 자세히 설명하겠습니다.</p>

<p>아래 예시에서 <code class="highlighter-rouge">NavigationLink</code>에 해당하는 <code class="highlighter-rouge">Value</code>는 <code class="highlighter-rouge">"applePieRecipe"</code>입니다. 헤딩 아이템을 선택하면 <code class="highlighter-rouge">"applePieRecipe"</code>의 세부 화면으로 이동하게 됩니다.</p>

<div class="language-swift highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="kt">NavigationLink</span><span class="p">(</span><span class="s">"Show detail"</span><span class="p">)</span> <span class="p">{</span>
	<span class="kt">DetailView</span><span class="p">()</span>
<span class="p">}</span>
<span class="kt">NavigationLink</span><span class="p">(</span><span class="s">"Apple Pie"</span><span class="p">,</span> <span class="nv">value</span><span class="p">:</span> <span class="n">applePieRecipe</span><span class="p">)</span>
</code></pre></div></div>

<h2 id="recipes-for-navigation">Recipes for navigation</h2>

<h3 id="navigationstack">NavigationStack</h3>

<p>위에서 소개된 새로운 API들을 이용하여 실제 레시피 네비게이션을 하는 방법에 대해 살펴보겠습니다.</p>

<p>가장 먼저 할 일은 iOS 앱이나 워치에서 많이 사용하는 <code class="highlighter-rouge">NavigationStack</code>을 통한 push 네비게이션을 살펴보는 것입니다.</p>

<p>기존의 SwiftUI <code class="highlighter-rouge">NavigationLink</code>를 기반으로 작성하면 아래와 같습니다. 타이틀과 <code class="highlighter-rouge">destination View</code>의 링크를 설정합니다. 이 방법으로도 충분히 원하는 효과를 낼 수 있습니다.</p>

<p>사용자의 터치 액션 뿐만 아니라 푸시, 타이머, 에러 등 다양한 이벤트에 대해 필요한 화면을 사용자에게 표시해야 합니다. 그러나 현재 이 방법으로는 프로그래밍적으로 해당 네비게이션을 제어하는 방법이 없습니다.</p>

<div class="language-swift highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="kt">NavigationLink</span><span class="p">(</span><span class="n">recipe</span><span class="o">.</span><span class="n">name</span><span class="p">)</span> <span class="p">{</span>
	<span class="kt">RecipeDetail</span><span class="p">(</span><span class="nv">recipe</span><span class="p">:</span> <span class="n">recipe</span><span class="p">)</span>
<span class="p">}</span>
</code></pre></div></div>

<p>프로그래밍적으로 <code class="highlighter-rouge">NavigationLink</code>를 사용하기 위해서는 해당 액션을 두 가지로 분리해야 합니다.</p>

<ol>
  <li>해당 액션을 상징하는 값 (Path Value)</li>
  <li>그 값에 해당하는 뷰 (Destination View)</li>
</ol>

<p>이 두 가지를 준비하고 나면, <code class="highlighter-rouge">NavigationLink</code>를 생성하는 코드를 작성할 수 있습니다.</p>

<p>먼저 해당 네비게이션의 Destination을 설정합니다. 이 때 Value의 타입을 <code class="highlighter-rouge">Recipe.self</code> 타입으로 설정하여 해당 <code class="highlighter-rouge">NavigationLink</code> 이벤트가 발생할 때 데이터를 전달할 수 있습니다.</p>

<p>따라서, 타입이 각각 다른 복수의 <code class="highlighter-rouge">NavigationLink</code>를 사용하더라도, 그에 매칭되는 <code class="highlighter-rouge">NavigationDestination</code>을 다수 추가한다면, 다양한 네비게이션을 구현할 수 있습니다.</p>

<div class="language-swift highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="o">.</span><span class="nf">navigationDestination</span><span class="p">(</span><span class="nv">for</span><span class="p">:</span> <span class="kt">Recipe</span><span class="o">.</span><span class="k">self</span><span class="p">)</span> <span class="p">{</span> <span class="n">recipe</span> <span class="k">in</span>
	<span class="kt">RecipeDetail</span><span class="p">(</span><span class="nv">recipe</span><span class="p">:</span> <span class="n">recipe</span><span class="p">)</span>
<span class="p">}</span>
</code></pre></div></div>

<p>이제 새롭게 추가된 <code class="highlighter-rouge">NavigationLink</code>의 value를 사용하여 아래와 같은 방식으로 <code class="highlighter-rouge">NavigationLink</code> 이벤트를 발생시키면 해당 타입의 <code class="highlighter-rouge">navigationDestination</code>으로 이동합니다.</p>

<div class="language-swift highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="kt">NavigationLink</span><span class="p">(</span><span class="n">recipe</span><span class="o">.</span><span class="n">name</span><span class="p">,</span> <span class="nv">value</span><span class="p">:</span> <span class="n">recipe</span><span class="p">)</span>
</code></pre></div></div>

<p><code class="highlighter-rouge">NavigationStack</code>, <code class="highlighter-rouge">Path</code>, <code class="highlighter-rouge">navigationDestination</code>의 관계를 아래와 같이 살펴보면, <code class="highlighter-rouge">NavigationLink</code>가 발생하면 <code class="highlighter-rouge">path</code>에 value가 추가됩니다. 그러면 이 value에 해당하는 <code class="highlighter-rouge">navigationDestination</code>이 View를 만들어 <code class="highlighter-rouge">pushed views</code>에 추가됩니다.</p>

<p><img src="assets/images/SwiftUI/2023-03-15-WWDC22_Navigation_Cook_book_in_SwiftUI/Untitled%201.png" alt="Untitled" /></p>

<p>실제로 구현한다면, 레시피 배열을 <code class="highlighter-rouge">NavigationStack</code>의 경로로 사용할 수 있습니다.</p>

<div class="language-swift highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="kd">@State</span> <span class="kd">private</span> <span class="k">var</span> <span class="nv">path</span><span class="p">:</span> <span class="p">[</span><span class="kt">Recipe</span><span class="p">]</span> <span class="o">=</span> <span class="p">[]</span>
</code></pre></div></div>

<p>View를 1:1로 매칭하는 path를 가지고 있기 때문에 프로그램적으로 path를 추가하거나 빼는 것이 가능합니다. 흥미로운 점은, 이렇게 프로그램적으로 path에 item을 추가해도 push나 pop 되는 애니메이션이 발생하기 때문에 자연스럽게 추가하거나 제거할 수 있다는 것입니다.</p>

<div class="language-swift highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="kd">func</span> <span class="nf">showRecipeOfTheDay</span><span class="p">()</span> <span class="p">{</span>
    <span class="n">path</span> <span class="o">=</span> <span class="p">[</span><span class="n">dataModel</span><span class="o">.</span><span class="n">recipeOfTheDay</span><span class="p">]</span>
<span class="p">}</span>

<span class="kd">func</span> <span class="nf">popToRoot</span><span class="p">()</span> <span class="p">{</span>
	<span class="n">path</span><span class="o">.</span><span class="nf">removeAll</span><span class="p">()</span>
<span class="p">}</span>
</code></pre></div></div>

<p>이러한 push 형태의 NavigationStack은 아이패드, 맥, 아이폰, 워치 등 모든 애플 기기에서 잘 동작합니다. NavigationStack에 대해 자세히 알아보고 싶다면, WWDC22 Build a productivity app for Apple Watch 영상에서 확인할 수 있습니다.</p>

<h3 id="navigationsplitview">NavigationSplitView</h3>

<p><code class="highlighter-rouge">NavigationSplitView</code>는 이미지와 같이 최대 3단까지 계층형으로 View를 노출할 수 있는 컨테이너입니다. 이 컨테이너는 아이패드와 macOS 같은 환경에서 많이 사용됩니다. 아이폰과 애플워치에서는 자동으로 stack 형태로 노출되므로 매우 유용하게 사용할 수 있습니다. 아래 화면도 <code class="highlighter-rouge">NavigationSplitView</code> + <code class="highlighter-rouge">NavigationLink</code> + <code class="highlighter-rouge">List</code>로 구성되어 있습니다.</p>

<p><img src="assets/images/SwiftUI/2023-03-15-WWDC22_Navigation_Cook_book_in_SwiftUI/Untitled%202.png" alt="Untitled" /></p>

<p>먼저 왼쪽의 Categories를 구현하기 위해 다음과 같이 작성합니다. <code class="highlighter-rouge">NavigationStack</code>에서 <code class="highlighter-rouge">NavigationLink</code>에 값을 적용하는 방법을 앞서 살펴보았습니다. 이번에도 value 값을 적용하는데, <code class="highlighter-rouge">NavigationStack</code>에서는 value 값을 <code class="highlighter-rouge">path: [Recipe]</code>에 저장했지만, 이번에는 <code class="highlighter-rouge">List</code>에서 <code class="highlighter-rouge">selection</code>을 사용하여 <code class="highlighter-rouge">@State 변수</code>에 저장하도록 했습니다.</p>

<p>이번 업데이트에서는 <code class="highlighter-rouge">List</code>를 활용할 수 있는 다양한 방법들이 추가되었습니다. 자세한 내용은 WWDC22 SwiftUI on iPad: Organize your interface 영상에서 확인할 수 있습니다.</p>

<div class="language-swift highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="kd">@State</span> <span class="kd">private</span> <span class="k">var</span> <span class="nv">selectedCategory</span><span class="p">:</span> <span class="kt">Category</span><span class="p">?</span>

<span class="o">...</span>

<span class="kt">NavigationSplitView</span> <span class="p">{</span>
    <span class="kt">List</span><span class="p">(</span><span class="kt">Category</span><span class="o">.</span><span class="n">allCases</span><span class="p">,</span> <span class="nv">selection</span><span class="p">:</span> <span class="err">$</span><span class="n">selectedCategory</span><span class="p">)</span> <span class="p">{</span> <span class="n">category</span> <span class="k">in</span>
        <span class="kt">NavigationLink</span><span class="p">(</span><span class="n">category</span><span class="o">.</span><span class="n">localizedName</span><span class="p">,</span> <span class="nv">value</span><span class="p">:</span> <span class="n">category</span><span class="p">)</span>
    <span class="p">}</span>
    <span class="o">.</span><span class="nf">navigationTitle</span><span class="p">(</span><span class="s">"Categories"</span><span class="p">)</span>
<span class="p">}</span> <span class="nv">content</span><span class="p">:</span> <span class="p">{</span>
	<span class="o">...</span>
<span class="p">}</span> <span class="nv">detail</span><span class="p">:</span> <span class="p">{</span>
  <span class="o">...</span>
<span class="p">}</span>
</code></pre></div></div>

<p>다음으로, 중간 content UI를 만들어야 합니다. 앞선 내용의 반복입니다. 이 부분에서도 앞서 <code class="highlighter-rouge">selectedCategory</code> 값을 알기 때문에, 해당하는 <code class="highlighter-rouge">Recipe 배열</code>을 <code class="highlighter-rouge">dataModel</code>에서 가져와서 <code class="highlighter-rouge">List</code>를 구성하도록 합니다. 이번에도 <code class="highlighter-rouge">NavigationLink</code>의 <code class="highlighter-rouge">selection value</code>를 <code class="highlighter-rouge">selectedRecipe</code>라는 지역 변수에 저장하도록 합니다.</p>

<p><code class="highlighter-rouge">selectedCategory</code>는 <code class="highlighter-rouge">@State property</code>로 선언되어 있으며 해당 View의 컨텍스트 내부에 있습니다. 따라서 <code class="highlighter-rouge">@State property</code>가 변경되면 <code class="highlighter-rouge">body</code>를 새로 만들게 되고 <code class="highlighter-rouge">NavigationSplitView</code>의 content 부분도 재 호출되어 <code class="highlighter-rouge">List</code>가 다시 그려지게 됩니다.</p>

<p>동일한 원리로 content 내부의 리스트에서 아이템을 선택하여 <code class="highlighter-rouge">selectedRecipe</code>가 변경되면, <code class="highlighter-rouge">body</code>가 다시 그려집니다.</p>

<div class="language-swift highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="kd">@State</span> <span class="kd">private</span> <span class="k">var</span> <span class="nv">selectedCategory</span><span class="p">:</span> <span class="kt">Category</span><span class="p">?</span>
<span class="kd">@State</span> <span class="kd">private</span> <span class="k">var</span> <span class="nv">selectedRecipe</span><span class="p">:</span> <span class="kt">Recipe</span><span class="p">?</span>
<span class="o">...</span>

<span class="kt">NavigationSplitView</span> <span class="p">{</span>
  <span class="o">...</span>
<span class="p">}</span> <span class="nv">content</span><span class="p">:</span> <span class="p">{</span>
	<span class="kt">List</span><span class="p">(</span><span class="n">dataModel</span><span class="o">.</span><span class="nf">recipes</span><span class="p">(</span><span class="nv">in</span><span class="p">:</span> <span class="n">selectedCategory</span><span class="p">),</span> <span class="nv">selection</span><span class="p">:</span> <span class="err">$</span><span class="n">selectedRecipe</span><span class="p">)</span> <span class="p">{</span> <span class="n">recipe</span> <span class="k">in</span>
	  <span class="kt">NavigationLink</span><span class="p">(</span><span class="n">recipe</span><span class="o">.</span><span class="n">name</span><span class="p">,</span> <span class="nv">value</span><span class="p">:</span> <span class="n">recipe</span><span class="p">)</span>
	<span class="p">}</span>
	<span class="o">.</span><span class="nf">navigationTitle</span><span class="p">(</span><span class="n">selectedCategory</span><span class="p">?</span><span class="o">.</span><span class="n">localizedName</span> <span class="p">??</span> <span class="s">"Recipes"</span><span class="p">)</span>
<span class="p">}</span> <span class="nv">detail</span><span class="p">:</span> <span class="p">{</span>
  <span class="o">...</span>
<span class="p">}</span>
</code></pre></div></div>

<p>마지막으로, <code class="highlighter-rouge">Recipe</code>에 대한 <code class="highlighter-rouge">Detail</code>을 업데이트하기 위해 <code class="highlighter-rouge">RecipeDetail</code>을 업데이트합니다.</p>

<div class="language-swift highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="kt">NavigationSplitView</span> <span class="p">{</span>
  <span class="o">...</span>
<span class="p">}</span> <span class="nv">content</span><span class="p">:</span> <span class="p">{</span>
	<span class="o">...</span>
<span class="p">}</span> <span class="nv">detail</span><span class="p">:</span> <span class="p">{</span>
  <span class="kt">RecipeDetail</span><span class="p">(</span><span class="nv">recipe</span><span class="p">:</span> <span class="n">selectedRecipe</span><span class="p">)</span>
<span class="p">}</span>
</code></pre></div></div>

<p>만약 이 부분을 프로그래밍적으로 수정하고 싶다면 어떻게 해야 할까요? <code class="highlighter-rouge">NavigationStack</code>에서는 로컬 변수 <code class="highlighter-rouge">path</code>를 조작하여 해당 네비게이션을 프로그래밍적으로 수정할 수 있었습니다. <code class="highlighter-rouge">NavigationSplitView</code>도 로컬 변수 <code class="highlighter-rouge">selectedCategory</code>와 <code class="highlighter-rouge">selectedRecipe</code>를 사용하고 있으므로, 아래와 같이 직접 데이터를 적용하면 동일한 애니메이션과 함께 UI 업데이트를 수행할 수 있습니다.</p>

<div class="language-swift highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="kd">func</span> <span class="nf">showRecipeOfTheDat</span><span class="p">()</span> <span class="p">{</span>
	<span class="k">let</span> <span class="nv">recipe</span> <span class="o">=</span> <span class="n">dataModel</span><span class="o">.</span><span class="n">recipeOfTheDay</span>
	<span class="n">selectedCategory</span> <span class="o">=</span> <span class="n">recipe</span><span class="o">.</span><span class="n">category</span>
	<span class="n">selectedRecipe</span> <span class="o">=</span> <span class="n">recipe</span>
<span class="p">}</span>
</code></pre></div></div>

<h3 id="navigationsplitview--navigationstack">NavigationSplitView + NavigationStack</h3>

<p>조금 더 복잡한 화면을 구현해 보겠습니다. 이번에는 두 개의 열로 구성되며, 아이템을 누르면 전체 세부 정보가 표시되는 View가 Push 되는 경우입니다. 이번 화면 구현에서는 이전에 소개된 모든 View를 사용하여 만들 수 있으며, 다음과 같은 View가 사용됩니다.</p>

<ul>
  <li><code class="highlighter-rouge">NavigationSplitView</code></li>
  <li><code class="highlighter-rouge">NavigationStack</code></li>
  <li><code class="highlighter-rouge">NavigationLink</code></li>
  <li><code class="highlighter-rouge">nvigationDestination(for:)</code></li>
  <li><code class="highlighter-rouge">List</code></li>
</ul>

<p><img src="assets/images/SwiftUI/2023-03-15-WWDC22_Navigation_Cook_book_in_SwiftUI/Untitled%203.png" alt="Untitled" /></p>

<p>좌측 Categories는 앞서 설명한 것과 동일하기 때문에 코드만 첨부하고 넘어갑니다. 이전 부분과 다른 점은 이번에는 content가 없기 때문에 <code class="highlighter-rouge">NavigationSplitView</code>에서 <code class="highlighter-rouge">Sidebar</code>와 <code class="highlighter-rouge">detail</code>만 구현합니다.</p>

<p>이전에 살펴본 것과 마찬가지로, path를 만들어서 추가합니다. 이렇게 하면 <code class="highlighter-rouge">NavigationSplitView</code> 전체에 프로그래밍 방식으로 네비게이션을 구현할 수 있습니다.</p>

<p>이번에 detail 부분에서는 그리드 화면을 만들어야 하기 때문에 코드 양이 좀 많습니다. 따라서 별도의 <code class="highlighter-rouge">RecipeGrid</code> 뷰를 만들어서 자세히 살펴보겠습니다.</p>

<div class="language-swift highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="kd">@State</span> <span class="kd">private</span> <span class="k">var</span> <span class="nv">selectedCategory</span><span class="p">:</span> <span class="kt">Category</span><span class="p">?</span>
<span class="kd">@State</span> <span class="kd">private</span> <span class="k">var</span> <span class="nv">path</span><span class="p">:</span> <span class="p">[</span><span class="kt">Recipe</span><span class="p">]</span> <span class="o">=</span> <span class="p">[]</span>
<span class="o">...</span>

<span class="kt">NavigationSplitView</span> <span class="p">{</span>
    <span class="kt">List</span><span class="p">(</span><span class="kt">Category</span><span class="o">.</span><span class="n">allCases</span><span class="p">,</span> <span class="nv">selection</span><span class="p">:</span> <span class="err">$</span><span class="n">selectedCategory</span><span class="p">)</span> <span class="p">{</span> <span class="n">category</span> <span class="k">in</span>
        <span class="kt">NavigationLink</span><span class="p">(</span><span class="n">category</span><span class="o">.</span><span class="n">localizedName</span><span class="p">,</span> <span class="nv">value</span><span class="p">:</span> <span class="n">category</span><span class="p">)</span>
    <span class="p">}</span>
    <span class="o">.</span><span class="nf">navigationTitle</span><span class="p">(</span><span class="s">"Categories"</span><span class="p">)</span>
<span class="p">}</span> <span class="nv">detail</span><span class="p">:</span> <span class="p">{</span>
  <span class="kt">NavigationStack</span><span class="p">(</span><span class="nv">path</span><span class="p">:</span> <span class="err">$</span><span class="n">path</span><span class="p">)</span> <span class="p">{</span>
		<span class="kt">RecipeGrid</span><span class="p">(</span><span class="nv">category</span><span class="p">:</span> <span class="n">selectedCategory</span><span class="p">)</span>
	<span class="p">}</span>
<span class="p">}</span>
</code></pre></div></div>

<p>아래 코드를 보면, <code class="highlighter-rouge">LazyVGrid</code>를 사용하여 <code class="highlighter-rouge">RecipeTile</code>을 표시하고 있습니다. UI를 만드는 데 특별한 것은 없는 일반적인 <code class="highlighter-rouge">LazyVGrid</code> UI입니다. <code class="highlighter-rouge">NavigationLink</code>에서 <code class="highlighter-rouge">recipe</code>를 value로 동일하게 설정했습니다. 그렇다면, <code class="highlighter-rouge">navigationDestination</code>은 어디에서 선언해주어야 할까요?</p>

<div class="language-swift highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="k">var</span> <span class="nv">category</span><span class="p">:</span> <span class="kt">Category</span><span class="p">?</span>

<span class="k">var</span> <span class="nv">body</span><span class="p">:</span> <span class="n">some</span> <span class="kt">View</span> <span class="p">{</span>
	<span class="k">if</span> <span class="k">let</span> <span class="nv">category</span> <span class="o">=</span> <span class="n">category</span> <span class="p">{</span>
		<span class="kt">ScrollView</span> <span class="p">{</span>
		    <span class="kt">LazyVGrid</span><span class="p">(</span><span class="nv">columns</span><span class="p">:</span> <span class="n">columns</span><span class="p">)</span> <span class="p">{</span>
		        <span class="kt">ForEach</span><span class="p">(</span><span class="n">dataModel</span><span class="o">.</span><span class="nf">recipes</span><span class="p">(</span><span class="nv">in</span><span class="p">:</span> <span class="n">category</span><span class="p">))</span> <span class="p">{</span> <span class="n">recipe</span> <span class="k">in</span>
		            <span class="kt">NavigationLink</span><span class="p">(</span><span class="nv">value</span><span class="p">:</span> <span class="n">recipe</span><span class="p">)</span> <span class="p">{</span>
		                <span class="kt">RecipeTile</span><span class="p">(</span><span class="nv">recipe</span><span class="p">:</span> <span class="n">recipe</span><span class="p">)</span>
		            <span class="p">}</span>
		            <span class="o">.</span><span class="nf">buttonStyle</span><span class="p">(</span><span class="o">.</span><span class="n">plain</span><span class="p">)</span>
		        <span class="p">}</span>
		    <span class="p">}</span>
		    <span class="o">.</span><span class="nf">padding</span><span class="p">()</span>
		<span class="p">}</span>
	<span class="p">}</span>
<span class="p">}</span>
</code></pre></div></div>

<p>만약, <code class="highlighter-rouge">navigationDestination</code>을 각각의 아이템에 붙여주게 되면 <code class="highlighter-rouge">ForEach</code>가 반복될 때마다 해당 코드가 실행됩니다. 그러므로 스크롤 위치와 상관없이 가장 바깥에 있는 <code class="highlighter-rouge">ScrollView</code>에 붙여주시면 됩니다.</p>

<div class="language-swift highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="kt">ScrollView</span> <span class="p">{</span>
<span class="o">...</span>
<span class="p">}</span>
<span class="o">.</span><span class="nf">navigationTitle</span><span class="p">(</span><span class="n">category</span><span class="o">.</span><span class="n">localizedName</span><span class="p">)</span>
<span class="o">.</span><span class="nf">navigationDestination</span><span class="p">(</span><span class="nv">for</span><span class="p">:</span> <span class="kt">Recipe</span><span class="o">.</span><span class="k">self</span><span class="p">)</span> <span class="p">{</span> <span class="n">recipe</span> <span class="k">in</span>
    <span class="kt">RecipeDetail</span><span class="p">(</span><span class="nv">recipe</span><span class="p">:</span> <span class="n">recipe</span><span class="p">)</span>
<span class="p">}</span>
</code></pre></div></div>

<h2 id="persistent-state">Persistent state</h2>

<p>이제 네비게이션 상태를 유지하는 방법에 대해 살펴보겠습니다.</p>

<p>앱에서 네비게이션 상태를 유지하려면 다음 두 가지 구성 요소가 필요합니다. 이 중 <code class="highlighter-rouge">SceneStorage</code>은 iOS 14에서 추가된 새로운 개념입니다.</p>

<ul>
  <li><code class="highlighter-rouge">Codable</code></li>
  <li><code class="highlighter-rouge">SceneStorage</code></li>
</ul>

<p>작업은 이번에 3단계로 진행됩니다.</p>

<ol>
  <li>Move navigation state into a model type
    <ol>
      <li>현재 네비게이션 상태를 모델로 만들어 저장하고, 꺼내올 수 있도록 하는 기능을 추가합니다.</li>
    </ol>
  </li>
  <li>Make the navigation model codable</li>
  <li>Use SceneStorage to save and restore</li>
</ol>

<h3 id="1-move-navigation-state-into-a-model-type">1. Move navigation state into a model type</h3>

<p>앞서 만든 네비게이션 코드를 살펴보겠습니다. <code class="highlighter-rouge">selectedCategory</code>는 좌측 사이드바에서 선택한 아이템을 저장하고 있습니다. 또한 <code class="highlighter-rouge">path</code>에서는 <code class="highlighter-rouge">detail</code> 영역이 <code class="highlighter-rouge">NavigationStack</code>에 어떤 아이템이 push되어 있는지 저장하고 있습니다.</p>

<p>위 2가지 정보만 알고 있다면 프로그래밍적으로 <code class="highlighter-rouge">navigation state</code>를 복원할 수 있습니다.</p>

<div class="language-swift highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="kd">@State</span> <span class="kd">private</span> <span class="k">var</span> <span class="nv">selectedCategory</span><span class="p">:</span> <span class="kt">Category</span><span class="p">?</span>
<span class="kd">@State</span> <span class="kd">private</span> <span class="k">var</span> <span class="nv">path</span><span class="p">:</span> <span class="p">[</span><span class="kt">Recipe</span><span class="p">]</span> <span class="o">=</span> <span class="p">[]</span>
<span class="o">...</span>

<span class="kt">NavigationSplitView</span> <span class="p">{</span>
    <span class="kt">List</span><span class="p">(</span><span class="kt">Category</span><span class="o">.</span><span class="n">allCases</span><span class="p">,</span> <span class="nv">selection</span><span class="p">:</span> <span class="err">$</span><span class="n">selectedCategory</span><span class="p">)</span> <span class="p">{</span> <span class="n">category</span> <span class="k">in</span>
        <span class="kt">NavigationLink</span><span class="p">(</span><span class="n">category</span><span class="o">.</span><span class="n">localizedName</span><span class="p">,</span> <span class="nv">value</span><span class="p">:</span> <span class="n">category</span><span class="p">)</span>
    <span class="p">}</span>
    <span class="o">.</span><span class="nf">navigationTitle</span><span class="p">(</span><span class="s">"Categories"</span><span class="p">)</span>
<span class="p">}</span> <span class="nv">detail</span><span class="p">:</span> <span class="p">{</span>
  <span class="kt">NavigationStack</span><span class="p">(</span><span class="nv">path</span><span class="p">:</span> <span class="err">$</span><span class="n">path</span><span class="p">)</span> <span class="p">{</span>
		<span class="kt">RecipeGrid</span><span class="p">(</span><span class="nv">category</span><span class="p">:</span> <span class="n">selectedCategory</span><span class="p">)</span>
	<span class="p">}</span>
<span class="p">}</span>
</code></pre></div></div>

<p>2개의 정보를 클래스로 만들어 보겠습니다. 그리고 해당 모델을 인스턴스화 하여 교체하겠습니다.</p>

<div class="language-swift highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="kd">class</span> <span class="kt">NavigationModel</span><span class="p">:</span> <span class="kt">ObservableObject</span> <span class="p">{</span>
	<span class="kd">@Published</span> <span class="k">var</span> <span class="nv">selectedCategory</span><span class="p">:</span> <span class="kt">Category</span><span class="p">?</span>
	<span class="kd">@Published</span> <span class="k">var</span> <span class="nv">path</span><span class="p">:</span> <span class="p">[</span><span class="kt">Recipe</span><span class="p">]</span> <span class="o">=</span> <span class="p">[]</span>
<span class="p">}</span>

<span class="kd">@StateObject</span> <span class="kd">private</span> <span class="k">var</span> <span class="nv">navModel</span> <span class="o">=</span> <span class="kt">NavigationModel</span><span class="p">()</span>
<span class="o">...</span>
<span class="kt">NavigationSplitView</span> <span class="p">{</span>
    <span class="kt">List</span><span class="p">(</span><span class="kt">Category</span><span class="o">.</span><span class="n">allCases</span><span class="p">,</span> <span class="nv">selection</span><span class="p">:</span> <span class="err">$</span><span class="n">navModel</span><span class="o">.</span><span class="n">selectedCategory</span><span class="p">)</span> <span class="p">{</span> <span class="n">category</span> <span class="k">in</span>
        <span class="kt">NavigationLink</span><span class="p">(</span><span class="n">category</span><span class="o">.</span><span class="n">localizedName</span><span class="p">,</span> <span class="nv">value</span><span class="p">:</span> <span class="n">category</span><span class="p">)</span>
    <span class="p">}</span>
    <span class="o">.</span><span class="nf">navigationTitle</span><span class="p">(</span><span class="s">"Categories"</span><span class="p">)</span>
<span class="p">}</span> <span class="nv">detail</span><span class="p">:</span> <span class="p">{</span>
  <span class="kt">NavigationStack</span><span class="p">(</span><span class="nv">path</span><span class="p">:</span> <span class="err">$</span><span class="n">navModel</span><span class="o">.</span><span class="n">path</span><span class="p">)</span> <span class="p">{</span>
		<span class="kt">RecipeGrid</span><span class="p">(</span><span class="nv">category</span><span class="p">:</span> <span class="n">navModel</span><span class="o">.</span><span class="n">selectedCategory</span><span class="p">)</span>
	<span class="p">}</span>
<span class="p">}</span>
</code></pre></div></div>

<h3 id="2-make-the-navigation-model-codable">2. Make the navigation model codable</h3>

<p>이제 이전에 만든 NavigationModel을 Codable로 만들어 봅시다. 대부분의 경우 Codable만 추가하면 자동으로 encodable, decodable 하게 만들어집니다. 그러나 이번 경우에는 세 가지 이유로 커스텀하게 만들어야 합니다.</p>

<ol>
  <li>Don’t store entire model value
    <ol>
      <li>Recipe 모델의 모든 데이터를 저장할 필요가 없습니다.</li>
    </ol>
  </li>
  <li>Repeated information
    <ol>
      <li>로컬 DB에 이미 레시피 정보가 있으므로, 고유한 값인 identifier만 있으면 언제든지 해당 레시피를 다시 복원할 수 있습니다.</li>
    </ol>
  </li>
  <li>Can change independently
    <ol>
      <li>만약 로컬 DB에 저장된 Recipe 값이 업데이트 된 경우, 현재 저장된 정보는 구식 정보가 됩니다.</li>
    </ol>
  </li>
</ol>

<p>먼저 아래와 같이 <code class="highlighter-rouge">CodingKeys</code>를 추가합니다. <code class="highlighter-rouge">selectedCategory</code>는 동일하지만, <code class="highlighter-rouge">path</code>의 경우 <code class="highlighter-rouge">recipePathIds</code>로 이름을 지었습니다. 이는 앞서 설명한 것과 마찬가지로 <strong>path의 ID 값만</strong> 저장할 계획이기 때문입니다.</p>

<div class="language-swift highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="kd">class</span> <span class="kt">NavigationModel</span><span class="p">:</span> <span class="kt">ObservableObject</span><span class="p">,</span> <span class="kt">Codable</span> <span class="p">{</span>
	<span class="kd">@Published</span> <span class="k">var</span> <span class="nv">selectedCategory</span><span class="p">:</span> <span class="kt">Category</span><span class="p">?</span>
	<span class="kd">@Published</span> <span class="k">var</span> <span class="nv">path</span><span class="p">:</span> <span class="p">[</span><span class="kt">Recipe</span><span class="p">]</span> <span class="o">=</span> <span class="p">[]</span>
	
	<span class="kd">enum</span> <span class="kt">CodingKeys</span><span class="p">:</span> <span class="kt">String</span><span class="p">,</span> <span class="kt">CodingKey</span> <span class="p">{</span>
	  <span class="k">case</span> <span class="n">selectedCategory</span>
	  <span class="k">case</span> <span class="n">recipePathIds</span>
	<span class="p">}</span>
<span class="p">}</span>
</code></pre></div></div>

<p>아래와 같이 인코딩 방법을 사용하여 저장합니다. 이 때, <code class="highlighter-rouge">encodeIfPresent</code>는 <code class="highlighter-rouge">selectedCategory</code> 값이 <code class="highlighter-rouge">nil</code>이 아닐 경우에만 값을 저장합니다. <code class="highlighter-rouge">path</code>의 <code class="highlighter-rouge">ID</code>들은 배열로 저장됩니다.</p>

<div class="language-swift highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="kd">func</span> <span class="nf">encode</span><span class="p">(</span><span class="n">to</span> <span class="nv">encoder</span><span class="p">:</span> <span class="kt">Encoder</span><span class="p">)</span> <span class="k">throws</span> <span class="p">{</span>
    <span class="k">var</span> <span class="nv">container</span> <span class="o">=</span> <span class="n">encoder</span><span class="o">.</span><span class="nf">container</span><span class="p">(</span><span class="nv">keyedBy</span><span class="p">:</span> <span class="kt">CodingKeys</span><span class="o">.</span><span class="k">self</span><span class="p">)</span>
    <span class="k">try</span> <span class="n">container</span><span class="o">.</span><span class="nf">encodeIfPresent</span><span class="p">(</span><span class="n">selectedCategory</span><span class="p">,</span> <span class="nv">forKey</span><span class="p">:</span> <span class="o">.</span><span class="n">selectedCategory</span><span class="p">)</span>
    <span class="k">try</span> <span class="n">container</span><span class="o">.</span><span class="nf">encode</span><span class="p">(</span><span class="n">recipePath</span><span class="o">.</span><span class="nf">map</span><span class="p">(</span><span class="err">\</span><span class="o">.</span><span class="n">id</span><span class="p">),</span> <span class="nv">forKey</span><span class="p">:</span> <span class="o">.</span><span class="n">recipePathIds</span><span class="p">)</span>
<span class="p">}</span>
</code></pre></div></div>

<p>저장하는 데이터는 다음과 같이 JSON으로 표현할 수 있습니다.</p>

<div class="language-swift highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="p">{</span>
	<span class="s">"selectedCategory"</span><span class="p">:</span> <span class="mi">0</span><span class="p">,</span>
	<span class="s">"recipePathIds"</span><span class="p">:</span> <span class="p">[</span>
		<span class="s">"DD742F51-...."</span><span class="p">,</span>
		<span class="s">"F1F67850-....."</span>
	<span class="p">]</span>
<span class="p">}</span>
</code></pre></div></div>

<p>마지막으로 <code class="highlighter-rouge">init 함수</code>를 작성합니다. <code class="highlighter-rouge">init 함수</code>에서는 <code class="highlighter-rouge">decoder</code>를 통해 저장된 정보가 있다면 복원해 초기 navigation state 값을 설정합니다.</p>

<p>특이한 부분은 <code class="highlighter-rouge">recipe</code>의 id 값들을 decoding 한 이후에 <code class="highlighter-rouge">DataModel</code>에서 일치하는 아이템들을 꺼내주도록 하는 것입니다.</p>

<div class="language-swift highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="kd">required</span> <span class="nf">init</span><span class="p">(</span><span class="n">from</span> <span class="nv">decoder</span><span class="p">:</span> <span class="kt">Decoder</span><span class="p">)</span> <span class="k">throws</span> <span class="p">{</span>
  <span class="k">let</span> <span class="nv">container</span> <span class="o">=</span> <span class="k">try</span> <span class="n">decoder</span><span class="o">.</span><span class="nf">container</span><span class="p">(</span><span class="nv">keyedBy</span><span class="p">:</span> <span class="kt">CodingKeys</span><span class="o">.</span><span class="k">self</span><span class="p">)</span>
  <span class="k">self</span><span class="o">.</span><span class="n">selectedCategory</span> <span class="o">=</span> <span class="k">try</span> <span class="n">container</span><span class="o">.</span><span class="nf">decodeIfPresent</span><span class="p">(</span>
      <span class="kt">Category</span><span class="o">.</span><span class="k">self</span><span class="p">,</span> <span class="nv">forKey</span><span class="p">:</span> <span class="o">.</span><span class="n">selectedCategory</span><span class="p">)</span>
  <span class="k">let</span> <span class="nv">recipePathIds</span> <span class="o">=</span> <span class="k">try</span> <span class="n">container</span><span class="o">.</span><span class="nf">decode</span><span class="p">(</span>
      <span class="p">[</span><span class="kt">Recipe</span><span class="o">.</span><span class="kt">ID</span><span class="p">]</span><span class="o">.</span><span class="k">self</span><span class="p">,</span> <span class="nv">forKey</span><span class="p">:</span> <span class="o">.</span><span class="n">recipePathIds</span><span class="p">)</span>
  <span class="k">self</span><span class="o">.</span><span class="n">recipePath</span> <span class="o">=</span> <span class="n">recipePathIds</span><span class="o">.</span><span class="n">compactMap</span> <span class="p">{</span> <span class="kt">DataModel</span><span class="o">.</span><span class="n">shared</span><span class="p">[</span><span class="nv">$0</span><span class="p">]</span> <span class="p">}</span>
<span class="p">}</span>
</code></pre></div></div>

<p>마지막으로 <code class="highlighter-rouge">jsonData</code>를 외부에서 쉽게 읽고 쓸 수 있도록 인터페이스를 추가합니다.</p>

<div class="language-swift highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="k">var</span> <span class="nv">jsonData</span><span class="p">:</span> <span class="kt">Data</span><span class="p">?</span> <span class="p">{</span>
    <span class="k">get</span> <span class="p">{</span> <span class="k">try</span><span class="p">?</span> <span class="n">encoder</span><span class="o">.</span><span class="nf">encode</span><span class="p">(</span><span class="k">self</span><span class="p">)</span> <span class="p">}</span>
    <span class="k">set</span> <span class="p">{</span>
        <span class="k">guard</span> <span class="k">let</span> <span class="nv">data</span> <span class="o">=</span> <span class="n">newValue</span><span class="p">,</span>
              <span class="k">let</span> <span class="nv">model</span> <span class="o">=</span> <span class="k">try</span><span class="p">?</span> <span class="n">decoder</span><span class="o">.</span><span class="nf">decode</span><span class="p">(</span><span class="k">Self</span><span class="o">.</span><span class="k">self</span><span class="p">,</span> <span class="nv">from</span><span class="p">:</span> <span class="n">data</span><span class="p">)</span>
        <span class="k">else</span> <span class="p">{</span> <span class="k">return</span> <span class="p">}</span>
        <span class="n">selectedCategory</span> <span class="o">=</span> <span class="n">model</span><span class="o">.</span><span class="n">selectedCategory</span>
        <span class="n">recipePath</span> <span class="o">=</span> <span class="n">model</span><span class="o">.</span><span class="n">recipePath</span>
    <span class="p">}</span>
<span class="p">}</span>
</code></pre></div></div>

<h3 id="3-use-scenestorage-to-save-and-restore">3. Use SceneStorage to save and restore</h3>

<p>이제 해당 데이터를 JSON으로 만들어 읽고 쓸 수 있게 되었으니, 실제로 저장해야 합니다. 이 때 <code class="highlighter-rouge">SceneStorage</code>를 사용해 보겠습니다.</p>

<p><code class="highlighter-rouge">SceneStorage</code>는 관련 값을 자동으로 저장하고 불러옵니다. 만약 해당 화면에 최초로 진입한 경우, data 값은 nil이 될 것입니다. 시스템이 Scene을 복원하면, <code class="highlighter-rouge">SceneStorage</code> 값 역시 복구됩니다.</p>

<p>값을 저장하기 위해서는, View 단에 <code class="highlighter-rouge">.task modifier</code>를 추가해야 합니다.</p>

<p><code class="highlighter-rouge">task modifier</code>는 비동기적으로 해당 View가 생성되면 등록되고, View가 사라지면 취소됩니다.</p>

<p>따라서 아래의 코드는 내 뷰가 나타나면 <code class="highlighter-rouge">data</code>를 꺼내서 <code class="highlighter-rouge">navModel</code>에 비동기적으로 추가하고, <code class="highlighter-rouge">navModel</code>의 값이 변경될 때마다 <code class="highlighter-rouge">objectWillChangeSequence</code>가 호출되어 비동기적으로 <code class="highlighter-rouge">data</code>를 업데이트합니다.</p>

<div class="language-swift highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="kd">@StateObject</span> <span class="kd">private</span> <span class="k">var</span> <span class="nv">navModel</span> <span class="o">=</span> <span class="kt">NavigationModel</span><span class="p">()</span>
<span class="kd">@SceneStorage("navigation")</span> <span class="kd">private</span> <span class="k">var</span> <span class="nv">data</span><span class="p">:</span> <span class="kt">Data</span><span class="p">?</span>

<span class="k">var</span> <span class="nv">body</span><span class="p">:</span> <span class="n">some</span> <span class="kt">View</span> <span class="p">{</span>
	<span class="kt">NavigationSplitView</span> <span class="p">{</span><span class="o">...</span><span class="p">}</span>
	<span class="o">.</span><span class="n">task</span> <span class="p">{</span>
	    <span class="k">if</span> <span class="k">let</span> <span class="nv">jsonData</span> <span class="o">=</span> <span class="n">data</span> <span class="p">{</span>
	        <span class="n">navModel</span><span class="o">.</span><span class="n">jsonData</span> <span class="o">=</span> <span class="n">jsonData</span>
	    <span class="p">}</span>
	    <span class="k">for</span> <span class="n">await</span> <span class="n">_</span> <span class="k">in</span> <span class="n">navModel</span><span class="o">.</span><span class="n">objectWillChangeSequence</span> <span class="p">{</span>
	        <span class="n">data</span> <span class="o">=</span> <span class="n">navigationModel</span><span class="o">.</span><span class="n">jsonData</span>
	    <span class="p">}</span>
	<span class="p">}</span>
<span class="p">}</span>
</code></pre></div></div>

<h2 id="navigation-tips">Navigation Tips</h2>

<p>SwiftUI의 네비게이션 컨테이너에 대해 알아보았는데, 마지막으로 몇 가지 팁을 알려드리겠습니다.</p>

<ol>
  <li>가능하면 빨리 새로운 <code class="highlighter-rouge">NavigationStack</code>, <code class="highlighter-rouge">NavigationSplitView</code>로 전환하세요.
    <ol>
      <li><code class="highlighter-rouge">NavigationView.stack</code> → <code class="highlighter-rouge">NavigationStack</code></li>
      <li><code class="highlighter-rouge">NavigationView</code> → <code class="highlighter-rouge">NavigationSplitView</code></li>
      <li><code class="highlighter-rouge">NavigationLink.isActive, tag, selection</code> → <code class="highlighter-rouge">NavigationLink.value</code></li>
      <li>자세한 마이그레이션 방법은 Migrating to new navigation types 문서를 확인하세요.</li>
    </ol>
  </li>
  <li><code class="highlighter-rouge">List</code>를 <code class="highlighter-rouge">NavigationStack</code>, <code class="highlighter-rouge">NavigationSplitView</code>와 함께 사용할 수 있다는 것을 기억하세요.</li>
  <li><code class="highlighter-rouge">navigationDestination modifier</code>를 접근하기 쉬운 곳에 두세요.</li>
  <li>Navigation 구조를 이해했다면 <code class="highlighter-rouge">NavigationSplitView</code>부터 시작하세요.
    <ol>
      <li>작은 화면에서는 자동으로 stack으로 변경되기 때문에 아이폰, 애플 워치 등에서 유용합니다.</li>
    </ol>
  </li>
</ol>

                </div>
            </section>

            <!-- Email subscribe form at the bottom of the page -->
            

            <footer class="post-full-footer">
                <!-- Everything inside the #author tags pulls data from the author -->
                <!-- #author-->
                
                    
                
                    
                
                    
                
                    
                
                    
                
                    
                
                    
                
                <!-- /author  -->
            </footer>

            <!-- If you use Disqus comments, just uncomment this block.
            The only thing you need to change is "test-apkdzgmqhj" - which
            should be replaced with your own Disqus site-id. -->
            
                <section class="post-full-comments">
                    <div id="disqus_thread"></div>
                    <script>
                        var disqus_config = function () {
                            this.page.url = 'https://leejigun.github.io//';
                            this.page.identifier = 'iOS 삽질 블로그';
                        };
                        (function() {
                            var d = document, s = d.createElement('script');
                            s.src = 'https://jglee.disqus.com/embed.js';
                            s.setAttribute('data-timestamp', +new Date());
                            (d.head || d.body).appendChild(s);
                        })();
                    </script>
                </section>
            

        </article>

    </div>
</main>

<!-- Links to Previous/Next posts -->
<aside class="read-next outer">
    <div class="inner">
        <div class="read-next-feed">
            
                
                
                
                
                    <article class="read-next-card"
                        
                            style="background-image: url(/assets/images/blog-cover.jpg)"
                        
                    >
                        <header class="read-next-card-header">
                            <small class="read-next-card-header-sitetitle">&mdash; iOS 삽질 블로그 &mdash;</small>
                            
                                <h3 class="read-next-card-header-title"><a href="/tag/ios/">Ios</a></h3>
                            
                        </header>
                        <div class="read-next-divider"><svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M13 14.5s2 3 5 3 5.5-2.463 5.5-5.5S21 6.5 18 6.5c-5 0-7 11-12 11C2.962 17.5.5 15.037.5 12S3 6.5 6 6.5s4.5 3.5 4.5 3.5"/></svg>
</div>
                        <div class="read-next-card-content">
                            <ul>
                                
                                
                                  
                                    
                                  
                                
                                  
                                    
                                        
                                        
                                            <li><a href="/WWDC22_Design_protocol_interface_in_Swift">[WWDC22] Design protocol interface in Swift</a></li>
                                        
                                    
                                  
                                
                                  
                                    
                                        
                                        
                                            <li><a href="/WWDC22_Generic">[WWDC22] Embreace swift generics - some, any</a></li>
                                        
                                    
                                  
                                
                                  
                                
                                  
                                
                                  
                                
                                  
                                
                                  
                                    
                                        
                                        
                                            <li><a href="/DI_using_Swinject">DI(의존성 주입) using Swinject</a></li>
                                        
                                    
                                  
                                
                                  
                                
                                  
                                    
                                        
                                        
                                    
                                  
                                
                                  
                                    
                                        
                                        
                                    
                                  
                                
                                  
                                
                                  
                                
                                  
                                
                                  
                                
                                  
                                
                                  
                                    
                                        
                                        
                                    
                                  
                                
                                  
                                
                                  
                                
                                  
                                
                                  
                                
                                  
                                
                                  
                                
                                  
                                
                                  
                                
                                  
                                
                                  
                                
                                  
                                
                                  
                                
                                  
                                
                                  
                                
                                  
                                
                                  
                                
                                  
                                
                                  
                                
                                  
                                
                                  
                                
                                  
                                
                                  
                                
                                  
                                    
                                        
                                        
                                    
                                  
                                
                                  
                                    
                                        
                                        
                                    
                                  
                                
                                  
                                
                                  
                                
                                  
                                    
                                        
                                        
                                    
                                  
                                
                                  
                                
                                  
                                
                                  
                                
                                  
                                
                                  
                                    
                                        
                                        
                                    
                                  
                                
                                  
                                    
                                        
                                        
                                    
                                  
                                
                                  
                                    
                                        
                                        
                                    
                                  
                                
                                  
                                    
                                        
                                        
                                    
                                  
                                
                                  
                                    
                                        
                                        
                                    
                                  
                                
                                  
                                    
                                        
                                        
                                    
                                  
                                
                                  
                                    
                                        
                                        
                                    
                                  
                                
                                  
                                
                                  
                                
                                  
                                
                                  
                                    
                                        
                                        
                                    
                                  
                                
                                  
                                    
                                        
                                        
                                    
                                  
                                
                                  
                                    
                                        
                                        
                                    
                                  
                                
                            </ul>
                        </div>
                        <footer class="read-next-card-footer">
                            <a href="/tag/ios/">
                                
                                    See all 19 posts  →
                                
                            </a>
                        </footer>
                    </article>
                
            

            <!-- If there's a next post, display it using the same markup included from - partials/post-card.hbs -->
            

            <!-- If there's a previous post, display it using the same markup included from - partials/post-card.hbs -->
            
                
    <article class="post-card post-template">
        
            <a class="post-card-image-link" href="/WWDC22_Design_protocol_interface_in_Swift">
                <div class="post-card-image" style="background-image: url(/assets/images/ios/2023-03-05-WWDC22_Design_protocol_interface_in_Swift/post.jpg)"></div>
            </a>
        
        <div class="post-card-content">
            <a class="post-card-content-link" href="/WWDC22_Design_protocol_interface_in_Swift">
                <header class="post-card-header">
                    
                        
                            
                                <span class="post-card-tags">Ios</span>
                            
                        
                    

                    <h2 class="post-card-title">[WWDC22] Design protocol interface in Swift</h2>
                </header>
                <section class="post-card-excerpt">
                    <p>WWDC22 - Design protocol interface in Swift WWDC22 - Swift 제네릭의 활용 이후 연관된 세션입니다. 앞선 포스트를 보고 오시면 더 좋습니다. 구체적 타입(일반 타입) 추상화 및 프로토콜로 타입 관계를 모델링하는 몇 가지 고급</p>
                </section>
            </a>
            <footer class="post-card-meta">
                
                    
                
                    
                
                    
                
                    
                
                    
                
                    
                
                    
                
            </footer>
        </div>
    </article>

            

        </div>
    </div>
</aside>

<!-- Floating header which appears on-scroll, included from includes/floating-header.hbs -->
<div class="floating-header">
    <div class="floating-header-logo">
        <a href="https://leejigun.github.io//">
            
                <img src="/assets/images/blog-icon.png" alt="iOS 삽질 블로그 icon" />
            
            <span>iOS 삽질 블로그</span>
        </a>
    </div>
    <span class="floating-header-divider">&mdash;</span>
    <div class="floating-header-title">[WWDC22] Navigation Cook book in SwiftUI</div>
    <div class="floating-header-share">
        <div class="floating-header-share-label">Share this <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24">
    <path d="M7.5 15.5V4a1.5 1.5 0 1 1 3 0v4.5h2a1 1 0 0 1 1 1h2a1 1 0 0 1 1 1H18a1.5 1.5 0 0 1 1.5 1.5v3.099c0 .929-.13 1.854-.385 2.748L17.5 23.5h-9c-1.5-2-5.417-8.673-5.417-8.673a1.2 1.2 0 0 1 1.76-1.605L7.5 15.5zm6-6v2m-3-3.5v3.5m6-1v2"/>
</svg>
</div>
        <a class="floating-header-share-tw" href="https://twitter.com/share?text=%5BWWDC22%5D+Navigation+Cook+book+in+SwiftUI&amp;url=https://leejigun.github.io/WWDC22_Navigation_Cook_book_in_SwiftUI"
            onclick="window.open(this.href, 'share-twitter', 'width=550,height=235');return false;">
            <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 32 32"><path d="M30.063 7.313c-.813 1.125-1.75 2.125-2.875 2.938v.75c0 1.563-.188 3.125-.688 4.625a15.088 15.088 0 0 1-2.063 4.438c-.875 1.438-2 2.688-3.25 3.813a15.015 15.015 0 0 1-4.625 2.563c-1.813.688-3.75 1-5.75 1-3.25 0-6.188-.875-8.875-2.625.438.063.875.125 1.375.125 2.688 0 5.063-.875 7.188-2.5-1.25 0-2.375-.375-3.375-1.125s-1.688-1.688-2.063-2.875c.438.063.813.125 1.125.125.5 0 1-.063 1.5-.25-1.313-.25-2.438-.938-3.313-1.938a5.673 5.673 0 0 1-1.313-3.688v-.063c.813.438 1.688.688 2.625.688a5.228 5.228 0 0 1-1.875-2c-.5-.875-.688-1.813-.688-2.75 0-1.063.25-2.063.75-2.938 1.438 1.75 3.188 3.188 5.25 4.25s4.313 1.688 6.688 1.813a5.579 5.579 0 0 1 1.5-5.438c1.125-1.125 2.5-1.688 4.125-1.688s3.063.625 4.188 1.813a11.48 11.48 0 0 0 3.688-1.375c-.438 1.375-1.313 2.438-2.563 3.188 1.125-.125 2.188-.438 3.313-.875z"/></svg>

        </a>
        <a class="floating-header-share-fb" href="https://www.facebook.com/sharer/sharer.php?u=https://leejigun.github.io/WWDC22_Navigation_Cook_book_in_SwiftUI"
            onclick="window.open(this.href, 'share-facebook','width=580,height=296');return false;">
            <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 32 32"><path d="M19 6h5V0h-5c-3.86 0-7 3.14-7 7v3H8v6h4v16h6V16h5l1-6h-6V7c0-.542.458-1 1-1z"/></svg>

        </a>
    </div>
    <progress class="progress" value="0">
        <div class="progress-container">
            <span class="progress-bar"></span>
        </div>
    </progress>
</div>


<!-- /post -->

<!-- The #contentFor helper here will send everything inside it up to the matching #block helper found in default.hbs -->


        <!-- Previous/next page links - displayed on every page -->
        

        <!-- The footer at the very bottom of the screen -->
        <footer class="site-footer outer">
            <div class="site-footer-content inner">
                <section class="copyright"><a href="https://leejigun.github.io//">iOS 삽질 블로그</a> &copy; 2023</section>
                <section class="poweredby">Github page blog of <a href="https://github.com/Leejigun">Leejigun</a> &
                    <a href="https://pages.github.com/" target="_blank" rel="noopener">GitHub Pages</a> using
                    <a href="https://github.com/jekyller/jasper2" target="_blank" rel="noopener">Jasper2</a></section>
                <nav class="site-footer-nav">
                    <a href="/">Latest Posts</a>
                    
                    
                    <!-- <a href="https://ghost.org" target="_blank" rel="noopener">Ghost</a> -->
                </nav>
            </div>
        </footer>

    </div>

    <!-- The big email subscribe modal content -->
    

    <!-- highlight.js -->
    <script src="https://cdnjs.cloudflare.com/ajax/libs/prism/1.10.0/components/prism-abap.min.js"></script>
    <script>$(document).ready(function() {
      $('pre code').each(function(i, block) {
        hljs.highlightBlock(block);
      });
    });</script>

    <!-- jQuery + Fitvids, which makes all video embeds responsive -->
    <script
        src="https://code.jquery.com/jquery-3.2.1.min.js"
        integrity="sha256-hwg4gsxgFZhOsEEamdOYGBf13FyQuiTwlAQgxVSNgt4="
        crossorigin="anonymous">
    </script>
    <script type="text/javascript" src="/assets/js/jquery.fitvids.js"></script>
    <script type="text/javascript" src="https://demo.ghost.io/assets/js/jquery.fitvids.js?v=724281a32e"></script>


    <!-- Paginator increased to "infinit" in _config.yml -->
    <!-- if paginator.posts  -->
    <!-- <script>
        var maxPages = parseInt('');
    </script>
    <script src="/assets/js/infinitescroll.js"></script> -->
    <!-- /endif -->

    


    <!-- Add Google Analytics  -->
    <!-- Google Analytics Tracking code -->
 <script>
  (function(i,s,o,g,r,a,m){i['GoogleAnalyticsObject']=r;i[r]=i[r]||function(){
  (i[r].q=i[r].q||[]).push(arguments)},i[r].l=1*new Date();a=s.createElement(o),
  m=s.getElementsByTagName(o)[0];a.async=1;a.src=g;m.parentNode.insertBefore(a,m)
  })(window,document,'script','//www.google-analytics.com/analytics.js','ga');

  ga('create', 'UA-154736789-1', 'auto');
  ga('send', 'pageview');

 </script>


    <!-- The #block helper will pull in data from the #contentFor other template files. In this case, there's some JavaScript which we only want to use in post.hbs, but it needs to be included down here, after jQuery has already loaded. -->
    
        <script>

// NOTE: Scroll performance is poor in Safari
// - this appears to be due to the events firing much more slowly in Safari.
//   Dropping the scroll event and using only a raf loop results in smoother
//   scrolling but continuous processing even when not scrolling
$(document).ready(function () {
    // Start fitVids
    var $postContent = $(".post-full-content");
    $postContent.fitVids();
    // End fitVids

    var progressBar = document.querySelector('progress');
    var header = document.querySelector('.floating-header');
    var title = document.querySelector('.post-full-title');

    var lastScrollY = window.scrollY;
    var lastWindowHeight = window.innerHeight;
    var lastDocumentHeight = $(document).height();
    var ticking = false;

    function onScroll() {
        lastScrollY = window.scrollY;
        requestTick();
    }

    function onResize() {
        lastWindowHeight = window.innerHeight;
        lastDocumentHeight = $(document).height();
        requestTick();
    }

    function requestTick() {
        if (!ticking) {
            requestAnimationFrame(update);
        }
        ticking = true;
    }

    function update() {
        var trigger = title.getBoundingClientRect().top + window.scrollY;
        var triggerOffset = title.offsetHeight + 35;
        var progressMax = lastDocumentHeight - lastWindowHeight;

        // show/hide floating header
        if (lastScrollY >= trigger + triggerOffset) {
            header.classList.add('floating-active');
        } else {
            header.classList.remove('floating-active');
        }

        progressBar.setAttribute('max', progressMax);
        progressBar.setAttribute('value', lastScrollY);

        ticking = false;
    }

    window.addEventListener('scroll', onScroll, {passive: true});
    window.addEventListener('resize', onResize, false);

    update();
});
</script>

    

    <!-- Ghost outputs important scripts and data with this tag - it should always be the very last thing before the closing body tag -->
    <!-- ghost_foot -->

</body>
</html>
